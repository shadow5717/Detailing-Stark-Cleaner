]<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARK CLEANE - Sistema Inteligente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #64b5f6;
            --secondary: #ff6d00;
            --secondary-dark: #e65100;
            --accent: #00c853;
            --danger: #d32f2f;
            --warning: #ffa000;
            --info: #0288d1;
            --dark: #121212;
            --light: #f5f7fb;
            --gray: #5f6368;
            --gray-light: #e8eaed;
            --sidebar-width: 260px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #9e9e9e;
            --border-color: #333;
            --hover-color: #2a2a2a;
        }

        .light-mode {
            --bg-color: #f5f7fb;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #5f6368;
            --border-color: #e0e0e0;
            --hover-color: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--secondary) 100%);
            padding: 20px;
        }

        .login-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 1200px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
            width: 100%;
        }

        .login-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .logo-icon-large {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 3rem;
            box-shadow: var(--shadow-lg);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .login-title {
            font-size: 3.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, white, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .login-subtitle {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 600px;
            line-height: 1.5;
        }

        .login-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            width: 100%;
        }

        .login-card {
            flex: 1;
            min-width: 350px;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-header-custom {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .card-body {
            padding: 30px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: white;
            color: #333;
            transition: var(--transition);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .form-select {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: white;
            color: #333;
            transition: var(--transition);
            font-size: 1rem;
        }

        .input-group {
            display: flex;
            margin-bottom: 25px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .input-group-text {
            padding: 14px 18px;
            background: var(--primary);
            border: none;
            color: white;
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-group .form-control {
            border: none;
            border-left: 2px solid rgba(255,255,255,0.3);
            border-radius: 0;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 1rem;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-success {
            background: linear-gradient(90deg, var(--accent), #00a046);
            color: white;
        }

        .btn-custom {
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
        }

        .w-100 {
            width: 100%;
        }

        .mb-3 {
            margin-bottom: 25px;
        }

        .mb-4 {
            margin-bottom: 30px;
        }

        .user-limit-reached {
            background: rgba(211, 47, 47, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .d-none {
            display: none;
        }

        .login-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
            width: 100%;
            max-width: 1200px;
        }

        .feature {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .feature:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .feature i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .feature h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .feature p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        @media (max-width: 992px) {
            .login-cards {
                flex-direction: column;
                align-items: center;
            }
            
            .login-card {
                max-width: 500px;
                width: 100%;
            }
            
            .login-title {
                font-size: 2.8rem;
            }
        }

        @media (max-width: 768px) {
            .login-title {
                font-size: 2.2rem;
            }
            
            .login-subtitle {
                font-size: 1.1rem;
                padding: 0 20px;
            }
            
            .card-body {
                padding: 25px 20px;
            }
            
            .login-features {
                grid-template-columns: 1fr;
                padding: 0 20px;
            }
        }

        /* Resto de estilos */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: bold;
            font-size: 1.4rem;
            color: white;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 500;
        }

        .menu-item:hover,
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid white;
            color: white;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.active {
            max-height: 300px;
        }

        .submenu-item {
            padding: 12px 20px 12px 60px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.75);
            font-size: 0.9rem;
        }

        .submenu-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .header {
            height: var(--header-height);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: var(--hover-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Content Area */
        .content {
            padding: 25px;
        }

        .page-title {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Dashboard Styles */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .card-system {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card-system::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card-system:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .barberia {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .billar {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .carwash {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .config {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .card-system h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card-system p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .trend-up {
            color: var(--accent);
        }
        .trend-down {
            color: var(--danger);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 25px;
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        /* Table Styles */
        .table-container {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 18px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--hover-color);
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        tr:hover {
            background-color: var(--hover-color);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-success {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }

        .badge-warning {
            background: rgba(255, 160, 0, 0.15);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(2, 136, 209, 0.15);
            color: var(--info);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Form Styles */
        .form-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-color);
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* POS Styles */
        .pos-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 18px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .product-image {
            width: 80px;
            height: 80px;
            background: var(--hover-color);
            border-radius: 10px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .product-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .product-card p {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .cart {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            border: 1px solid var(--border-color);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .cart-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover-color);
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-color);
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 20px 0;
            text-align: right;
            color: var(--secondary);
        }

        /* Vehicle Cards */
        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .vehicle-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
            border: 1px solid var(--border-color);
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .vehicle-placa {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .vehicle-type {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .car {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .jeepeta {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .motor {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .camion {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .vehicle-details {
            margin-bottom: 20px;
        }

        .vehicle-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .vehicle-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .hamburger {
                display: block;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .pos-container {
                grid-template-columns: 1fr;
            }
            .user-info {
                display: none;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Factura Styles */
        .invoice-container {
            background: white;
            color: black;
            width: 80mm;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.2;
            margin: 0 auto;
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 10px;
        }

        .invoice-logo {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .invoice-company {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .invoice-address {
            font-size: 10px;
            margin-bottom: 5px;
        }

        .invoice-rnc {
            font-size: 10px;
            margin-bottom: 10px;
        }

        .invoice-details {
            margin-bottom: 10px;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 5px 0;
        }

        .invoice-items {
            width: 100%;
            margin-bottom: 10px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .invoice-total {
            border-top: 1px dashed #000;
            padding-top: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .invoice-payment {
            margin-bottom: 10px;
        }

        .invoice-footer {
            text-align: center;
            border-top: 1px dashed #000;
            padding-top: 10px;
            font-size: 10px;
        }

        .invoice-number {
            font-weight: bold;
            margin-top: 5px;
        }

        /* Card Payment Section */
        .card-payment-section {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }

        .card-payment-header {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .card-payment-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .card-payment-detail {
            display: flex;
            justify-content: space-between;
        }

        .card-payment-label {
            font-weight: bold;
        }

        .card-payment-approval {
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            color: #00c853;
            margin: 15px 0;
        }

        .card-number {
            letter-spacing: 2px;
            font-weight: bold;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 25px;
            background: var(--card-bg);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--accent);
            z-index: 10000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            max-width: 350px;
        }
        .notification.error {
            border-left-color: var(--danger);
        }
        .notification.warning {
            border-left-color: var(--warning);
        }
        .notification.info {
            border-left-color: var(--info);
        }
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notification i {
            font-size: 1.2rem;
        }
        .notification.success i {
            color: var(--accent);
        }
        .notification.error i {
            color: var(--danger);
        }
        .notification.warning i {
            color: var(--warning);
        }
        .notification.info i {
            color: var(--info);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Alert Badge */
        .alert-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Jarvis AI Styles */
        .jarvis-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
        }

        .jarvis-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a73e8, #00c853);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .jarvis-btn.listening {
            background: linear-gradient(135deg, #ff6d00, #d32f2f);
            animation: pulse 1.5s infinite;
        }

        .jarvis-btn:hover {
            transform: scale(1.1);
        }

        .jarvis-chat {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 400px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .jarvis-chat.active {
            display: flex;
        }

        .jarvis-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .jarvis-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.jarvis {
            align-self: flex-start;
            background: var(--hover-color);
            color: var(--text-color);
            border-bottom-left-radius: 5px;
        }

        .jarvis-input {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        .jarvis-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .jarvis-input button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* AI Prediction Cards */
        .ai-prediction {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .ai-prediction h4 {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .ai-prediction p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Voice Command Key */
        .voice-key {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 10000;
        }

        .voice-key-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6d00, #d32f2f);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-key-btn:hover {
            transform: scale(1.1);
        }

        /* RNC Field Styles */
        .rnc-field {
            margin-top: 15px;
            padding: 12px;
            background: var(--hover-color);
            border-radius: 8px;
            border-left: 3px solid var(--info);
        }

        .rnc-field label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .rnc-input {
            display: flex;
            gap: 10px;
        }

        .rnc-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .rnc-optional {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: block;
        }

        /* Approval Field */
        .approval-field {
            margin-top: 15px;
            padding: 12px;
            background: var(--hover-color);
            border-radius: 8px;
            border-left: 3px solid var(--warning);
        }

        .approval-field label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
        }

        .approval-input {
            display: flex;
            gap: 10px;
        }

        .approval-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        /* Service Cards */
        .service-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 120px;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .service-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .service-card p {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        /* Services Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        /* Configuration Styles */
        .config-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .config-tab {
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-weight: 500;
            white-space: nowrap;
        }

        .config-tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        /* Product Search */
        .product-search {
            margin-bottom: 20px;
        }

        .product-search input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
        }

        /* Client List */
        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .client-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .client-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .client-phone {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .client-services {
            margin-top: 10px;
        }

        .service-tag {
            display: inline-block;
            background: rgba(26, 115, 232, 0.1);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        /* Payment Validation */
        .payment-validation {
            background: rgba(211, 47, 47, 0.1);
            border: 1px solid var(--danger);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            color: var(--danger);
            display: none;
        }

        .payment-validation.show {
            display: block;
        }

        /* Employee Management */
        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .employee-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .employee-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .employee-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Printer Configuration */
        .printer-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .printer-option {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .printer-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .printer-option.active {
            border-color: var(--primary);
            background: rgba(26, 115, 232, 0.1);
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Login Screen -->
    <div class="login-container" id="screen-login">
        <div class="login-wrapper">
            <div class="login-header">
                <div class="login-logo">
                    <div class="logo-icon-large">SC</div>
                    <h1 class="login-title">STARK CLEANE</h1>
                    <p class="login-subtitle">Sistema Inteligente de Gestión - Controla tu barbería, billar y car wash desde una sola plataforma</p>
                </div>
            </div>
            
            <div class="login-cards">
                <div class="login-card">
                    <div class="card-header card-header-custom">
                        <i class="fas fa-sign-in-alt"></i>Iniciar Sesión
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Usuario</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input
                                    type="text"
                                    id="login-username"
                                    class="form-control"
                                    placeholder="Ingrese su usuario"
                                />
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Contraseña</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input
                                    type="password"
                                    id="login-password"
                                    class="form-control"
                                    placeholder="Ingrese su contraseña"
                                />
                            </div>
                        </div>
                        <div class="mb-3">
                            <button id="btn-login" class="btn btn-primary w-100 btn-custom">
                                <i class="fas fa-sign-in-alt"></i>Entrar al Sistema
                            </button>
                        </div>
                    </div>
                </div>

                <div class="login-card">
                    <div class="card-header card-header-custom">
                        <i class="fas fa-user-plus"></i>Registro de Usuarios
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Usuario</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input
                                    type="text"
                                    id="register-username"
                                    class="form-control"
                                    placeholder="Nuevo usuario"
                                />
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Contraseña (6+ caracteres)</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input
                                    type="password"
                                    id="register-password"
                                    class="form-control"
                                    placeholder="Nueva contraseña"
                                />
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirmar Contraseña</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input
                                    type="password"
                                    id="register-confirm-password"
                                    class="form-control"
                                    placeholder="Confirme la contraseña"
                                />
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Rol</label>
                            <select id="register-role" class="form-select">
                                <option value="vendedor">Vendedor</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <button id="btn-register" class="btn btn-success w-100 btn-custom">
                                <i class="fas fa-user-plus"></i>Registrar Usuario
                            </button>
                        </div>
                        <div id="user-limit-message" class="user-limit-reached d-none">
                            <i class="fas fa-exclamation-circle"></i>
                            Límite de usuarios alcanzado (máximo 3)
                        </div>
                    </div>
                </div>
            </div>

            <div class="login-features">
                <div class="feature">
                    <i class="fas fa-cut"></i>
                    <h3>Barbería Inteligente</h3>
                    <p>Gestión de citas, clientes y servicios con control total</p>
                </div>
                <div class="feature">
                    <i class="fas fa-dice"></i>
                    <h3>Sistema POS</h3>
                    <p>Ventas e inventario en tiempo real con facturación</p>
                </div>
                <div class="feature">
                    <i class="fas fa-car"></i>
                    <h3>Car Wash</h3>
                    <p>Control de vehículos y servicios de lavado</p>
                </div>
                <div class="feature">
                    <i class="fas fa-robot"></i>
                    <h3>Asistente Jarvis</h3>
                    <p>IA integrada para comandos de voz y predicciones</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main System (Hidden until login) -->
    <div class="container" id="mainSystem" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">SC</div>
                    <span>STARK CLEANE</span>
                </div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                </div>
                <div class="menu-item" data-page="barberia">
                    <i class="fas fa-cut"></i>
                    <span>Barbería</span>
                </div>

                <div class="menu-item" data-page="billar">
                    <i class="fas fa-dice"></i>
                    <span>Billar</span>
                </div>

                <div class="menu-item" data-page="carwash">
                    <i class="fas fa-car"></i>
                    <span>Car Wash</span>
                </div>

                <div class="menu-item" data-submenu="configuracion">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu" id="configuracion-submenu">
                    <div class="submenu-item" data-page="config-usuarios">Usuarios</div>
                    <div class="submenu-item" data-page="config-servicios">Servicios</div>
                    <div class="submenu-item" data-page="config-productos">Productos</div>
                    <div class="submenu-item" data-page="config-empleados">Empleados</div>
                    <div class="submenu-item" data-page="config-impresora">Impresora</div>
                    <div class="submenu-item" data-page="config-tema">Tema</div>
                    <div class="submenu-item" data-page="config-jarvis">Configuración Jarvis</div>
                </div>

                <div class="menu-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesión</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <div class="hamburger">
                        <i class="fas fa-bars"></i>
                    </div>
                    <div class="header-title" id="headerTitle">Dashboard</div>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="currentUserName">Usuario</div>
                            <div class="user-role" id="currentUserRole">Rol</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- Dashboard -->
                <div class="page active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Principal</h1>
                        <div class="header-actions">
                            <button class="btn btn-outline" id="refreshDashboard">
                                <i class="fas fa-sync-alt"></i> Actualizar
                            </button>
                        </div>
                    </div>

                    <!-- AI Predictions -->
                    <div class="ai-prediction">
                        <h4><i class="fas fa-robot"></i> PREDICCIÓN INTELIGENTE - JARVIS</h4>
                        <p id="aiPredictionText">Bienvenido al sistema STARK CLEANE. Comienza configurando tus servicios en la sección de Configuración.</p>
                    </div>

                    <!-- Alertas en tiempo real -->
                    <div id="liveAlerts"></div>

                    <div class="dashboard-cards">
                        <div class="card-system" data-page="barberia">
                            <div class="card-icon barberia">
                                <i class="fas fa-cut"></i>
                            </div>
                            <h3>Barbería</h3>
                            <p>Gestión de citas y clientes</p>
                            <div class="card-value" id="appointmentsCount">0</div>
                            <div class="card-trend">
                                <span id="appointmentsTrend">No hay citas hoy</span>
                            </div>
                        </div>

                        <div class="card-system" data-page="billar">
                            <div class="card-icon billar">
                                <i class="fas fa-dice"></i>
                            </div>
                            <h3>Billar</h3>
                            <p>Punto de venta e inventario</p>
                            <div class="card-value" id="salesTotal">RD$ 0</div>
                            <div class="card-trend">
                                <span id="salesTrend">No hay ventas hoy</span>
                            </div>
                        </div>

                        <div class="card-system" data-page="carwash">
                            <div class="card-icon carwash">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Car Wash</h3>
                            <p>Lavado de vehículos</p>
                            <div class="card-value" id="vehiclesCount">0</div>
                            <div class="card-trend">
                                <span id="vehiclesTrend">No hay vehículos hoy</span>
                            </div>
                        </div>

                        <div class="card-system" data-page="config-servicios">
                            <div class="card-icon config">
                                <i class="fas fa-cog"></i>
                            </div>
                            <h3>Configurar</h3>
                            <p>Servicios y productos</p>
                            <div class="card-value">0</div>
                            <div class="card-trend">
                                <span>Configura tus servicios</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <h3>Ingresos de Hoy</h3>
                            <div class="stat-value" id="dailyIncome">RD$ 0</div>
                            <div class="stat-trend">
                                <span id="incomeTrend">Sin ingresos hoy</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Clientes Atendidos</h3>
                            <div class="stat-value" id="customersCount">0</div>
                            <div class="stat-trend">
                                <span id="customersTrend">Sin clientes hoy</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Productos Vendidos</h3>
                            <div class="stat-value" id="productsSold">0</div>
                            <div class="stat-trend">
                                <span id="productsTrend">Sin productos vendidos</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Actividad Reciente</div>
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <!-- Barbería - Página Completa -->
                <div class="page" id="barberia">
                    <div class="page-title">
                        <h1>Barbería</h1>
                        <button class="btn btn-primary" id="newAppointmentBtn">
                            <i class="fas fa-plus"></i> Nueva Cita
                        </button>
                    </div>

                    <!-- Tabs de Barbería -->
                    <div class="tabs">
                        <div class="tab active" data-tab="barberia-venta">Venta de Servicios</div>
                        <div class="tab" data-tab="barberia-citas">Registro de Citas</div>
                        <div class="tab" data-tab="barberia-clientes">Clientes Registrados</div>
                        <div class="tab" data-tab="barberia-historial">Historial de Ventas</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="barberia-venta">
                        <!-- Servicios de Barbería configurados por el usuario -->
                        <h3>Servicios de Barbería</h3>
                        <div class="services-grid" id="barberia-services-grid">
                            <!-- Los servicios se cargarán dinámicamente desde la configuración -->
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group">
                                    <label for="cliente-barberia"><i class="fas fa-user"></i> Cliente (Opcional)</label>
                                    <input type="text" id="cliente-barberia" placeholder="Nombre del cliente">
                                </div>
                            </div>

                            <!-- Carrito de Venta Barbería - CON RNC -->
                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Venta</div>
                                    <div class="badge badge-info" id="cartCountBarberia">0 servicios</div>
                                </div>

                                <div class="cart-items" id="cartItemsBarberia">
                                    <!-- Los servicios del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotalBarberia">Total: RD$ 0</div>

                                <!-- Campo RNC Opcional -->
                                <div class="rnc-field">
                                    <label for="rnc-barberia">
                                        <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                                        <span class="rnc-optional">Dejar vacío para "Consumidor Final"</span>
                                    </label>
                                    <div class="rnc-input">
                                        <input type="text" id="rnc-barberia" placeholder="Ej: 123-45678-9" maxlength="11">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="metodo-pago-barberia">Método de Pago</label>
                                    <select id="metodo-pago-barberia">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <!-- Campo de aprobación para tarjeta -->
                                <div class="approval-field" id="approvalFieldBarberia" style="display: none;">
                                    <label for="aprobacion-barberia">
                                        <i class="fas fa-credit-card"></i> Aprobación de Tarjeta / Comprobante
                                        <span class="rnc-optional">Número de aprobación o comprobante</span>
                                    </label>
                                    <div class="approval-input">
                                        <input type="text" id="aprobacion-barberia" placeholder="Ej: 123456">
                                    </div>
                                </div>

                                <div class="form-group" id="cashPaymentSectionBarberia">
                                    <label for="efectivo-recibido-barberia">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido-barberia" placeholder="RD$" value="0">
                                    <div id="cambio-display-barberia" style="margin-top: 10px; font-weight: bold; color: var(--accent);">
                                        Cambio: RD$ 0
                                    </div>
                                </div>

                                <div class="payment-validation" id="paymentValidationBarberia">
                                    <i class="fas fa-exclamation-circle"></i> El efectivo recibido es menor al total. Verifique el pago.
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtnBarberia">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtnBarberia">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-citas">
                        <div class="form-container">
                            <h3>Registrar Nueva Cita</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cliente-cita"><i class="fas fa-user"></i> Nombre del Cliente</label>
                                    <input type="text" id="cliente-cita" placeholder="Nombre completo">
                                </div>
                                <div class="form-group">
                                    <label for="telefono-cita"><i class="fas fa-phone"></i> Teléfono</label>
                                    <input type="text" id="telefono-cita" placeholder="Teléfono">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="servicio-cita"><i class="fas fa-cut"></i> Servicio</label>
                                    <select id="servicio-cita">
                                        <!-- Se cargarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="barbero-cita"><i class="fas fa-user-tie"></i> Barbero</label>
                                    <select id="barbero-cita">
                                        <!-- Se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-cita"><i class="fas fa-calendar"></i> Fecha</label>
                                    <input type="date" id="fecha-cita">
                                </div>
                                <div class="form-group">
                                    <label for="hora-cita"><i class="fas fa-clock"></i> Hora</label>
                                    <input type="time" id="hora-cita">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notas-cita"><i class="fas fa-sticky-note"></i> Notas (Opcional)</label>
                                <textarea id="notas-cita" rows="3" placeholder="Notas adicionales"></textarea>
                            </div>
                            <button class="btn btn-primary" id="saveAppointmentBtn">
                                <i class="fas fa-save"></i> Guardar Cita
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-clientes">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Teléfono</th>
                                        <th>Última Visita</th>
                                        <th>Total Gastado</th>
                                        <th>Servicios</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="clientsTable">
                                    <!-- Los clientes se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-historial">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Servicios</th>
                                        <th>Total</th>
                                        <th>Método Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="barberiaHistoryTable">
                                    <!-- El historial se cargará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Billar - Página Completa -->
                <div class="page" id="billar">
                    <div class="page-title">
                        <h1>Billar - Sistema POS</h1>
                        <button class="btn btn-primary" id="newProductBtn">
                            <i class="fas fa-plus"></i> Nuevo Producto
                        </button>
                    </div>

                    <!-- Tabs de Billar -->
                    <div class="tabs">
                        <div class="tab active" data-tab="billar-inventario">Inventario</div>
                        <div class="tab" data-tab="billar-pos">Punto de Venta</div>
                        <div class="tab" data-tab="billar-ventas">Ventas del Día</div>
                        <div class="tab" data-tab="billar-reportes">Reportes</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="billar-inventario">
                        <div class="page-title">
                            <h2>Inventario de Productos</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="exportProductsBtn">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                                <button class="btn btn-primary" id="addProductBtn">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Producto</th>
                                        <th>Categoría</th>
                                        <th>P. Compra</th>
                                        <th>P. Venta</th>
                                        <th>Stock</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTable">
                                    <!-- Los productos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-pos">
                        <div class="page-title">
                            <h2>Punto de Venta</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="clearCartBtn">
                                    <i class="fas fa-trash"></i> Limpiar Carrito
                                </button>
                            </div>
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group product-search">
                                    <label for="search-product"><i class="fas fa-search"></i> Buscar Producto</label>
                                    <input type="text" id="search-product" placeholder="Escriba nombre, código o categoría">
                                </div>

                                <h3>Productos Disponibles</h3>
                                <div class="products-grid" id="productsGrid">
                                    <!-- Los productos se cargarán dinámicamente desde la configuración -->
                                </div>
                            </div>

                            <!-- Carrito de Venta - CON RNC -->
                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Venta</div>
                                    <div class="badge badge-info" id="cartCount">0 productos</div>
                                </div>

                                <div class="cart-items" id="cartItems">
                                    <!-- Los productos del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotal">Total: RD$ 0</div>

                                <!-- Campo RNC Opcional -->
                                <div class="rnc-field">
                                    <label for="rnc">
                                        <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                                        <span class="rnc-optional">Dejar vacío para "Consumidor Final"</span>
                                    </label>
                                    <div class="rnc-input">
                                        <input type="text" id="rnc" placeholder="Ej: 123-45678-9" maxlength="11">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="metodo-pago">Método de Pago</label>
                                    <select id="metodo-pago">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <!-- Campo de aprobación para tarjeta -->
                                <div class="approval-field" id="approvalField" style="display: none;">
                                    <label for="aprobacion">
                                        <i class="fas fa-credit-card"></i> Aprobación de Tarjeta / Comprobante
                                        <span class="rnc-optional">Número de aprobación o comprobante</span>
                                    </label>
                                    <div class="approval-input">
                                        <input type="text" id="aprobacion" placeholder="Ej: 123456">
                                    </div>
                                </div>

                                <div class="form-group" id="cashPaymentSection">
                                    <label for="efectivo-recibido">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido" placeholder="RD$" value="0">
                                    <div id="cambio-display" style="margin-top: 10px; font-weight: bold; color: var(--accent);">
                                        Cambio: RD$ 0
                                    </div>
                                </div>

                                <div class="payment-validation" id="paymentValidation">
                                    <i class="fas fa-exclamation-circle"></i> El efectivo recibido es menor al total. Verifique el pago.
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtn">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtn">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-ventas">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Total</th>
                                        <th>Productos Vendidos</th>
                                        <th>Método de Pago</th>
                                        <th>RNC</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTable">
                                    <!-- Las ventas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-reportes">
                        <div class="page-title">
                            <h2>Reportes</h2>
                            <div class="header-actions">
                                <button class="btn btn-success" id="exportExcelBtn">
                                    <i class="fas fa-file-excel"></i> Exportar a Excel
                                </button>
                                <button class="btn btn-danger" id="exportPdfBtn">
                                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                                </button>
                            </div>
                        </div>

                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-inicio">Fecha Inicio</label>
                                    <input type="date" id="fecha-inicio">
                                </div>
                                <div class="form-group">
                                    <label for="fecha-fin">Fecha Fin</label>
                                    <input type="date" id="fecha-fin">
                                </div>
                            </div>

                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>

                        <div class="stats" style="margin-top: 20px">
                            <div class="stat-card">
                                <h3>Total Vendido</h3>
                                <div class="stat-value" id="totalSold">RD$ 0</div>
                                <div class="stat-trend">
                                    <span id="soldTrend">Sin ventas registradas</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Producto Más Vendido</h3>
                                <div class="stat-value" id="topProduct">N/A</div>
                                <div class="stat-trend">
                                    <span id="topProductCount">0 unidades</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Categoría Más Popular</h3>
                                <div class="stat-value" id="topCategory">N/A</div>
                                <div class="stat-trend">
                                    <span id="topCategoryPercent">0% de las ventas</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-title">Ventas por Categoría</div>
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Car Wash - Página Completa -->
                <div class="page" id="carwash">
                    <div class="page-title">
                        <h1>Car Wash</h1>
                        <button class="btn btn-success" id="newVehicleBtn">
                            <i class="fas fa-plus"></i> Registrar Vehículo
                        </button>
                    </div>

                    <!-- Tabs de Car Wash -->
                    <div class="tabs">
                        <div class="tab active" data-tab="carwash-registro">Registro de Vehículos</div>
                        <div class="tab" data-tab="carwash-proceso">Vehículos en Proceso</div>
                        <div class="tab" data-tab="carwash-entregados">Vehículos Entregados</div>
                        <div class="tab" data-tab="carwash-servicios">Servicios</div>
                        <div class="tab" data-tab="carwash-historial">Historial</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="carwash-registro">
                        <div class="form-container">
                            <h3>Registrar Nuevo Vehículo</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="placa-vehiculo"><i class="fas fa-car"></i> Placa del Vehículo</label>
                                    <input type="text" id="placa-vehiculo" placeholder="Ej: ABC123">
                                </div>
                                <div class="form-group">
                                    <label for="tipo-vehiculo"><i class="fas fa-car"></i> Tipo de Vehículo</label>
                                    <select id="tipo-vehiculo">
                                        <option value="">Seleccione tipo</option>
                                        <option value="carro">Carro</option>
                                        <option value="jeepeta">Jeepeta</option>
                                        <option value="motor">Motor</option>
                                        <option value="camion">Camión</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cliente-vehiculo"><i class="fas fa-user"></i> Cliente</label>
                                    <input type="text" id="cliente-vehiculo" placeholder="Nombre del cliente">
                                </div>
                                <div class="form-group">
                                    <label for="telefono-vehiculo"><i class="fas fa-phone"></i> Teléfono</label>
                                    <input type="text" id="telefono-vehiculo" placeholder="Teléfono">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="empleado-vehiculo"><i class="fas fa-user-tie"></i> Empleado Asignado</label>
                                <select id="empleado-vehiculo">
                                    <!-- Se cargarán dinámicamente -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="notas-vehiculo"><i class="fas fa-sticky-note"></i> Notas (Opcional)</label>
                                <textarea id="notas-vehiculo" rows="3" placeholder="Notas adicionales"></textarea>
                            </div>
                            <button class="btn btn-success" id="saveVehicleBtn">
                                <i class="fas fa-save"></i> Registrar Vehículo
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-proceso">
                        <div class="vehicles-grid" id="vehiclesGrid">
                            <!-- Los vehículos en proceso se cargarán dinámicamente -->
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-entregados">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Vehículo</th>
                                        <th>Tipo</th>
                                        <th>Cliente</th>
                                        <th>Servicios</th>
                                        <th>Total</th>
                                        <th>Hora Entrada</th>
                                        <th>Hora Salida</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="completedVehiclesTable">
                                    <!-- Los vehículos entregados se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-servicios">
                        <!-- Servicios de Car Wash configurados por el usuario -->
                        <h3>Servicios de Car Wash</h3>
                        <div class="services-grid" id="carwash-services-grid">
                            <!-- Los servicios se cargarán dinámicamente desde la configuración -->
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group">
                                    <label for="vehiculo-servicio"><i class="fas fa-car"></i> Vehículo</label>
                                    <select id="vehiculo-servicio">
                                        <!-- Se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>

                            <!-- Carrito de Venta Car Wash - CON RNC -->
                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Servicios</div>
                                    <div class="badge badge-info" id="cartCountCarwash">0 servicios</div>
                                </div>

                                <div class="cart-items" id="cartItemsCarwash">
                                    <!-- Los servicios del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotalCarwash">Total: RD$ 0</div>

                                <!-- Campo RNC Opcional -->
                                <div class="rnc-field">
                                    <label for="rnc-carwash">
                                        <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                                        <span class="rnc-optional">Dejar vacío para "Consumidor Final"</span>
                                    </label>
                                    <div class="rnc-input">
                                        <input type="text" id="rnc-carwash" placeholder="Ej: 123-45678-9" maxlength="11">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="metodo-pago-carwash">Método de Pago</label>
                                    <select id="metodo-pago-carwash">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <!-- Campo de aprobación para tarjeta -->
                                <div class="approval-field" id="approvalFieldCarwash" style="display: none;">
                                    <label for="aprobacion-carwash">
                                        <i class="fas fa-credit-card"></i> Aprobación de Tarjeta / Comprobante
                                        <span class="rnc-optional">Número de aprobación o comprobante</span>
                                    </label>
                                    <div class="approval-input">
                                        <input type="text" id="aprobacion-carwash" placeholder="Ej: 123456">
                                    </div>
                                </div>

                                <div class="form-group" id="cashPaymentSectionCarwash">
                                    <label for="efectivo-recibido-carwash">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido-carwash" placeholder="RD$" value="0">
                                    <div id="cambio-display-carwash" style="margin-top: 10px; font-weight: bold; color: var(--accent);">
                                        Cambio: RD$ 0
                                    </div>
                                </div>

                                <div class="payment-validation" id="paymentValidationCarwash">
                                    <i class="fas fa-exclamation-circle"></i> El efectivo recibido es menor al total. Verifique el pago.
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtnCarwash">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtnCarwash">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-historial">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-carwash">Fecha</label>
                                    <input type="date" id="fecha-carwash">
                                </div>
                                <div class="form-group">
                                    <label for="tipo-filtro">Tipo de Vehículo</label>
                                    <select id="tipo-filtro">
                                        <option value="">Todos los tipos</option>
                                        <option value="carro">Carro</option>
                                        <option value="jeepeta">Jeepeta</option>
                                        <option value="motor">Motor</option>
                                        <option value="camion">Camión</option>
                                    </select>
                                </div>
                            </div>

                            <button class="btn btn-primary" id="searchCarwashBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 20px">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Vehículo</th>
                                        <th>Tipo</th>
                                        <th>Servicios</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="carwashHistoryTable">
                                    <!-- El historial se cargará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Usuarios -->
                <div class="page" id="config-usuarios">
                    <div class="page-title">
                        <h1>Configuración de Usuarios</h1>
                        <button class="btn btn-primary" id="addUserBtn">
                            <i class="fas fa-plus"></i> Agregar Usuario
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Usuario</th>
                                    <th>Rol</th>
                                    <th>Fecha Registro</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Los usuarios se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Configuración - Servicios -->
                <div class="page" id="config-servicios">
                    <div class="page-title">
                        <h1>Configuración de Servicios</h1>
                    </div>

                    <div class="config-tabs">
                        <div class="config-tab active" data-config-tab="barberia-servicios">Servicios de Barbería</div>
                        <div class="config-tab" data-config-tab="carwash-servicios">Servicios de Car Wash</div>
                    </div>

                    <!-- Servicios de Barbería -->
                    <div class="tab-content active" id="barberia-servicios">
                        <div class="config-section">
                            <h3>Agregar Nuevo Servicio de Barbería</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="servicio-barberia-nombre">Nombre del Servicio</label>
                                    <input type="text" id="servicio-barberia-nombre" placeholder="Ej: Corte de Cabello">
                                </div>
                                <div class="form-group">
                                    <label for="servicio-barberia-precio">Precio (RD$)</label>
                                    <input type="number" id="servicio-barberia-precio" placeholder="250">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="servicio-barberia-descripcion">Descripción (Opcional)</label>
                                <textarea id="servicio-barberia-descripcion" rows="2" placeholder="Descripción del servicio"></textarea>
                            </div>
                            <button class="btn btn-primary" id="agregar-servicio-barberia">
                                <i class="fas fa-plus"></i> Agregar Servicio
                            </button>
                        </div>

                        <div class="config-section">
                            <h3>Servicios Configurados</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Servicio</th>
                                            <th>Precio</th>
                                            <th>Descripción</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="barberia-servicios-lista">
                                        <!-- Los servicios se cargarán dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Servicios de Car Wash -->
                    <div class="tab-content" id="carwash-servicios">
                        <div class="config-section">
                            <h3>Agregar Nuevo Servicio de Car Wash</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="servicio-carwash-nombre">Nombre del Servicio</label>
                                    <input type="text" id="servicio-carwash-nombre" placeholder="Ej: Lavado Completo">
                                </div>
                                <div class="form-group">
                                    <label for="servicio-carwash-precio">Precio (RD$)</label>
                                    <input type="number" id="servicio-carwash-precio" placeholder="450">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="servicio-carwash-descripcion">Descripción (Opcional)</label>
                                <textarea id="servicio-carwash-descripcion" rows="2" placeholder="Descripción del servicio"></textarea>
                            </div>
                            <button class="btn btn-primary" id="agregar-servicio-carwash">
                                <i class="fas fa-plus"></i> Agregar Servicio
                            </button>
                        </div>

                        <div class="config-section">
                            <h3>Servicios Configurados</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Servicio</th>
                                            <th>Precio</th>
                                            <th>Descripción</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="carwash-servicios-lista">
                                        <!-- Los servicios se cargarán dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Productos -->
                <div class="page" id="config-productos">
                    <div class="page-title">
                        <h1>Configuración de Productos</h1>
                    </div>

                    <div class="config-section">
                        <h3>Agregar Nuevo Producto</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="producto-nombre">Nombre del Producto</label>
                                <input type="text" id="producto-nombre" placeholder="Ej: Refresco Cola">
                            </div>
                            <div class="form-group">
                                <label for="producto-codigo">Código (Opcional)</label>
                                <input type="text" id="producto-codigo" placeholder="Código interno">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="producto-precio-compra">Precio de Compra (RD$)</label>
                                <input type="number" id="producto-precio-compra" placeholder="80">
                            </div>
                            <div class="form-group">
                                <label for="producto-precio-venta">Precio de Venta (RD$)</label>
                                <input type="number" id="producto-precio-venta" placeholder="100">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="producto-stock">Stock Inicial</label>
                                <input type="number" id="producto-stock" placeholder="50">
                            </div>
                            <div class="form-group">
                                <label for="producto-categoria">Categoría</label>
                                <select id="producto-categoria">
                                    <option value="bebidas">Bebidas</option>
                                    <option value="snacks">Snacks</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="agregar-producto">
                            <i class="fas fa-plus"></i> Agregar Producto
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Productos Configurados</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Código</th>
                                        <th>P. Compra</th>
                                        <th>P. Venta</th>
                                        <th>Stock</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productos-lista">
                                    <!-- Los productos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Empleados -->
                <div class="page" id="config-empleados">
                    <div class="page-title">
                        <h1>Configuración de Empleados</h1>
                        <button class="btn btn-primary" id="addEmployeeBtn">
                            <i class="fas fa-plus"></i> Agregar Empleado
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Agregar Nuevo Empleado</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empleado-nombre">Nombre Completo</label>
                                <input type="text" id="empleado-nombre" placeholder="Nombre del empleado">
                            </div>
                            <div class="form-group">
                                <label for="empleado-cedula">Cédula</label>
                                <input type="text" id="empleado-cedula" placeholder="Cédula">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empleado-telefono">Teléfono</label>
                                <input type="text" id="empleado-telefono" placeholder="Teléfono">
                            </div>
                            <div class="form-group">
                                <label for="empleado-cargo">Cargo</label>
                                <select id="empleado-cargo">
                                    <option value="barbero">Barbero</option>
                                    <option value="lavador">Lavador</option>
                                    <option value="vendedor">Vendedor</option>
                                    <option value="administrador">Administrador</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="empleado-sueldo">Sueldo (RD$)</label>
                            <input type="number" id="empleado-sueldo" placeholder="Sueldo mensual">
                        </div>
                        <button class="btn btn-primary" id="saveEmployeeBtn">
                            <i class="fas fa-save"></i> Guardar Empleado
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Empleados Registrados</h3>
                        <div class="employees-grid" id="employeesGrid">
                            <!-- Los empleados se cargarán dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Configuración - Impresora -->
                <div class="page" id="config-impresora">
                    <div class="page-title">
                        <h1>Configuración de Impresora</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="printer-type">Tipo de Impresora</label>
                            <select id="printer-type">
                                <option value="ticket">Impresora de Tickets</option>
                                <option value="fiscal">Impresora Fiscal</option>
                                <option value="normal">Impresora Normal</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="printer-name">Nombre de la Impresora</label>
                            <input type="text" id="printer-name" placeholder="Nombre de la impresora en el sistema">
                        </div>

                        <div class="form-group">
                            <label for="paper-width">Ancho del Papel (mm)</label>
                            <input type="number" id="paper-width" value="80" min="40" max="120">
                        </div>

                        <div class="form-group">
                            <label for="company-name">Nombre de la Empresa</label>
                            <input type="text" id="company-name" placeholder="STARK CLEANE">
                        </div>

                        <div class="form-group">
                            <label for="company-address">Dirección</label>
                            <input type="text" id="company-address" placeholder="Dirección de la empresa">
                        </div>

                        <div class="form-group">
                            <label for="company-phone">Teléfono</label>
                            <input type="text" id="company-phone" placeholder="Teléfono de la empresa">
                        </div>

                        <div class="form-group">
                            <label for="company-rnc">RNC (Opcional)</label>
                            <input type="text" id="company-rnc" placeholder="RNC de la empresa">
                        </div>

                        <div class="form-group">
                            <h3>Prueba de Impresión</h3>
                            <div class="printer-options">
                                <div class="printer-option" data-test="ticket">
                                    <i class="fas fa-receipt"></i>
                                    <h4>Ticket de Prueba</h4>
                                    <p>Imprime un ticket de prueba</p>
                                </div>
                                <div class="printer-option" data-test="config">
                                    <i class="fas fa-cog"></i>
                                    <h4>Configuración</h4>
                                    <p>Imprime configuración actual</p>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="savePrinterConfigBtn">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                        <button class="btn btn-success" id="testPrinterBtn" style="margin-left: 10px;">
                            <i class="fas fa-print"></i> Probar Impresión
                        </button>
                    </div>
                </div>

                <!-- Configuración - Tema -->
                <div class="page" id="config-tema">
                    <div class="page-title">
                        <h1>Configuración - Tema</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="select-tema">Seleccionar Tema</label>
                            <select id="select-tema">
                                <option value="dark">Oscuro</option>
                                <option value="light">Claro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Vista Previa</label>
                            <div class="card-system">
                                <div class="card-icon barberia">
                                    <i class="fas fa-cut"></i>
                                </div>
                                <h3>Ejemplo de Tarjeta</h3>
                                <p>Esta es una vista previa del tema seleccionado</p>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="saveThemeBtn">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                </div>

                <!-- Configuración Jarvis -->
                <div class="page" id="config-jarvis">
                    <div class="page-title">
                        <h1>Configuración Jarvis</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="jarvis-voice-key">Tecla de Activación por Voz</label>
                            <input type="text" id="jarvis-voice-key" value="F2" readonly>
                            <small>Presiona F2 para activar el comando de voz</small>
                        </div>

                        <div class="form-group">
                            <label for="jarvis-ai-mode">Modo de IA</label>
                            <select id="jarvis-ai-mode">
                                <option value="avanzado">Avanzado (Recomendado)</option>
                                <option value="basico">Básico</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="jarvis-voice-responses" checked>
                                Respuestas por Voz
                            </label>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="jarvis-auto-actions" checked>
                                Acciones Automáticas
                            </label>
                        </div>

                        <div class="form-group">
                            <h3>Comandos de Voz Disponibles</h3>
                            <div style="background: var(--hover-color); padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <p><strong>"Abrir [módulo]"</strong> - Navega a cualquier módulo</p>
                                <p><strong>"Registrar cita para [nombre] con [barbero]"</strong> - Crea cita automáticamente</p>
                                <p><strong>"Registrar vehículo [tipo] para [servicio]"</strong> - Registra vehículo automáticamente</p>
                                <p><strong>"Agregar producto [nombre] precio [valor]"</strong> - Agrega producto al inventario</p>
                                <p><strong>"Resumen del día"</strong> - Muestra reporte diario</p>
                                <p><strong>"Buscar [cliente/producto/vehículo]"</strong> - Realiza búsquedas</p>
                                <p><strong>"Facturar venta"</strong> - Genera factura de la venta actual</p>
                                <p><strong>"Ver inventario"</strong> - Muestra el inventario actual</p>
                                <p><strong>"Reporte de ventas"</strong> - Genera reporte de ventas</p>
                                <p><strong>"Configurar [opción]"</strong> - Abre configuración específica</p>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="saveJarvisConfigBtn">
                            <i class="fas fa-save"></i> Guardar Configuración Jarvis
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar producto -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Agregar Nuevo Producto</div>
                <button class="modal-close" id="closeProductModal">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigo-barra-producto">Código de Barras</label>
                        <input type="text" id="codigo-barra-producto" placeholder="Ingrese código de barras">
                    </div>
                    <div class="form-group">
                        <label for="nombre-producto">Nombre del Producto</label>
                        <input type="text" id="nombre-producto" placeholder="Ingrese nombre del producto">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="categoria-producto">Categoría</label>
                        <select id="categoria-producto">
                            <option value="">Seleccione categoría</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="licores">Licores</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fecha-ingreso">Fecha de Ingreso</label>
                        <input type="date" id="fecha-ingreso">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="precio-compra">Precio de Compra</label>
                        <input type="number" id="precio-compra" placeholder="RD$">
                    </div>
                    <div class="form-group">
                        <label for="precio-venta">Precio de Venta</label>
                        <input type="number" id="precio-venta" placeholder="RD$">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cantidad-stock">Cantidad en Stock</label>
                        <input type="number" id="cantidad-stock" placeholder="Cantidad">
                    </div>
                    <div class="form-group">
                        <label for="alerta-stock">Alerta de Stock</label>
                        <input type="number" id="alerta-stock" placeholder="Mínimo">
                    </div>
                </div>

                <button class="btn btn-primary" id="saveProductBtn">
                    <i class="fas fa-save"></i> Guardar Producto
                </button>
            </div>
        </div>
    </div>

    <!-- Factura Modal -->
    <div class="modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Factura</div>
                <button class="modal-close" id="closeInvoiceModal">&times;</button>
            </div>
            <div class="invoice-container" id="invoiceContent">
                <!-- La factura se generará aquí -->
            </div>
            <div class="action-buttons" style="margin-top: 20px; justify-content: center;">
                <button class="btn btn-primary" id="printInvoiceBtn">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" id="downloadInvoiceBtn">
                    <i class="fas fa-download"></i> Descargar PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Jarvis AI Assistant -->
    <div class="jarvis-container">
        <button class="jarvis-btn" id="jarvisButton">
            <i class="fas fa-robot"></i>
        </button>
        <div class="jarvis-chat" id="jarvisChat">
            <div class="jarvis-header">
                <div>
                    <h3><i class="fas fa-robot"></i> Jarvis</h3>
                    <p>Asistente Inteligente</p>
                </div>
                <button class="modal-close" id="closeJarvis">&times;</button>
            </div>
            <div class="jarvis-messages" id="jarvisMessages">
                <div class="message jarvis">
                    ¡Hola! Soy Jarvis, tu asistente inteligente. ¿En qué puedo ayudarte hoy?
                </div>
            </div>
            <div class="jarvis-input">
                <input type="text" id="jarvisInput" placeholder="Escribe tu mensaje...">
                <button id="sendJarvis">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Voice Command Key -->
    <div class="voice-key">
        <button class="voice-key-btn" id="voiceKeyBtn" title="Presiona F2 para activar voz">
            <i class="fas fa-microphone"></i>
        </button>
    </div>

    <script>
        // =============================================
        // SISTEMA DE USUARIOS Y LOGIN
        // =============================================

        // Sistema de gestión de usuarios
        const UserSystem = {
            init: function() {
                if (!localStorage.getItem('stark_users')) {
                    // No hay usuarios por defecto
                    localStorage.setItem('stark_users', JSON.stringify([]));
                }
            },

            getUsers: function() {
                return JSON.parse(localStorage.getItem('stark_users')) || [];
            },

            saveUsers: function(users) {
                localStorage.setItem('stark_users', JSON.stringify(users));
            },

            authenticate: function(username, password) {
                const users = this.getUsers();
                return users.find(user => 
                    user.username === username && user.password === password
                );
            },

            register: function(username, password, role) {
                const users = this.getUsers();
                
                if (users.length >= 3) {
                    return { success: false, message: 'Límite de usuarios alcanzado (máximo 3)' };
                }
                
                if (users.some(user => user.username === username)) {
                    return { success: false, message: 'El usuario ya existe' };
                }
                
                if (password.length < 6) {
                    return { success: false, message: 'La contraseña debe tener al menos 6 caracteres' };
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    role: role,
                    created: new Date().toISOString(),
                    avatar: username.charAt(0).toUpperCase()
                };
                
                users.push(newUser);
                this.saveUsers(users);
                
                return { success: true, message: 'Usuario registrado exitosamente' };
            },

            deleteUser: function(id) {
                const users = this.getUsers();
                const filtered = users.filter(user => user.id !== id);
                this.saveUsers(filtered);
                return filtered;
            }
        };

        // Inicializar sistema de usuarios
        UserSystem.init();

        // =============================================
        // SISTEMA DE LOGIN Y REGISTRO
        // =============================================

        // Elementos del login
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const btnLogin = document.getElementById('btn-login');

        // Elementos del registro
        const registerUsername = document.getElementById('register-username');
        const registerPassword = document.getElementById('register-password');
        const registerConfirmPassword = document.getElementById('register-confirm-password');
        const registerRole = document.getElementById('register-role');
        const btnRegister = document.getElementById('btn-register');
        const userLimitMessage = document.getElementById('user-limit-message');

        // Evento de login
        btnLogin.addEventListener('click', function() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value;
            
            if (!username || !password) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            const user = UserSystem.authenticate(username, password);
            
            if (user) {
                loginSuccessful(user);
            } else {
                showNotification('Usuario o contraseña incorrectos', 'error');
            }
        });

        // Evento de registro
        btnRegister.addEventListener('click', function() {
            const username = registerUsername.value.trim();
            const password = registerPassword.value;
            const confirmPassword = registerConfirmPassword.value;
            const role = registerRole.value;
            
            if (!username || !password || !confirmPassword) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Las contraseñas no coinciden', 'error');
                return;
            }
            
            const result = UserSystem.register(username, password, role);
            
            if (result.success) {
                showNotification(result.message, 'success');
                registerUsername.value = '';
                registerPassword.value = '';
                registerConfirmPassword.value = '';
                updateUserLimitMessage();
                
                // Si es el primer usuario, iniciar sesión automáticamente
                if (UserSystem.getUsers().length === 1) {
                    loginSuccessful(UserSystem.getUsers()[0]);
                }
            } else {
                showNotification(result.message, 'error');
            }
        });

        // Actualizar mensaje de límite de usuarios
        function updateUserLimitMessage() {
            const users = UserSystem.getUsers();
            if (users.length >= 3) {
                userLimitMessage.classList.remove('d-none');
            } else {
                userLimitMessage.classList.add('d-none');
            }
        }

        updateUserLimitMessage();

        // Función para login exitoso
        function loginSuccessful(user) {
            document.getElementById('screen-login').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'flex';
            
            document.getElementById('currentUserName').textContent = user.username;
            document.getElementById('currentUserRole').textContent = user.role === 'admin' ? 'Administrador' : 'Vendedor';
            document.getElementById('userAvatar').textContent = user.avatar;
            
            initApp();
            
            showNotification(`¡Bienvenido ${user.username}! Sistema cargado correctamente`, 'success');
        }

        // =============================================
        // SISTEMA DE NAVEGACIÓN
        // =============================================

        function showPage(pageId) {
            // Ocultar todas las páginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostrar página seleccionada
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Actualizar menú activo
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[data-page="${pageId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // Actualizar título
            const titles = {
                dashboard: "Dashboard",
                barberia: "Barbería",
                billar: "Billar - Sistema POS", 
                carwash: "Car Wash",
                "config-usuarios": "Configuración - Usuarios",
                "config-servicios": "Configuración - Servicios",
                "config-productos": "Configuración - Productos",
                "config-empleados": "Configuración - Empleados",
                "config-impresora": "Configuración - Impresora",
                "config-tema": "Configuración - Tema",
                "config-jarvis": "Configuración Jarvis"
            };
            
            document.getElementById('headerTitle').textContent = titles[pageId] || "STARK CLEANE";
            
            // Cargar datos específicos de la página
            if (pageId === 'barberia') {
                loadBarberiaServices();
                loadBarberiaClients();
                loadBarberiaHistory();
                loadBarberiaAppointments();
            } else if (pageId === 'carwash') {
                loadCarwashServices();
                loadCarwashVehicles();
                loadCarwashHistory();
                loadCarwashEmployees();
            } else if (pageId === 'config-servicios') {
                loadConfigServices();
            } else if (pageId === 'config-productos') {
                loadConfigProducts();
                loadBillarProducts();
            } else if (pageId === 'config-usuarios') {
                loadConfigUsers();
            } else if (pageId === 'config-empleados') {
                loadConfigEmployees();
            } else if (pageId === 'billar') {
                loadBillarProducts();
                loadBillarSales();
                loadBillarReports();
            }
        }

        // =============================================
        // SISTEMA DE PESTAÑAS
        // =============================================

        function setupTabs() {
            // Pestañas principales
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const container = this.closest('.tabs').parentElement;
                    
                    // Remover activo de todas las pestañas
                    this.parentElement.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Agregar activo a la pestaña clickeada
                    this.classList.add('active');
                    
                    // Ocultar todos los contenidos
                    container.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Mostrar contenido correspondiente
                    const targetContent = document.getElementById(tabId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
            
            // Pestañas de configuración
            document.querySelectorAll('.config-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-config-tab');
                    
                    // Remover activo de todas las pestañas
                    this.parentElement.querySelectorAll('.config-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Agregar activo a la pestaña clickeada
                    this.classList.add('active');
                    
                    // Ocultar todos los contenidos
                    document.querySelectorAll('#config-servicios .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Mostrar contenido correspondiente
                    const targetContent = document.getElementById(tabId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
        }

        // =============================================
        // SISTEMA DE NOTIFICACIONES
        // =============================================

        function showNotification(message, type = "success") {
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === "success" ? "check-circle" : type === "error" ? "exclamation-circle" : type === "warning" ? "exclamation-triangle" : "info-circle"}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // =============================================
        // SISTEMA DE ALERTAS EN TIEMPO REAL
        // =============================================

        // Sistema de alertas automáticas
        const AlertSystem = {
            lowStockAlertShown: [],
            appointmentAlertShown: [],
            
            checkLowStock: function() {
                const products = DB.get('productos');
                const lowStockProducts = products.filter(p => p.stock <= 5 && p.stock > 0);
                
                lowStockProducts.forEach(product => {
                    if (!this.lowStockAlertShown.includes(product.id)) {
                        showNotification(`⚠️ Producto con stock bajo: ${product.nombre} (${product.stock} unidades)`, 'warning');
                        this.lowStockAlertShown.push(product.id);
                        
                        // También mostrar en el dashboard
                        this.showDashboardAlert('inventory', product);
                    }
                });
                
                // Limpiar alertas de productos que ya no están bajos
                this.lowStockAlertShown = this.lowStockAlertShown.filter(id => {
                    const product = products.find(p => p.id === id);
                    return product && product.stock <= 5;
                });
            },
            
            checkUpcomingAppointments: function() {
                const today = new Date().toDateString();
                const appointments = DB.get('barberia_appointments');
                const todayAppointments = appointments.filter(a => 
                    new Date(a.fecha).toDateString() === today && 
                    a.estado === 'pendiente'
                );
                
                const now = new Date();
                
                todayAppointments.forEach(appointment => {
                    const appointmentTime = new Date(`${appointment.fecha}T${appointment.hora}`);
                    const diffMinutes = (appointmentTime - now) / (1000 * 60);
                    
                    if (diffMinutes > 0 && diffMinutes <= 15) {
                        if (!this.appointmentAlertShown.includes(appointment.id)) {
                            showNotification(`⏰ Cita próxima: ${appointment.cliente} a las ${appointment.hora}`, 'info');
                            this.appointmentAlertShown.push(appointment.id);
                            
                            // También mostrar en el dashboard
                            this.showDashboardAlert('appointment', appointment);
                        }
                    }
                });
                
                // Limpiar alertas de citas pasadas
                this.appointmentAlertShown = this.appointmentAlertShown.filter(id => {
                    const appointment = appointments.find(a => a.id === id);
                    if (!appointment) return false;
                    
                    const appointmentTime = new Date(`${appointment.fecha}T${appointment.hora}`);
                    const diffMinutes = (appointmentTime - now) / (1000 * 60);
                    return diffMinutes > 0 && diffMinutes <= 15;
                });
            },
            
            showDashboardAlert: function(type, data) {
                const alertsContainer = document.getElementById('liveAlerts');
                if (!alertsContainer) return;
                
                let alertHtml = '';
                
                if (type === 'inventory') {
                    alertHtml = `
                        <div class="notification warning" style="position: relative; margin-bottom: 10px;">
                            <div class="notification-content">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Stock bajo: ${data.nombre} (${data.stock} unidades)</span>
                            </div>
                        </div>
                    `;
                } else if (type === 'appointment') {
                    alertHtml = `
                        <div class="notification info" style="position: relative; margin-bottom: 10px;">
                            <div class="notification-content">
                                <i class="fas fa-clock"></i>
                                <span>Cita próxima: ${data.cliente} a las ${data.hora}</span>
                            </div>
                        </div>
                    `;
                }
                
                // Verificar si ya existe una alerta similar
                const existingAlert = alertsContainer.querySelector(`[data-id="${data.id}"]`);
                if (!existingAlert) {
                    const alertDiv = document.createElement('div');
                    alertDiv.setAttribute('data-id', data.id);
                    alertDiv.innerHTML = alertHtml;
                    alertsContainer.appendChild(alertDiv);
                    
                    // Auto-remover después de 5 minutos
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.parentNode.removeChild(alertDiv);
                        }
                    }, 300000);
                }
            },
            
            clearAlerts: function() {
                this.lowStockAlertShown = [];
                this.appointmentAlertShown = [];
                const alertsContainer = document.getElementById('liveAlerts');
                if (alertsContainer) {
                    alertsContainer.innerHTML = '';
                }
            }
        };

        // =============================================
        // SISTEMA DE BASE DE DATOS LOCAL
        // =============================================

        const DB = {
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch (error) {
                    return [];
                }
            },

            set: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    return false;
                }
            },

            add: (key, item) => {
                const data = DB.get(key);
                item.id = Date.now();
                data.push(item);
                return DB.set(key, data) ? item.id : null;
            },

            update: (key, id, updates) => {
                const data = DB.get(key);
                const index = data.findIndex(item => item.id === id);
                if (index !== -1) {
                    data[index] = { ...data[index], ...updates };
                    return DB.set(key, data);
                }
                return false;
            },

            delete: (key, id) => {
                const data = DB.get(key);
                const filtered = data.filter(item => item.id !== id);
                return DB.set(key, filtered);
            }
        };

        // =============================================
        // SISTEMA DE BARBERÍA MEJORADO
        // =============================================

        // Cargar servicios de barbería
        function loadBarberiaServices() {
            const services = DB.get('barberia_services');
            const grid = document.getElementById('barberia-services-grid');
            
            if (!grid) return;
            
            grid.innerHTML = '';
            
            services.forEach(service => {
                const serviceCard = document.createElement('div');
                serviceCard.className = 'service-card';
                serviceCard.innerHTML = `
                    <h4>${service.nombre}</h4>
                    <p>RD$ ${service.precio}</p>
                    <small>${service.descripcion || ''}</small>
                `;
                
                serviceCard.addEventListener('click', function() {
                    addToCartBarberia(service.id, service.nombre, service.precio, service.descripcion || '');
                    showNotification(`Servicio agregado: ${service.nombre}`, 'success');
                });
                
                grid.appendChild(serviceCard);
            });
            
            if (services.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">No hay servicios configurados. Agrega servicios en Configuración.</p>';
            }
        }

        // Cargar clientes de barbería
        function loadBarberiaClients() {
            const clients = DB.get('barberia_clients');
            const table = document.getElementById('clientsTable');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            clients.forEach(client => {
                const row = document.createElement('tr');
                const totalGastado = client.ventas ? client.ventas.reduce((sum, venta) => sum + venta.total, 0) : 0;
                
                row.innerHTML = `
                    <td>${client.nombre}</td>
                    <td>${client.telefono || '-'}</td>
                    <td>${new Date(client.ultimaVisita).toLocaleDateString()}</td>
                    <td>RD$ ${totalGastado}</td>
                    <td>${client.servicios || 0} servicios</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="editClient(${client.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Cargar historial de barbería
        function loadBarberiaHistory() {
            const sales = DB.get('barberia_sales');
            const table = document.getElementById('barberiaHistoryTable');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(sale.fecha).toLocaleString()}</td>
                    <td>${sale.cliente || 'Cliente no registrado'}</td>
                    <td>${sale.servicios}</td>
                    <td>RD$ ${sale.total}</td>
                    <td>${sale.metodo_pago}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewSale(${sale.id}, 'barberia')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="reprintInvoice(${sale.id}, 'barberia')">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Cargar citas de barbería
        function loadBarberiaAppointments() {
            const appointments = DB.get('barberia_appointments');
            const servicioSelect = document.getElementById('servicio-cita');
            const barberoSelect = document.getElementById('barbero-cita');
            
            // Cargar servicios en select
            const services = DB.get('barberia_services');
            servicioSelect.innerHTML = '<option value="">Seleccione un servicio</option>';
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = `${service.nombre} - RD$ ${service.precio}`;
                servicioSelect.appendChild(option);
            });
            
            // Cargar empleados en select
            const employees = DB.get('empleados');
            barberoSelect.innerHTML = '<option value="">Seleccione un barbero</option>';
            employees.forEach(employee => {
                if (employee.cargo === 'barbero') {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.nombre;
                    barberoSelect.appendChild(option);
                }
            });
        }

        // =============================================
        // SISTEMA DE CARRITO DE BARBERÍA
        // =============================================

        let cartBarberia = [];

        function addToCartBarberia(id, name, price, description) {
            const existingItem = cartBarberia.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartBarberia.push({
                    id: id,
                    name: name,
                    price: parseFloat(price),
                    description: description,
                    quantity: 1
                });
            }
            
            updateCartUIBarberia();
        }

        function updateCartUIBarberia() {
            const cartItems = document.getElementById('cartItemsBarberia');
            const cartCount = document.getElementById('cartCountBarberia');
            const cartTotal = document.getElementById('cartTotalBarberia');
            
            cartItems.innerHTML = '';
            let total = 0;

            cartBarberia.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                        ${item.description ? `<small style="color: var(--text-secondary);">${item.description}</small>` : ''}
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                    </div>
                    <div>RD$ ${itemTotal}</div>
                `;
                cartItems.appendChild(cartItem);
            });

            cartCount.textContent = `${cartBarberia.length} servicios`;
            cartTotal.textContent = `Total: RD$ ${total}`;

            // Event listeners para botones de cantidad
            document.querySelectorAll('#cartItemsBarberia .quantity-btn.increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const item = cartBarberia.find(item => item.id === productId);
                    if (item) {
                        item.quantity++;
                        updateCartUIBarberia();
                        updateChangeBarberia();
                    }
                });
            });

            document.querySelectorAll('#cartItemsBarberia .quantity-btn.decrease').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const item = cartBarberia.find(item => item.id === productId);
                    if (item && item.quantity > 1) {
                        item.quantity--;
                        updateCartUIBarberia();
                        updateChangeBarberia();
                    } else if (item && item.quantity === 1) {
                        cartBarberia = cartBarberia.filter(i => i.id !== productId);
                        updateCartUIBarberia();
                        updateChangeBarberia();
                    }
                });
            });

            updateChangeBarberia();
        }

        function getCartTotalBarberia() {
            return cartBarberia.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function updateChangeBarberia() {
            const total = getCartTotalBarberia();
            const efectivo = parseFloat(document.getElementById('efectivo-recibido-barberia').value) || 0;
            const cambio = efectivo - total;
            
            const cambioDisplay = document.getElementById('cambio-display-barberia');
            const validation = document.getElementById('paymentValidationBarberia');
            
            if (cambio >= 0) {
                cambioDisplay.textContent = `Cambio: RD$ ${cambio}`;
                cambioDisplay.style.color = "var(--accent)";
                validation.classList.remove('show');
            } else {
                cambioDisplay.textContent = `Faltan: RD$ ${Math.abs(cambio)}`;
                cambioDisplay.style.color = "var(--danger)";
                validation.classList.add('show');
            }
        }

        // =============================================
        // SISTEMA DE BILLAR MEJORADO
        // =============================================

        // Cargar productos de billar
        function loadBillarProducts() {
            const products = DB.get('productos');
            const grid = document.getElementById('productsGrid');
            const table = document.getElementById('productsTable');
            
            // Cargar en grid (POS)
            if (grid) {
                grid.innerHTML = '';
                
                products.forEach(product => {
                    if (product.stock > 0) {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.setAttribute('data-id', product.id);
                        productCard.innerHTML = `
                            <div class="product-image">
                                <i class="fas fa-box"></i>
                            </div>
                            <h4>${product.nombre}</h4>
                            <p>RD$ ${product.precio_venta}</p>
                            <small>Stock: ${product.stock}</small>
                        `;
                        
                        productCard.addEventListener('click', function() {
                            addToCart(product.id, product.nombre, product.precio_venta);
                        });
                        
                        grid.appendChild(productCard);
                    }
                });
                
                if (products.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">No hay productos configurados. Agrega productos en Configuración.</p>';
                }
            }
            
            // Cargar en tabla (Inventario)
            if (table) {
                table.innerHTML = '';
                
                products.forEach(product => {
                    const row = document.createElement('tr');
                    const estado = product.stock <= 0 ? 'danger' : (product.stock <= 5 ? 'warning' : 'success');
                    const estadoText = product.stock <= 0 ? 'Sin stock' : (product.stock <= 5 ? 'Bajo stock' : 'Disponible');
                    
                    row.innerHTML = `
                        <td>${product.codigo || '-'}</td>
                        <td>${product.nombre}</td>
                        <td>${product.categoria}</td>
                        <td>RD$ ${product.precio_compra}</td>
                        <td>RD$ ${product.precio_venta}</td>
                        <td>${product.stock}</td>
                        <td><span class="badge badge-${estado}">${estadoText}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
        }

        // Cargar ventas de billar
        function loadBillarSales() {
            const sales = DB.get('billar_sales');
            const table = document.getElementById('salesTable');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(sale.fecha).toLocaleTimeString()}</td>
                    <td>RD$ ${sale.total}</td>
                    <td>${sale.productos}</td>
                    <td>${sale.metodo_pago}</td>
                    <td>${sale.rnc || 'Consumidor Final'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewSale(${sale.id}, 'billar')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Cargar reportes de billar
        function loadBillarReports() {
            // Esta función se llama cuando se abre la pestaña de reportes
            // Los datos se cargan dinámicamente al generar el reporte
        }

        // =============================================
        // SISTEMA DE CARRITO DE BILLAR
        // =============================================

        let cart = [];

        function addToCart(id, name, price) {
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: parseFloat(price),
                    quantity: 1
                });
            }
            
            updateCartUI();
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartTotal = document.getElementById('cartTotal');
            
            cartItems.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                    </div>
                    <div>RD$ ${itemTotal}</div>
                `;
                cartItems.appendChild(cartItem);
            });

            cartCount.textContent = `${cart.length} productos`;
            cartTotal.textContent = `Total: RD$ ${total}`;

            // Event listeners para botones de cantidad
            document.querySelectorAll('.quantity-btn.increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        item.quantity++;
                        updateCartUI();
                        updateChange();
                    }
                });
            });

            document.querySelectorAll('.quantity-btn.decrease').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const item = cart.find(item => item.id === productId);
                    if (item && item.quantity > 1) {
                        item.quantity--;
                        updateCartUI();
                        updateChange();
                    } else if (item && item.quantity === 1) {
                        cart = cart.filter(i => i.id !== productId);
                        updateCartUI();
                        updateChange();
                    }
                });
            });

            updateChange();
        }

        function getCartTotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function updateChange() {
            const total = getCartTotal();
            const efectivo = parseFloat(document.getElementById('efectivo-recibido').value) || 0;
            const cambio = efectivo - total;
            
            const cambioDisplay = document.getElementById('cambio-display');
            const validation = document.getElementById('paymentValidation');
            
            if (cambio >= 0) {
                cambioDisplay.textContent = `Cambio: RD$ ${cambio}`;
                cambioDisplay.style.color = "var(--accent)";
                validation.classList.remove('show');
            } else {
                cambioDisplay.textContent = `Faltan: RD$ ${Math.abs(cambio)}`;
                cambioDisplay.style.color = "var(--danger)";
                validation.classList.add('show');
            }
        }

        // =============================================
        // SISTEMA DE CAR WASH MEJORADO
        // =============================================

        // Cargar servicios de car wash
        function loadCarwashServices() {
            const services = DB.get('carwash_services');
            const grid = document.getElementById('carwash-services-grid');
            
            if (!grid) return;
            
            grid.innerHTML = '';
            
            services.forEach(service => {
                const serviceCard = document.createElement('div');
                serviceCard.className = 'service-card';
                serviceCard.innerHTML = `
                    <h4>${service.nombre}</h4>
                    <p>RD$ ${service.precio}</p>
                    <small>${service.descripcion || ''}</small>
                `;
                
                serviceCard.addEventListener('click', function() {
                    addToCartCarwash(service.id, service.nombre, service.precio, service.descripcion || '');
                    showNotification(`Servicio agregado: ${service.nombre}`, 'success');
                });
                
                grid.appendChild(serviceCard);
            });
            
            if (services.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">No hay servicios configurados. Agrega servicios en Configuración.</p>';
            }
        }

        // Cargar vehículos de car wash
        function loadCarwashVehicles() {
            const vehicles = DB.get('carwash_vehicles');
            const grid = document.getElementById('vehiclesGrid');
            const table = document.getElementById('completedVehiclesTable');
            const select = document.getElementById('vehiculo-servicio');
            
            // Cargar en grid (Vehículos en proceso)
            if (grid) {
                grid.innerHTML = '';
                
                const activeVehicles = vehicles.filter(v => v.estado === 'proceso');
                
                activeVehicles.forEach(vehicle => {
                    const vehicleCard = document.createElement('div');
                    vehicleCard.className = 'vehicle-card';
                    vehicleCard.innerHTML = `
                        <div class="vehicle-header">
                            <div class="vehicle-placa">${vehicle.placa}</div>
                            <span class="vehicle-type ${vehicle.tipo}">${vehicle.tipo}</span>
                        </div>
                        <div class="vehicle-details">
                            <div class="vehicle-detail">
                                <span>Cliente:</span>
                                <span>${vehicle.cliente}</span>
                            </div>
                            <div class="vehicle-detail">
                                <span>Teléfono:</span>
                                <span>${vehicle.telefono || '-'}</span>
                            </div>
                            <div class="vehicle-detail">
                                <span>Empleado:</span>
                                <span>${vehicle.empleado_nombre || 'No asignado'}</span>
                            </div>
                        </div>
                        <div class="vehicle-time">
                            <i class="fas fa-clock"></i>
                            <span>Entrada: ${new Date(vehicle.entrada).toLocaleTimeString()}</span>
                        </div>
                        <div class="action-buttons" style="margin-top: 15px;">
                            <button class="btn btn-sm btn-success" onclick="completeVehicle(${vehicle.id})">
                                <i class="fas fa-check"></i> Completar
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="addServicesToVehicle(${vehicle.id})">
                                <i class="fas fa-plus"></i> Agregar Servicios
                            </button>
                        </div>
                    `;
                    grid.appendChild(vehicleCard);
                });
                
                if (activeVehicles.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">No hay vehículos en proceso.</p>';
                }
            }
            
            // Cargar en tabla (Vehículos entregados)
            if (table) {
                table.innerHTML = '';
                
                const completedVehicles = vehicles.filter(v => v.estado === 'completado');
                
                completedVehicles.forEach(vehicle => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${vehicle.placa}</td>
                        <td>${vehicle.tipo}</td>
                        <td>${vehicle.cliente}</td>
                        <td>${vehicle.servicios || 'Sin servicios'}</td>
                        <td>RD$ ${vehicle.total || 0}</td>
                        <td>${new Date(vehicle.entrada).toLocaleTimeString()}</td>
                        <td>${vehicle.salida ? new Date(vehicle.salida).toLocaleTimeString() : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="viewVehicle(${vehicle.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
            
            // Cargar en select
            if (select) {
                select.innerHTML = '<option value="">Seleccione un vehículo</option>';
                const activeVehicles = vehicles.filter(v => v.estado === 'proceso');
                activeVehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.id;
                    option.textContent = `${vehicle.placa} - ${vehicle.cliente}`;
                    select.appendChild(option);
                });
            }
        }

        // Cargar empleados de car wash
        function loadCarwashEmployees() {
            const employees = DB.get('empleados');
            const select = document.getElementById('empleado-vehiculo');
            
            if (!select) return;
            
            select.innerHTML = '<option value="">Seleccione un empleado</option>';
            
            employees.forEach(employee => {
                if (employee.cargo === 'lavador') {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.nombre;
                    select.appendChild(option);
                }
            });
        }

        // Cargar historial de car wash
        function loadCarwashHistory() {
            const sales = DB.get('carwash_sales');
            const table = document.getElementById('carwashHistoryTable');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(sale.fecha).toLocaleDateString()}</td>
                    <td>${sale.vehiculo}</td>
                    <td>${sale.tipo}</td>
                    <td>${sale.servicios}</td>
                    <td>RD$ ${sale.total}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewSale(${sale.id}, 'carwash')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // =============================================
        // SISTEMA DE CARRITO DE CAR WASH
        // =============================================

        let cartCarwash = [];

        function addToCartCarwash(id, name, price, description) {
            const existingItem = cartCarwash.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartCarwash.push({
                    id: id,
                    name: name,
                    price: parseFloat(price),
                    description: description,
                    quantity: 1
                });
            }
            
            updateCartUICarwash();
        }

        function updateCartUICarwash() {
            const cartItems = document.getElementById('cartItemsCarwash');
            const cartCount = document.getElementById('cartCountCarwash');
            const cartTotal = document.getElementById('cartTotalCarwash');
            
            cartItems.innerHTML = '';
            let total = 0;

            cartCarwash.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                        ${item.description ? `<small style="color: var(--text-secondary);">${item.description}</small>` : ''}
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                    </div>
                    <div>RD$ ${itemTotal}</div>
                `;
                cartItems.appendChild(cartItem);
            });

            cartCount.textContent = `${cartCarwash.length} servicios`;
            cartTotal.textContent = `Total: RD$ ${total}`;

            // Event listeners para botones de cantidad
            document.querySelectorAll('#cartItemsCarwash .quantity-btn.increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const item = cartCarwash.find(item => item.id === productId);
                    if (item) {
                        item.quantity++;
                        updateCartUICarwash();
                        updateChangeCarwash();
                    }
                });
            });

            document.querySelectorAll('#cartItemsCarwash .quantity-btn.decrease').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const item = cartCarwash.find(item => item.id === productId);
                    if (item && item.quantity > 1) {
                        item.quantity--;
                        updateCartUICarwash();
                        updateChangeCarwash();
                    } else if (item && item.quantity === 1) {
                        cartCarwash = cartCarwash.filter(i => i.id !== productId);
                        updateCartUICarwash();
                        updateChangeCarwash();
                    }
                });
            });

            updateChangeCarwash();
        }

        function getCartTotalCarwash() {
            return cartCarwash.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function updateChangeCarwash() {
            const total = getCartTotalCarwash();
            const efectivo = parseFloat(document.getElementById('efectivo-recibido-carwash').value) || 0;
            const cambio = efectivo - total;
            
            const cambioDisplay = document.getElementById('cambio-display-carwash');
            const validation = document.getElementById('paymentValidationCarwash');
            
            if (cambio >= 0) {
                cambioDisplay.textContent = `Cambio: RD$ ${cambio}`;
                cambioDisplay.style.color = "var(--accent)";
                validation.classList.remove('show');
            } else {
                cambioDisplay.textContent = `Faltan: RD$ ${Math.abs(cambio)}`;
                cambioDisplay.style.color = "var(--danger)";
                validation.classList.add('show');
            }
        }

        // =============================================
        // SISTEMA DE CONFIGURACIÓN
        // =============================================

        // Cargar servicios en configuración
        function loadConfigServices() {
            // Barbería
            const barberiaServices = DB.get('barberia_services');
            const barberiaLista = document.getElementById('barberia-servicios-lista');
            
            if (barberiaLista) {
                barberiaLista.innerHTML = '';
                
                barberiaServices.forEach(service => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${service.nombre}</td>
                        <td>RD$ ${service.precio}</td>
                        <td>${service.descripcion || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editBarberiaService(${service.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBarberiaService(${service.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    barberiaLista.appendChild(row);
                });
            }
            
            // Car Wash
            const carwashServices = DB.get('carwash_services');
            const carwashLista = document.getElementById('carwash-servicios-lista');
            
            if (carwashLista) {
                carwashLista.innerHTML = '';
                
                carwashServices.forEach(service => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${service.nombre}</td>
                        <td>RD$ ${service.precio}</td>
                        <td>${service.descripcion || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editCarwashService(${service.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCarwashService(${service.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    carwashLista.appendChild(row);
                });
            }
        }

        // Cargar productos en configuración
        function loadConfigProducts() {
            const productos = DB.get('productos');
            const productosLista = document.getElementById('productos-lista');
            
            if (productosLista) {
                productosLista.innerHTML = '';
                
                productos.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.nombre}</td>
                        <td>${product.codigo || '-'}</td>
                        <td>RD$ ${product.precio_compra}</td>
                        <td>RD$ ${product.precio_venta}</td>
                        <td>${product.stock}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    productosLista.appendChild(row);
                });
            }
        }

        // Cargar usuarios en configuración
        function loadConfigUsers() {
            const users = UserSystem.getUsers();
            const usersTable = document.getElementById('usersTable');
            
            if (!usersTable) return;
            
            usersTable.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.role === 'admin' ? 'Administrador' : 'Vendedor'}</td>
                    <td>${new Date(user.created).toLocaleDateString()}</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})" ${users.length <= 1 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                usersTable.appendChild(row);
            });
        }

        // Cargar empleados en configuración
        function loadConfigEmployees() {
            const employees = DB.get('empleados');
            const grid = document.getElementById('employeesGrid');
            
            if (!grid) return;
            
            grid.innerHTML = '';
            
            employees.forEach(employee => {
                const employeeCard = document.createElement('div');
                employeeCard.className = 'employee-card';
                employeeCard.innerHTML = `
                    <div class="employee-header">
                        <div class="employee-avatar">${employee.nombre.charAt(0)}</div>
                        <div>
                            <h4>${employee.nombre}</h4>
                            <p>${employee.cargo}</p>
                        </div>
                    </div>
                    <div class="vehicle-details">
                        <div class="vehicle-detail">
                            <span>Cédula:</span>
                            <span>${employee.cedula || '-'}</span>
                        </div>
                        <div class="vehicle-detail">
                            <span>Teléfono:</span>
                            <span>${employee.telefono || '-'}</span>
                        </div>
                        <div class="vehicle-detail">
                            <span>Sueldo:</span>
                            <span>RD$ ${employee.sueldo || '0'}</span>
                        </div>
                    </div>
                    <div class="action-buttons" style="margin-top: 15px;">
                        <button class="btn btn-sm btn-outline" onclick="editEmployee(${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(employeeCard);
            });
            
            if (employees.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">No hay empleados registrados.</p>';
            }
        }

        // =============================================
        // FUNCIONES DE EDICIÓN Y ELIMINACIÓN
        // =============================================

        // Funciones para barbería
        function editBarberiaService(id) {
            const services = DB.get('barberia_services');
            const service = services.find(s => s.id === id);
            
            if (service) {
                document.getElementById('servicio-barberia-nombre').value = service.nombre;
                document.getElementById('servicio-barberia-precio').value = service.precio;
                document.getElementById('servicio-barberia-descripcion').value = service.descripcion || '';
                
                // Cambiar texto del botón
                const btn = document.getElementById('agregar-servicio-barberia');
                btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Servicio';
                btn.onclick = function() {
                    updateBarberiaService(id);
                };
            }
        }

        function updateBarberiaService(id) {
            const services = DB.get('barberia_services');
            const index = services.findIndex(s => s.id === id);
            
            if (index !== -1) {
                services[index] = {
                    ...services[index],
                    nombre: document.getElementById('servicio-barberia-nombre').value.trim(),
                    precio: parseFloat(document.getElementById('servicio-barberia-precio').value),
                    descripcion: document.getElementById('servicio-barberia-descripcion').value.trim()
                };
                
                DB.set('barberia_services', services);
                showNotification('Servicio actualizado', 'success');
                
                // Restaurar botón
                const btn = document.getElementById('agregar-servicio-barberia');
                btn.innerHTML = '<i class="fas fa-plus"></i> Agregar Servicio';
                btn.onclick = function() {
                    addNewBarberiaService();
                };
                
                // Limpiar formulario
                document.getElementById('servicio-barberia-nombre').value = '';
                document.getElementById('servicio-barberia-precio').value = '';
                document.getElementById('servicio-barberia-descripcion').value = '';
                
                // Recargar datos
                loadConfigServices();
                loadBarberiaServices();
            }
        }

        function deleteBarberiaService(id) {
            if (confirm('¿Está seguro de eliminar este servicio?')) {
                DB.delete('barberia_services', id);
                showNotification('Servicio eliminado', 'success');
                loadConfigServices();
                loadBarberiaServices();
            }
        }

        function addNewBarberiaService() {
            const nombre = document.getElementById('servicio-barberia-nombre').value.trim();
            const precio = document.getElementById('servicio-barberia-precio').value;
            const descripcion = document.getElementById('servicio-barberia-descripcion').value.trim();
            
            if (!nombre || !precio) {
                showNotification('Por favor ingrese nombre y precio del servicio', 'error');
                return;
            }
            
            const servicio = {
                nombre: nombre,
                precio: parseFloat(precio),
                descripcion: descripcion
            };
            
            DB.add('barberia_services', servicio);
            showNotification('Servicio de barbería agregado', 'success');
            
            // Limpiar formulario
            document.getElementById('servicio-barberia-nombre').value = '';
            document.getElementById('servicio-barberia-precio').value = '';
            document.getElementById('servicio-barberia-descripcion').value = '';
            
            // Actualizar lista
            loadConfigServices();
            loadBarberiaServices();
        }

        // Funciones para car wash
        function editCarwashService(id) {
            const services = DB.get('carwash_services');
            const service = services.find(s => s.id === id);
            
            if (service) {
                document.getElementById('servicio-carwash-nombre').value = service.nombre;
                document.getElementById('servicio-carwash-precio').value = service.precio;
                document.getElementById('servicio-carwash-descripcion').value = service.descripcion || '';
                
                // Cambiar texto del botón
                const btn = document.getElementById('agregar-servicio-carwash');
                btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Servicio';
                btn.onclick = function() {
                    updateCarwashService(id);
                };
            }
        }

        function updateCarwashService(id) {
            const services = DB.get('carwash_services');
            const index = services.findIndex(s => s.id === id);
            
            if (index !== -1) {
                services[index] = {
                    ...services[index],
                    nombre: document.getElementById('servicio-carwash-nombre').value.trim(),
                    precio: parseFloat(document.getElementById('servicio-carwash-precio').value),
                    descripcion: document.getElementById('servicio-carwash-descripcion').value.trim()
                };
                
                DB.set('carwash_services', services);
                showNotification('Servicio actualizado', 'success');
                
                // Restaurar botón
                const btn = document.getElementById('agregar-servicio-carwash');
                btn.innerHTML = '<i class="fas fa-plus"></i> Agregar Servicio';
                btn.onclick = function() {
                    addNewCarwashService();
                };
                
                // Limpiar formulario
                document.getElementById('servicio-carwash-nombre').value = '';
                document.getElementById('servicio-carwash-precio').value = '';
                document.getElementById('servicio-carwash-descripcion').value = '';
                
                // Recargar datos
                loadConfigServices();
                loadCarwashServices();
            }
        }

        function deleteCarwashService(id) {
            if (confirm('¿Está seguro de eliminar este servicio?')) {
                DB.delete('carwash_services', id);
                showNotification('Servicio eliminado', 'success');
                loadConfigServices();
                loadCarwashServices();
            }
        }

        function addNewCarwashService() {
            const nombre = document.getElementById('servicio-carwash-nombre').value.trim();
            const precio = document.getElementById('servicio-carwash-precio').value;
            const descripcion = document.getElementById('servicio-carwash-descripcion').value.trim();
            
            if (!nombre || !precio) {
                showNotification('Por favor ingrese nombre y precio del servicio', 'error');
                return;
            }
            
            const servicio = {
                nombre: nombre,
                precio: parseFloat(precio),
                descripcion: descripcion
            };
            
            DB.add('carwash_services', servicio);
            showNotification('Servicio de car wash agregado', 'success');
            
            // Limpiar formulario
            document.getElementById('servicio-carwash-nombre').value = '';
            document.getElementById('servicio-carwash-precio').value = '';
            document.getElementById('servicio-carwash-descripcion').value = '';
            
            // Actualizar lista
            loadConfigServices();
            loadCarwashServices();
        }

        // Funciones para productos
        function editProduct(id) {
            const products = DB.get('productos');
            const product = products.find(p => p.id === id);
            
            if (product) {
                document.getElementById('producto-nombre').value = product.nombre;
                document.getElementById('producto-codigo').value = product.codigo || '';
                document.getElementById('producto-precio-compra').value = product.precio_compra;
                document.getElementById('producto-precio-venta').value = product.precio_venta;
                document.getElementById('producto-stock').value = product.stock;
                document.getElementById('producto-categoria').value = product.categoria;
                
                // Cambiar texto del botón
                const btn = document.getElementById('agregar-producto');
                btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Producto';
                btn.onclick = function() {
                    updateProduct(id);
                };
            }
        }

        function updateProduct(id) {
            const products = DB.get('productos');
            const index = products.findIndex(p => p.id === id);
            
            if (index !== -1) {
                products[index] = {
                    ...products[index],
                    nombre: document.getElementById('producto-nombre').value.trim(),
                    codigo: document.getElementById('producto-codigo').value.trim(),
                    precio_compra: parseFloat(document.getElementById('producto-precio-compra').value),
                    precio_venta: parseFloat(document.getElementById('producto-precio-venta').value),
                    stock: parseInt(document.getElementById('producto-stock').value),
                    categoria: document.getElementById('producto-categoria').value
                };
                
                DB.set('productos', products);
                showNotification('Producto actualizado', 'success');
                
                // Restaurar botón
                const btn = document.getElementById('agregar-producto');
                btn.innerHTML = '<i class="fas fa-plus"></i> Agregar Producto';
                btn.onclick = function() {
                    addNewProduct();
                };
                
                // Limpiar formulario
                document.getElementById('producto-nombre').value = '';
                document.getElementById('producto-codigo').value = '';
                document.getElementById('producto-precio-compra').value = '';
                document.getElementById('producto-precio-venta').value = '';
                document.getElementById('producto-stock').value = '';
                
                // Recargar datos
                loadConfigProducts();
                loadBillarProducts();
            }
        }

        function deleteProduct(id) {
            if (confirm('¿Está seguro de eliminar este producto?')) {
                DB.delete('productos', id);
                showNotification('Producto eliminado', 'success');
                loadConfigProducts();
                loadBillarProducts();
            }
        }

        function addNewProduct() {
            const nombre = document.getElementById('producto-nombre').value.trim();
            const codigo = document.getElementById('producto-codigo').value.trim();
            const precioCompra = document.getElementById('producto-precio-compra').value;
            const precioVenta = document.getElementById('producto-precio-venta').value;
            const stock = document.getElementById('producto-stock').value;
            const categoria = document.getElementById('producto-categoria').value;
            
            if (!nombre || !precioCompra || !precioVenta || !stock) {
                showNotification('Por favor complete todos los campos obligatorios', 'error');
                return;
            }
            
            const producto = {
                nombre: nombre,
                codigo: codigo,
                precio_compra: parseFloat(precioCompra),
                precio_venta: parseFloat(precioVenta),
                stock: parseInt(stock),
                categoria: categoria
            };
            
            DB.add('productos', producto);
            showNotification('Producto agregado', 'success');
            
            // Limpiar formulario
            document.getElementById('producto-nombre').value = '';
            document.getElementById('producto-codigo').value = '';
            document.getElementById('producto-precio-compra').value = '';
            document.getElementById('producto-precio-venta').value = '';
            document.getElementById('producto-stock').value = '';
            
            // Actualizar lista
            loadConfigProducts();
            loadBillarProducts();
        }

        // Funciones para usuarios
        function deleteUser(id) {
            if (confirm('¿Está seguro de eliminar este usuario?')) {
                const users = UserSystem.deleteUser(id);
                showNotification('Usuario eliminado', 'success');
                loadConfigUsers();
            }
        }

        // Funciones para empleados
        function editEmployee(id) {
            const employees = DB.get('empleados');
            const employee = employees.find(e => e.id === id);
            
            if (employee) {
                document.getElementById('empleado-nombre').value = employee.nombre;
                document.getElementById('empleado-cedula').value = employee.cedula || '';
                document.getElementById('empleado-telefono').value = employee.telefono || '';
                document.getElementById('empleado-cargo').value = employee.cargo;
                document.getElementById('empleado-sueldo').value = employee.sueldo || '';
                
                // Cambiar texto del botón
                const btn = document.getElementById('saveEmployeeBtn');
                btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Empleado';
                btn.onclick = function() {
                    updateEmployee(id);
                };
            }
        }

        function updateEmployee(id) {
            const employees = DB.get('empleados');
            const index = employees.findIndex(e => e.id === id);
            
            if (index !== -1) {
                employees[index] = {
                    ...employees[index],
                    nombre: document.getElementById('empleado-nombre').value.trim(),
                    cedula: document.getElementById('empleado-cedula').value.trim(),
                    telefono: document.getElementById('empleado-telefono').value.trim(),
                    cargo: document.getElementById('empleado-cargo').value,
                    sueldo: parseFloat(document.getElementById('empleado-sueldo').value) || 0
                };
                
                DB.set('empleados', employees);
                showNotification('Empleado actualizado', 'success');
                
                // Restaurar botón
                const btn = document.getElementById('saveEmployeeBtn');
                btn.innerHTML = '<i class="fas fa-save"></i> Guardar Empleado';
                btn.onclick = function() {
                    addNewEmployee();
                };
                
                // Limpiar formulario
                document.getElementById('empleado-nombre').value = '';
                document.getElementById('empleado-cedula').value = '';
                document.getElementById('empleado-telefono').value = '';
                document.getElementById('empleado-sueldo').value = '';
                
                // Recargar datos
                loadConfigEmployees();
                loadCarwashEmployees();
                loadBarberiaAppointments();
            }
        }

        function deleteEmployee(id) {
            if (confirm('¿Está seguro de eliminar este empleado?')) {
                DB.delete('empleados', id);
                showNotification('Empleado eliminado', 'success');
                loadConfigEmployees();
                loadCarwashEmployees();
                loadBarberiaAppointments();
            }
        }

        function addNewEmployee() {
            const nombre = document.getElementById('empleado-nombre').value.trim();
            const cedula = document.getElementById('empleado-cedula').value.trim();
            const telefono = document.getElementById('empleado-telefono').value.trim();
            const cargo = document.getElementById('empleado-cargo').value;
            const sueldo = document.getElementById('empleado-sueldo').value;
            
            if (!nombre || !cargo) {
                showNotification('Por favor ingrese nombre y cargo del empleado', 'error');
                return;
            }
            
            const empleado = {
                nombre: nombre,
                cedula: cedula,
                telefono: telefono,
                cargo: cargo,
                sueldo: parseFloat(sueldo) || 0
            };
            
            DB.add('empleados', empleado);
            showNotification('Empleado agregado', 'success');
            
            // Limpiar formulario
            document.getElementById('empleado-nombre').value = '';
            document.getElementById('empleado-cedula').value = '';
            document.getElementById('empleado-telefono').value = '';
            document.getElementById('empleado-sueldo').value = '';
            
            // Actualizar lista
            loadConfigEmployees();
            loadCarwashEmployees();
            loadBarberiaAppointments();
        }

        // =============================================
        // SISTEMA DE FACTURACIÓN
        // =============================================

        function formatRNC(rnc) {
            if (!rnc) return "CONSUMIDOR FINAL";
            rnc = rnc.replace(/\D/g, '');
            if (rnc.length === 9) {
                return rnc.substring(0, 3) + '-' + rnc.substring(3, 8) + '-' + rnc.substring(8);
            }
            return rnc;
        }

        function generateCardPaymentSection(aprobacion, metodoPago) {
            const fecha = new Date();
            const fechaStr = fecha.toLocaleDateString('es-ES', { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric' }).toUpperCase();
            const horaStr = fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' }).toUpperCase();
            const tipoAprobacion = metodoPago === 'tarjeta' ? 'APROBACIÓN' : 'COMPROBANTE';
            
            return `
                <div class="card-payment-section">
                    <div class="card-payment-header">OPERACIÓN ACEPTADA</div>
                    <div class="card-payment-details">
                        <div class="card-payment-detail">
                            <span class="card-payment-label">VENTA</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span class="card-payment-label">FECHA:</span>
                            <span>${fechaStr}</span>
                        </div>
                        <div class="card-payment-detail">
                            <span class="card-payment-label">HORA:</span>
                            <span>${horaStr}</span>
                        </div>
                    </div>
                    <div class="card-payment-details">
                        <div class="card-payment-detail">
                            <span class="card-number">53022200 ****** 3446</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>TT:MC sin contacto</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>MODO:PR L@5</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>TID:MPL69PB63</span>
                            <span>1130</span>
                        </div>
                        <div class="card-payment-detail">
                            <span>RRN: 533417000082</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>Mastercard</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>A0000000041010</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>TC - 3C10D38306AB625F</span>
                            <span></span>
                        </div>
                        <div class="card-payment-detail">
                            <span>NO REF:000021</span>
                            <span>&lt;&lt; DUPLICADO &gt;&gt;</span>
                        </div>
                    </div>
                    <div class="card-payment-approval">${tipoAprobacion}: ${aprobacion}</div>
                </div>
            `;
        }

        function printInvoice(type = 'billar', cartData = [], total = 0, extras = {}) {
            const today = new Date();
            const formattedRNC = formatRNC(extras.rnc);
            const itbis = total * 0.18;
            const subtotal = total - itbis;
            
            let companyName = "STARK CLEANE";
            let companyDetails = "";
            
            if (type === 'barberia') {
                companyName = "BARBERÍA STARK CLEANE";
                companyDetails = "Especialistas en cortes y estilismo";
            } else if (type === 'carwash') {
                companyName = "CAR WASH STARK CLEANE";
                companyDetails = "Lavado profesional de vehículos";
            } else {
                companyName = "BILLAR STARK CLEANE";
                companyDetails = "Bar y entretenimiento";
            }
            
            const invoiceContent = `
                <div class="invoice-header">
                    <div class="invoice-logo">STARK CLEANE</div>
                    <div class="invoice-company">${companyName}</div>
                    <div class="invoice-address">Av. Principal #123, Santo Domingo</div>
                    <div class="invoice-rnc">RNC: ${formattedRNC}</div>
                    <div class="invoice-details">
                        <div>Fecha: ${today.toLocaleDateString()}</div>
                        <div>Hora: ${today.toLocaleTimeString()}</div>
                        <div class="invoice-number">Ticket #${Date.now().toString().slice(-6)}</div>
                    </div>
                </div>
                <div class="invoice-items">
                    ${cartData.map(item => `
                        <div class="invoice-item">
                            <span>${item.name} x${item.quantity}</span>
                            <span>RD$ ${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="invoice-total">
                    <div class="invoice-item">
                        <span>Subtotal:</span>
                        <span>RD$ ${subtotal.toFixed(2)}</span>
                    </div>
                    <div class="invoice-item">
                        <span>ITBIS (18%):</span>
                        <span>RD$ ${itbis.toFixed(2)}</span>
                    </div>
                    <div class="invoice-item">
                        <span>Total:</span>
                        <span>RD$ ${total.toFixed(2)}</span>
                    </div>
                    <div class="invoice-item">
                        <span>Método de Pago:</span>
                        <span>${extras.metodo_pago || 'Efectivo'}</span>
                    </div>
                    ${extras.aprobacion ? `
                        <div class="invoice-item">
                            <span>Aprobación/Comprobante:</span>
                            <span>${extras.aprobacion}</span>
                        </div>
                    ` : ''}
                    ${extras.efectivo ? `
                        <div class="invoice-item">
                            <span>Efectivo:</span>
                            <span>RD$ ${extras.efectivo}</span>
                        </div>
                        <div class="invoice-item">
                            <span>Cambio:</span>
                            <span>RD$ ${extras.cambio}</span>
                        </div>
                    ` : ''}
                </div>
                ${extras.metodo_pago === 'tarjeta' ? generateCardPaymentSection(extras.aprobacion, extras.metodo_pago) : ''}
                ${extras.metodo_pago === 'transferencia' ? `
                    <div class="card-payment-section" style="background: #e8f5e9;">
                        <div class="card-payment-approval">TRANSFERENCIA - COMPROBANTE: ${extras.aprobacion}</div>
                    </div>
                ` : ''}
                <div class="invoice-footer">
                    <div>${companyDetails}</div>
                    <div>¡Gracias por su preferencia!</div>
                    <div>Vuelva pronto</div>
                </div>
            `;

            document.getElementById('invoiceContent').innerHTML = invoiceContent;
            document.getElementById('invoiceModal').classList.add('active');
        }

        // =============================================
        // SISTEMA JARVIS - IA INTELIGENTE MEJORADA
        // =============================================

        class JarvisAI {
            constructor() {
                this.recognition = null;
                this.isListening = false;
                this.commands = {
                    'abrir dashboard': () => showPage('dashboard'),
                    'abrir barbería': () => showPage('barberia'),
                    'abrir billar': () => showPage('billar'),
                    'abrir car wash': () => showPage('carwash'),
                    'nueva cita': () => this.createAppointment(),
                    'nuevo producto': () => this.createProduct(),
                    'registrar vehículo': () => this.createVehicle(),
                    'resumen del día': () => this.showDailySummary(),
                    'ver inventario': () => this.showInventory(),
                    'reporte de ventas': () => this.showSalesReport(),
                    'facturar venta': () => this.processSale(),
                    'configurar servicios': () => showPage('config-servicios'),
                    'configurar productos': () => showPage('config-productos'),
                    'configurar empleados': () => showPage('config-empleados'),
                    'configurar impresora': () => showPage('config-impresora'),
                    'ayuda': () => this.showHelp(),
                    'hola jarvis': () => this.greet(),
                    'cerrar sesión': () => document.getElementById('logoutBtn').click(),
                    'ver alertas': () => this.checkAlerts()
                };
                this.init();
            }

            init() {
                this.setupSpeechRecognition();
                this.setupChat();
                this.setupVoiceActivation();
            }

            setupSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.lang = 'es-ES';
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;

                    this.recognition.onstart = () => {
                        this.isListening = true;
                        document.getElementById('jarvisButton').classList.add('listening');
                        this.addMessage('Escuchando...', 'jarvis');
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript.toLowerCase();
                        this.addMessage(transcript, 'user');
                        this.processCommand(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Error en reconocimiento de voz:', event.error);
                        this.addMessage('Lo siento, no pude entender. ¿Podrías repetirlo?', 'jarvis');
                    };

                    this.recognition.onend = () => {
                        this.isListening = false;
                        document.getElementById('jarvisButton').classList.remove('listening');
                    };
                } else {
                    console.warn('El navegador no soporta reconocimiento de voz');
                    this.addMessage('Tu navegador no soporta reconocimiento de voz. Usa el chat para comunicarte conmigo.', 'jarvis');
                }
            }

            setupChat() {
                const jarvisButton = document.getElementById('jarvisButton');
                const jarvisChat = document.getElementById('jarvisChat');
                const closeJarvis = document.getElementById('closeJarvis');
                const sendJarvis = document.getElementById('sendJarvis');
                const jarvisInput = document.getElementById('jarvisInput');

                jarvisButton.addEventListener('click', () => {
                    jarvisChat.classList.toggle('active');
                    if (jarvisChat.classList.contains('active')) {
                        jarvisInput.focus();
                    }
                });

                closeJarvis.addEventListener('click', () => {
                    jarvisChat.classList.remove('active');
                });

                sendJarvis.addEventListener('click', () => {
                    const message = jarvisInput.value.trim();
                    if (message) {
                        this.addMessage(message, 'user');
                        this.processCommand(message.toLowerCase());
                        jarvisInput.value = '';
                    }
                });

                jarvisInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendJarvis.click();
                    }
                });
            }

            setupVoiceActivation() {
                // Tecla F2 para activar voz
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'F2') {
                        e.preventDefault();
                        this.startListening();
                    }
                });

                // Botón de micrófono
                document.getElementById('voiceKeyBtn').addEventListener('click', () => {
                    this.startListening();
                });
            }

            startListening() {
                if (this.recognition && !this.isListening) {
                    this.recognition.start();
                } else if (!this.recognition) {
                    this.addMessage('El reconocimiento de voz no está disponible en tu navegador.', 'jarvis');
                }
            }

            addMessage(text, sender) {
                const messages = document.getElementById('jarvisMessages');
                const message = document.createElement('div');
                message.className = `message ${sender}`;
                message.textContent = text;
                messages.appendChild(message);
                messages.scrollTop = messages.scrollHeight;
            }

            processCommand(command) {
                let executed = false;

                // Buscar comandos específicos
                for (const [cmd, action] of Object.entries(this.commands)) {
                    if (command.includes(cmd)) {
                        action();
                        this.addMessage(`Ejecutando: ${cmd}`, 'jarvis');
                        executed = true;
                        break;
                    }
                }

                // Comandos avanzados con parámetros
                if (command.includes('agregar producto')) {
                    this.processAddProduct(command);
                    executed = true;
                } else if (command.includes('buscar')) {
                    this.processSearch(command);
                    executed = true;
                } else if (command.includes('registrar cita')) {
                    this.processAppointment(command);
                    executed = true;
                } else if (command.includes('registrar vehículo')) {
                    this.processVehicle(command);
                    executed = true;
                } else if (command.includes('facturar')) {
                    this.processSale();
                    executed = true;
                }

                if (!executed) {
                    this.addMessage("No entendí ese comando. Prueba con 'ayuda' para ver los comandos disponibles.", 'jarvis');
                }
            }

            processAddProduct(command) {
                const match = command.match(/agregar producto (.+) precio (.+)/);
                if (match) {
                    const nombre = match[1];
                    const precio = match[2].replace(/[^\d]/g, '');
                    
                    this.addMessage(`Creando producto: ${nombre} por RD$ ${precio}`, 'jarvis');
                    
                    const producto = {
                        nombre: nombre,
                        codigo: '',
                        precio_compra: parseInt(precio) * 0.8,
                        precio_venta: parseInt(precio),
                        stock: 10,
                        categoria: 'otros'
                    };
                    
                    DB.add('productos', producto);
                    showNotification(`Producto "${nombre}" agregado al inventario`, 'success');
                    
                    loadConfigProducts();
                    loadBillarProducts();
                }
            }

            processSearch(command) {
                const searchTerm = command.replace('buscar', '').trim();
                this.addMessage(`Buscando: ${searchTerm}`, 'jarvis');
                
                // Buscar en diferentes bases de datos
                const products = DB.get('productos');
                const clients = DB.get('barberia_clients');
                const vehicles = DB.get('carwash_vehicles');
                
                const productResults = products.filter(p => 
                    p.nombre.toLowerCase().includes(searchTerm) || 
                    p.codigo?.toLowerCase().includes(searchTerm)
                );
                
                const clientResults = clients.filter(c => 
                    c.nombre.toLowerCase().includes(searchTerm) ||
                    c.telefono?.includes(searchTerm)
                );
                
                const vehicleResults = vehicles.filter(v => 
                    v.placa.toLowerCase().includes(searchTerm) ||
                    v.cliente.toLowerCase().includes(searchTerm)
                );
                
                let response = `Resultados para "${searchTerm}":\n`;
                
                if (productResults.length > 0) {
                    response += `\nProductos (${productResults.length}):\n`;
                    productResults.slice(0, 3).forEach(p => {
                        response += `- ${p.nombre} (RD$ ${p.precio_venta}) - Stock: ${p.stock}\n`;
                    });
                }
                
                if (clientResults.length > 0) {
                    response += `\nClientes (${clientResults.length}):\n`;
                    clientResults.slice(0, 3).forEach(c => {
                        response += `- ${c.nombre} (${c.telefono || 'Sin teléfono'})\n`;
                    });
                }
                
                if (vehicleResults.length > 0) {
                    response += `\nVehículos (${vehicleResults.length}):\n`;
                    vehicleResults.slice(0, 3).forEach(v => {
                        response += `- ${v.placa} (${v.cliente}) - ${v.tipo}\n`;
                    });
                }
                
                if (productResults.length === 0 && clientResults.length === 0 && vehicleResults.length === 0) {
                    response = `No se encontraron resultados para "${searchTerm}"`;
                }
                
                this.addMessage(response, 'jarvis');
            }

            processAppointment(command) {
                const match = command.match(/registrar cita para (.+) con (.+)/);
                if (match) {
                    const cliente = match[1];
                    const barbero = match[2];
                    
                    this.addMessage(`Creando cita para ${cliente} con ${barbero}`, 'jarvis');
                    
                    const appointment = {
                        cliente: cliente,
                        barbero: barbero,
                        servicio: 'Corte de cabello',
                        precio: 250,
                        fecha: new Date().toISOString().split('T')[0],
                        hora: new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }),
                        estado: 'pendiente'
                    };
                    
                    DB.add('barberia_appointments', appointment);
                    showNotification(`Cita creada para ${cliente} con ${barbero}`, 'success');
                    loadBarberiaAppointments();
                }
            }

            processVehicle(command) {
                const match = command.match(/registrar vehículo (.+) para (.+)/);
                if (match) {
                    const tipo = match[1];
                    const cliente = match[2];
                    
                    this.addMessage(`Registrando vehículo ${tipo} para ${cliente}`, 'jarvis');
                    
                    const vehicle = {
                        placa: `TEMP${Date.now().toString().slice(-6)}`,
                        tipo: tipo,
                        cliente: cliente,
                        entrada: new Date().toISOString(),
                        estado: 'proceso'
                    };
                    
                    DB.add('carwash_vehicles', vehicle);
                    showNotification(`Vehículo registrado para ${cliente}`, 'success');
                    loadCarwashVehicles();
                }
            }

            processSale() {
                this.addMessage('Procesando venta actual...', 'jarvis');
                
                if (cart.length > 0) {
                    // Procesar venta de billar
                    const total = getCartTotal();
                    if (total > 0) {
                        showNotification(`Venta procesada por RD$ ${total}`, 'success');
                        this.addMessage(`Venta procesada exitosamente por RD$ ${total}`, 'jarvis');
                        // Aquí se llamaría a la función de confirmar venta
                        document.getElementById('confirmSaleBtn').click();
                    }
                } else if (cartBarberia.length > 0) {
                    // Procesar venta de barbería
                    const total = getCartTotalBarberia();
                    if (total > 0) {
                        showNotification(`Venta procesada por RD$ ${total}`, 'success');
                        this.addMessage(`Venta procesada exitosamente por RD$ ${total}`, 'jarvis');
                        document.getElementById('confirmSaleBtnBarberia').click();
                    }
                } else if (cartCarwash.length > 0) {
                    // Procesar venta de car wash
                    const total = getCartTotalCarwash();
                    if (total > 0) {
                        showNotification(`Venta procesada por RD$ ${total}`, 'success');
                        this.addMessage(`Venta procesada exitosamente por RD$ ${total}`, 'jarvis');
                        document.getElementById('confirmSaleBtnCarwash').click();
                    }
                } else {
                    this.addMessage('No hay productos en el carrito para facturar.', 'jarvis');
                }
            }

            createAppointment() {
                showPage('barberia');
                // Activar pestaña de citas
                document.querySelector('[data-tab="barberia-citas"]').click();
                this.addMessage('Abriendo registro de citas', 'jarvis');
            }

            createProduct() {
                document.getElementById('productModal').classList.add('active');
                this.addMessage('Abriendo formulario para nuevo producto', 'jarvis');
            }

            createVehicle() {
                showPage('carwash');
                this.addMessage('Abriendo registro de vehículos', 'jarvis');
            }

            showDailySummary() {
                const sales = DB.get('billar_sales');
                const barberiaSales = DB.get('barberia_sales');
                const carwashSales = DB.get('carwash_sales');
                
                const today = new Date().toDateString();
                
                const todaySales = sales.filter(s => new Date(s.fecha).toDateString() === today);
                const todayBarberia = barberiaSales.filter(s => new Date(s.fecha).toDateString() === today);
                const todayCarwash = carwashSales.filter(s => new Date(s.fecha).toDateString() === today);
                
                const totalSales = todaySales.reduce((sum, sale) => sum + sale.total, 0);
                const totalBarberia = todayBarberia.reduce((sum, sale) => sum + sale.total, 0);
                const totalCarwash = todayCarwash.reduce((sum, sale) => sum + sale.total, 0);
                
                const total = totalSales + totalBarberia + totalCarwash;
                
                const summary = `
                    Resumen del día (${new Date().toLocaleDateString()}):
                    - Billar: RD$ ${totalSales} (${todaySales.length} ventas)
                    - Barbería: RD$ ${totalBarberia} (${todayBarberia.length} ventas)
                    - Car Wash: RD$ ${totalCarwash} (${todayCarwash.length} ventas)
                    - Total ingresos: RD$ ${total}
                `;
                
                this.addMessage(summary, 'jarvis');
                showNotification('Resumen del día generado', 'info');
            }

            showInventory() {
                const products = DB.get('productos');
                const lowStock = products.filter(p => p.stock <= 5);
                const outOfStock = products.filter(p => p.stock <= 0);
                
                let response = `Estado del inventario:\n`;
                response += `- Total productos: ${products.length}\n`;
                response += `- Bajo stock (≤5): ${lowStock.length}\n`;
                response += `- Sin stock: ${outOfStock.length}\n`;
                
                if (lowStock.length > 0) {
                    response += `\nProductos con bajo stock:\n`;
                    lowStock.slice(0, 5).forEach(p => {
                        response += `- ${p.nombre}: ${p.stock} unidades\n`;
                    });
                }
                
                this.addMessage(response, 'jarvis');
            }

            showSalesReport() {
                this.addMessage('Generando reporte de ventas...', 'jarvis');
                showPage('billar');
                document.querySelector('[data-tab="billar-reportes"]').click();
            }

            checkAlerts() {
                this.addMessage('Verificando alertas del sistema...', 'jarvis');
                AlertSystem.checkLowStock();
                AlertSystem.checkUpcomingAppointments();
                this.addMessage('Alertas verificadas. Revisa las notificaciones.', 'jarvis');
            }

            showHelp() {
                const helpText = `
                    Comandos disponibles:
                    
                    NAVEGACIÓN:
                    - "Abrir [módulo]" - Navegar a cualquier módulo
                    - "Configurar [opción]" - Abrir configuración específica
                    
                    OPERACIONES:
                    - "Nueva cita" - Crear cita en barbería
                    - "Nuevo producto" - Agregar producto al inventario
                    - "Registrar vehículo" - Registrar vehículo en car wash
                    - "Facturar venta" - Procesar venta actual
                    
                    CONSULTAS:
                    - "Resumen del día" - Ver reporte diario
                    - "Ver inventario" - Mostrar estado del inventario
                    - "Reporte de ventas" - Generar reporte de ventas
                    - "Buscar [texto]" - Realizar búsqueda
                    - "Ver alertas" - Revisar alertas del sistema
                    
                    SISTEMA:
                    - "Ayuda" - Mostrar esta ayuda
                    - "Cerrar sesión" - Salir del sistema
                `;
                
                this.addMessage(helpText, 'jarvis');
            }

            greet() {
                const greetings = [
                    "¡Hola! ¿En qué puedo ayudarte hoy?",
                    "¡Hola! Soy Jarvis, tu asistente inteligente. ¿Qué necesitas?",
                    "¡Hola! Listo para ayudarte. ¿Qué quieres hacer?",
                    "¡Hola! Bienvenido de nuevo. ¿En qué puedo asistirte?"
                ];
                const greeting = greetings[Math.floor(Math.random() * greetings.length)];
                this.addMessage(greeting, 'jarvis');
            }
        }

        // =============================================
        // INICIALIZACIÓN DEL SISTEMA
        // =============================================

        function initApp() {
            // Configurar navegación
            document.addEventListener('click', function(event) {
                // Navegación por páginas desde el menú
                if (event.target.closest('[data-page]')) {
                    const pageElement = event.target.closest('[data-page]');
                    const pageId = pageElement.getAttribute('data-page');
                    
                    if (pageElement.classList.contains('submenu-item')) {
                        const parentSubmenu = pageElement.closest('.submenu');
                        if (parentSubmenu) {
                            parentSubmenu.classList.remove('active');
                            const parentMenuItem = parentSubmenu.previousElementSibling;
                            if (parentMenuItem) {
                                parentMenuItem.querySelector('.fa-chevron-down').classList.remove('fa-chevron-up');
                            }
                        }
                    }
                    
                    showPage(pageId);
                }
                
                // Submenús
                if (event.target.closest('[data-submenu]')) {
                    const submenuElement = event.target.closest('[data-submenu]');
                    const submenuId = submenuElement.getAttribute('data-submenu') + '-submenu';
                    const submenu = document.getElementById(submenuId);
                    submenu.classList.toggle('active');
                    
                    const chevron = submenuElement.querySelector('.fa-chevron-down');
                    if (chevron) {
                        chevron.classList.toggle('fa-chevron-up');
                    }
                    
                    event.stopPropagation();
                }
            });

            // Configurar pestañas
            setupTabs();
            
            // Configurar campos de aprobación
            setupApprovalFields();

            // Configurar dashboard cards
            document.addEventListener('click', function(event) {
                if (event.target.closest('.card-system')) {
                    const card = event.target.closest('.card-system');
                    const pageId = card.getAttribute('data-page');
                    if (pageId) {
                        showPage(pageId);
                    }
                }
            });

            // Configurar tema
            document.getElementById('themeToggle').addEventListener('click', function() {
                if (document.body.classList.contains('dark-mode')) {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                    this.innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('light-mode');
                    document.body.classList.add('dark-mode');
                    this.innerHTML = '<i class="fas fa-moon"></i>';
                }
            });

            // Configurar hamburger menu
            document.querySelector('.hamburger').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('active');
            });

            // Configurar logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                document.getElementById('screen-login').style.display = 'flex';
                document.getElementById('mainSystem').style.display = 'none';
                AlertSystem.clearAlerts();
                showNotification('Sesión cerrada correctamente', 'success');
            });

            // Configurar servicios de barbería
            document.getElementById('agregar-servicio-barberia').addEventListener('click', addNewBarberiaService);
            
            // Configurar servicios de car wash
            document.getElementById('agregar-servicio-carwash').addEventListener('click', addNewCarwashService);
            
            // Configurar productos
            document.getElementById('agregar-producto').addEventListener('click', addNewProduct);
            
            // Configurar empleados
            document.getElementById('saveEmployeeBtn').addEventListener('click', addNewEmployee);
            
            // Configurar tema
            document.getElementById('saveThemeBtn').addEventListener('click', function() {
                const tema = document.getElementById('select-tema').value;
                if (tema === 'light') {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('light-mode');
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
                }
                showNotification('Tema actualizado', 'success');
            });
            
            // Configurar impresora
            document.getElementById('savePrinterConfigBtn').addEventListener('click', function() {
                showNotification('Configuración de impresora guardada', 'success');
            });
            
            document.getElementById('testPrinterBtn').addEventListener('click', function() {
                showNotification('Prueba de impresión enviada a la impresora', 'info');
            });
            
            // Configurar Jarvis
            document.getElementById('saveJarvisConfigBtn').addEventListener('click', function() {
                showNotification('Configuración Jarvis guardada', 'success');
            });

            // Configurar botones de barbería
            document.getElementById('newAppointmentBtn').addEventListener('click', function() {
                showPage('barberia');
                document.querySelector('[data-tab="barberia-citas"]').click();
            });
            
            document.getElementById('saveAppointmentBtn').addEventListener('click', function() {
                const cliente = document.getElementById('cliente-cita').value.trim();
                const telefono = document.getElementById('telefono-cita').value.trim();
                const servicio = document.getElementById('servicio-cita').value;
                const barbero = document.getElementById('barbero-cita').value;
                const fecha = document.getElementById('fecha-cita').value;
                const hora = document.getElementById('hora-cita').value;
                const notas = document.getElementById('notas-cita').value.trim();
                
                if (!cliente || !servicio || !barbero || !fecha || !hora) {
                    showNotification('Por favor complete todos los campos obligatorios', 'error');
                    return;
                }
                
                const appointment = {
                    cliente: cliente,
                    telefono: telefono,
                    servicio_id: servicio,
                    barbero_id: barbero,
                    fecha: fecha,
                    hora: hora,
                    notas: notas,
                    estado: 'pendiente',
                    fecha_registro: new Date().toISOString()
                };
                
                DB.add('barberia_appointments', appointment);
                showNotification('Cita guardada correctamente', 'success');
                
                // Limpiar formulario
                document.getElementById('cliente-cita').value = '';
                document.getElementById('telefono-cita').value = '';
                document.getElementById('notas-cita').value = '';
                document.getElementById('fecha-cita').value = '';
                document.getElementById('hora-cita').value = '';
            });

            // Configurar botones de car wash
            document.getElementById('newVehicleBtn').addEventListener('click', function() {
                showPage('carwash');
                document.querySelector('[data-tab="carwash-registro"]').click();
            });
            
            document.getElementById('saveVehicleBtn').addEventListener('click', function() {
                const placa = document.getElementById('placa-vehiculo').value.trim().toUpperCase();
                const tipo = document.getElementById('tipo-vehiculo').value;
                const cliente = document.getElementById('cliente-vehiculo').value.trim();
                const telefono = document.getElementById('telefono-vehiculo').value.trim();
                const empleado = document.getElementById('empleado-vehiculo').value;
                const notas = document.getElementById('notas-vehiculo').value.trim();
                
                if (!placa || !tipo || !cliente) {
                    showNotification('Por favor complete todos los campos obligatorios', 'error');
                    return;
                }
                
                const vehicle = {
                    placa: placa,
                    tipo: tipo,
                    cliente: cliente,
                    telefono: telefono,
                    empleado_id: empleado,
                    notas: notas,
                    entrada: new Date().toISOString(),
                    estado: 'proceso'
                };
                
                DB.add('carwash_vehicles', vehicle);
                showNotification('Vehículo registrado correctamente', 'success');
                
                // Limpiar formulario
                document.getElementById('placa-vehiculo').value = '';
                document.getElementById('cliente-vehiculo').value = '';
                document.getElementById('telefono-vehiculo').value = '';
                document.getElementById('notas-vehiculo').value = '';
                
                // Recargar vehículos
                loadCarwashVehicles();
            });

            // Configurar búsqueda de productos
            document.getElementById('search-product').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const products = DB.get('productos');
                const grid = document.getElementById('productsGrid');
                
                if (!grid) return;
                
                grid.innerHTML = '';
                
                const filtered = products.filter(product => 
                    product.nombre.toLowerCase().includes(searchTerm) ||
                    product.codigo?.toLowerCase().includes(searchTerm) ||
                    product.categoria.toLowerCase().includes(searchTerm)
                );
                
                filtered.forEach(product => {
                    if (product.stock > 0) {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.innerHTML = `
                            <div class="product-image">
                                <i class="fas fa-box"></i>
                            </div>
                            <h4>${product.nombre}</h4>
                            <p>RD$ ${product.precio_venta}</p>
                            <small>Stock: ${product.stock}</small>
                        `;
                        
                        productCard.addEventListener('click', function() {
                            addToCart(product.id, product.nombre, product.precio_venta);
                        });
                        
                        grid.appendChild(productCard);
                    }
                });
                
                if (filtered.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">No se encontraron productos.</p>';
                }
            });

            // Configurar carritos
            setupCartSystems();

            // Configurar modal de producto
            setupProductModal();

            // Configurar reportes
            setupReports();

            // Inicializar Jarvis AI
            window.jarvis = new JarvisAI();

            // Inicializar gráficos
            initializeCharts();
            
            // Actualizar dashboard
            updateDashboard();
            
            // Configurar botón de actualizar dashboard
            document.getElementById('refreshDashboard').addEventListener('click', function() {
                updateDashboard();
                showNotification('Dashboard actualizado', 'success');
            });

            // Iniciar sistema de alertas
            startAlertSystem();
        }

        function setupApprovalFields() {
            // Billar
            document.getElementById('metodo-pago').addEventListener('change', function() {
                const metodo = this.value;
                const approvalField = document.getElementById('approvalField');
                if (metodo === 'tarjeta' || metodo === 'transferencia') {
                    approvalField.style.display = 'block';
                } else {
                    approvalField.style.display = 'none';
                    document.getElementById('aprobacion').value = '';
                }
            });
            
            // Barbería
            document.getElementById('metodo-pago-barberia').addEventListener('change', function() {
                const metodo = this.value;
                const approvalField = document.getElementById('approvalFieldBarberia');
                if (metodo === 'tarjeta' || metodo === 'transferencia') {
                    approvalField.style.display = 'block';
                } else {
                    approvalField.style.display = 'none';
                    document.getElementById('aprobacion-barberia').value = '';
                }
            });
            
            // Car Wash
            document.getElementById('metodo-pago-carwash').addEventListener('change', function() {
                const metodo = this.value;
                const approvalField = document.getElementById('approvalFieldCarwash');
                if (metodo === 'tarjeta' || metodo === 'transferencia') {
                    approvalField.style.display = 'block';
                } else {
                    approvalField.style.display = 'none';
                    document.getElementById('aprobacion-carwash').value = '';
                }
            });
        }

        function setupProductModal() {
            // Configurar botones para abrir modal de producto
            document.getElementById('newProductBtn').addEventListener('click', function() {
                document.getElementById('productModal').classList.add('active');
            });

            document.getElementById('addProductBtn').addEventListener('click', function() {
                document.getElementById('productModal').classList.add('active');
            });

            // Configurar cerrar modal
            document.getElementById('closeProductModal').addEventListener('click', function() {
                document.getElementById('productModal').classList.remove('active');
            });

            // Configurar guardar producto desde modal
            document.getElementById('saveProductBtn').addEventListener('click', function() {
                const producto = {
                    codigo: document.getElementById('codigo-barra-producto').value.trim(),
                    nombre: document.getElementById('nombre-producto').value.trim(),
                    categoria: document.getElementById('categoria-producto').value,
                    fecha_ingreso: document.getElementById('fecha-ingreso').value,
                    precio_compra: parseFloat(document.getElementById('precio-compra').value) || 0,
                    precio_venta: parseFloat(document.getElementById('precio-venta').value) || 0,
                    stock: parseInt(document.getElementById('cantidad-stock').value) || 0,
                    alerta_stock: parseInt(document.getElementById('alerta-stock').value) || 5
                };

                if (!producto.nombre || !producto.precio_venta || !producto.stock) {
                    showNotification('Por favor complete los campos obligatorios: Nombre, Precio de Venta y Stock', 'error');
                    return;
                }

                DB.add('productos', producto);
                showNotification('Producto agregado desde modal', 'success');
                
                // Limpiar el modal
                document.getElementById('codigo-barra-producto').value = '';
                document.getElementById('nombre-producto').value = '';
                document.getElementById('categoria-producto').value = '';
                document.getElementById('fecha-ingreso').value = '';
                document.getElementById('precio-compra').value = '';
                document.getElementById('precio-venta').value = '';
                document.getElementById('cantidad-stock').value = '';
                document.getElementById('alerta-stock').value = '';

                // Cerrar modal
                document.getElementById('productModal').classList.remove('active');

                // Recargar productos en las secciones correspondientes
                loadConfigProducts();
                loadBillarProducts();
            });
        }

        function setupReports() {
            // Configurar generación de reportes
            document.getElementById('generateReportBtn').addEventListener('click', function() {
                const fechaInicio = document.getElementById('fecha-inicio').value;
                const fechaFin = document.getElementById('fecha-fin').value;

                if (!fechaInicio || !fechaFin) {
                    showNotification('Por favor seleccione un rango de fechas', 'error');
                    return;
                }

                // Obtener ventas de billar en el rango
                const sales = DB.get('billar_sales');
                const filteredSales = sales.filter(s => {
                    const saleDate = new Date(s.fecha);
                    const start = new Date(fechaInicio);
                    const end = new Date(fechaFin);
                    end.setHours(23, 59, 59, 999);
                    return saleDate >= start && saleDate <= end;
                });

                // Calcular total vendido
                const totalSold = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
                document.getElementById('totalSold').textContent = `RD$ ${totalSold}`;
                document.getElementById('soldTrend').innerHTML = filteredSales.length > 0 ? 
                    `<span class="trend-up"><i class="fas fa-arrow-up"></i> ${filteredSales.length} ventas</span>` : 
                    'Sin ventas en el período';

                // Calcular producto más vendido
                const productCount = {};
                filteredSales.forEach(sale => {
                    if (sale.productos) {
                        const products = sale.productos.split(', ');
                        products.forEach(p => {
                            const match = p.match(/(\d+)x (.+)/);
                            if (match) {
                                const quantity = parseInt(match[1]);
                                const productName = match[2].trim();
                                productCount[productName] = (productCount[productName] || 0) + quantity;
                            }
                        });
                    }
                });

                let topProduct = 'N/A';
                let topProductCount = 0;
                for (const [product, count] of Object.entries(productCount)) {
                    if (count > topProductCount) {
                        topProduct = product;
                        topProductCount = count;
                    }
                }

                document.getElementById('topProduct').textContent = topProduct;
                document.getElementById('topProductCount').textContent = `${topProductCount} unidades`;

                // Calcular categoría más popular
                const categorySales = {};
                const allProducts = DB.get('productos');
                
                filteredSales.forEach(sale => {
                    if (sale.productos) {
                        const products = sale.productos.split(', ');
                        products.forEach(p => {
                            const match = p.match(/(\d+)x (.+)/);
                            if (match) {
                                const productName = match[2].trim();
                                const foundProduct = allProducts.find(prod => prod.nombre === productName);
                                if (foundProduct && foundProduct.categoria) {
                                    categorySales[foundProduct.categoria] = (categorySales[foundProduct.categoria] || 0) + 1;
                                }
                            }
                        });
                    }
                });

                let topCategory = 'N/A';
                let topCategoryCount = 0;
                for (const [category, count] of Object.entries(categorySales)) {
                    if (count > topCategoryCount) {
                        topCategory = category;
                        topCategoryCount = count;
                    }
                }

                document.getElementById('topCategory').textContent = topCategory;
                const totalItems = Object.values(productCount).reduce((a, b) => a + b, 0);
                const topCategoryPercent = totalItems > 0 ? Math.round((topCategoryCount / totalItems) * 100) : 0;
                document.getElementById('topCategoryPercent').textContent = `${topCategoryPercent}% de las ventas`;

                // Actualizar gráfico de categorías
                updateCategoryChart(categorySales);

                showNotification('Reporte generado', 'success');
            });
        }

        function setupCartSystems() {
            // Billar
            document.getElementById('clearCartBtn').addEventListener('click', function() {
                cart = [];
                updateCartUI();
                showNotification('Carrito limpiado', 'success');
            });

            document.getElementById('confirmSaleBtn').addEventListener('click', function() {
                if (cart.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }
                
                const total = getCartTotal();
                const efectivo = parseFloat(document.getElementById('efectivo-recibido').value) || 0;
                
                if (efectivo < total) {
                    showNotification('El efectivo recibido es menor al total', 'error');
                    return;
                }
                
                const rnc = document.getElementById('rnc').value;
                const metodoPago = document.getElementById('metodo-pago').value;
                const aprobacion = document.getElementById('aprobacion').value;
                
                if ((metodoPago === 'tarjeta' || metodoPago === 'transferencia') && !aprobacion) {
                    showNotification('Debe ingresar el número de aprobación/comprobante', 'error');
                    return;
                }
                
                const sale = {
                    total: total,
                    productos: cart.map(item => `${item.quantity}x ${item.name}`).join(', '),
                    fecha: new Date().toISOString(),
                    metodo_pago: metodoPago,
                    rnc: rnc || null,
                    aprobacion: aprobacion || null
                };
                
                DB.add('billar_sales', sale);
                
                // Actualizar stock
                cart.forEach(item => {
                    const products = DB.get('productos');
                    const productIndex = products.findIndex(p => p.id === item.id);
                    if (productIndex !== -1) {
                        products[productIndex].stock -= item.quantity;
                        DB.set('productos', products);
                    }
                });
                
                // Imprimir factura
                printInvoice('billar', cart, total, {
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    aprobacion: aprobacion,
                    efectivo: efectivo,
                    cambio: efectivo - total
                });
                
                cart = [];
                updateCartUI();
                document.getElementById('efectivo-recibido').value = '0';
                document.getElementById('rnc').value = '';
                document.getElementById('aprobacion').value = '';
                updateChange();
                
                loadBillarProducts();
                loadBillarSales();
                
                showNotification(`Venta confirmada por RD$ ${total}`, 'success');
                
                // Verificar alertas de stock bajo
                AlertSystem.checkLowStock();
            });

            document.getElementById('printTicketBtn').addEventListener('click', function() {
                if (cart.length === 0) {
                    showNotification('No hay productos en el carrito', 'error');
                    return;
                }
                
                const total = getCartTotal();
                const rnc = document.getElementById('rnc').value;
                const metodoPago = document.getElementById('metodo-pago').value;
                const aprobacion = document.getElementById('aprobacion').value;
                const efectivo = parseFloat(document.getElementById('efectivo-recibido').value) || 0;
                
                printInvoice('billar', cart, total, {
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    aprobacion: aprobacion,
                    efectivo: efectivo,
                    cambio: efectivo - total
                });
            });

            document.getElementById('efectivo-recibido').addEventListener('input', updateChange);

            // Barbería
            document.getElementById('confirmSaleBtnBarberia').addEventListener('click', function() {
                if (cartBarberia.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }
                
                const total = getCartTotalBarberia();
                const efectivo = parseFloat(document.getElementById('efectivo-recibido-barberia').value) || 0;
                
                if (efectivo < total) {
                    showNotification('El efectivo recibido es menor al total', 'error');
                    return;
                }
                
                const cliente = document.getElementById('cliente-barberia').value.trim();
                const rnc = document.getElementById('rnc-barberia').value;
                const metodoPago = document.getElementById('metodo-pago-barberia').value;
                const aprobacion = document.getElementById('aprobacion-barberia').value;
                
                if ((metodoPago === 'tarjeta' || metodoPago === 'transferencia') && !aprobacion) {
                    showNotification('Debe ingresar el número de aprobación/comprobante', 'error');
                    return;
                }
                
                const sale = {
                    cliente: cliente || 'Cliente no registrado',
                    total: total,
                    servicios: cartBarberia.map(item => `${item.quantity}x ${item.name}`).join(', '),
                    fecha: new Date().toISOString(),
                    metodo_pago: metodoPago,
                    rnc: rnc || null,
                    aprobacion: aprobacion || null
                };
                
                DB.add('barberia_sales', sale);
                
                // Imprimir factura
                printInvoice('barberia', cartBarberia, total, {
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    aprobacion: aprobacion,
                    efectivo: efectivo,
                    cambio: efectivo - total
                });
                
                cartBarberia = [];
                updateCartUIBarberia();
                document.getElementById('efectivo-recibido-barberia').value = '0';
                document.getElementById('cliente-barberia').value = '';
                document.getElementById('rnc-barberia').value = '';
                document.getElementById('aprobacion-barberia').value = '';
                updateChangeBarberia();
                
                loadBarberiaHistory();
                
                showNotification(`Venta confirmada por RD$ ${total}`, 'success');
            });

            document.getElementById('printTicketBtnBarberia').addEventListener('click', function() {
                if (cartBarberia.length === 0) {
                    showNotification('No hay servicios en el carrito', 'error');
                    return;
                }
                
                const total = getCartTotalBarberia();
                const cliente = document.getElementById('cliente-barberia').value.trim();
                const rnc = document.getElementById('rnc-barberia').value;
                const metodoPago = document.getElementById('metodo-pago-barberia').value;
                const aprobacion = document.getElementById('aprobacion-barberia').value;
                const efectivo = parseFloat(document.getElementById('efectivo-recibido-barberia').value) || 0;
                
                printInvoice('barberia', cartBarberia, total, {
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    aprobacion: aprobacion,
                    efectivo: efectivo,
                    cambio: efectivo - total
                });
            });

            document.getElementById('efectivo-recibido-barberia').addEventListener('input', updateChangeBarberia);

            // Car Wash
            document.getElementById('confirmSaleBtnCarwash').addEventListener('click', function() {
                if (cartCarwash.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }
                
                const total = getCartTotalCarwash();
                const efectivo = parseFloat(document.getElementById('efectivo-recibido-carwash').value) || 0;
                
                if (efectivo < total) {
                    showNotification('El efectivo recibido es menor al total', 'error');
                    return;
                }
                
                const vehiculoId = document.getElementById('vehiculo-servicio').value;
                const rnc = document.getElementById('rnc-carwash').value;
                const metodoPago = document.getElementById('metodo-pago-carwash').value;
                const aprobacion = document.getElementById('aprobacion-carwash').value;
                
                if ((metodoPago === 'tarjeta' || metodoPago === 'transferencia') && !aprobacion) {
                    showNotification('Debe ingresar el número de aprobación/comprobante', 'error');
                    return;
                }
                
                const sale = {
                    total: total,
                    servicios: cartCarwash.map(item => `${item.quantity}x ${item.name}`).join(', '),
                    fecha: new Date().toISOString(),
                    metodo_pago: metodoPago,
                    rnc: rnc || null,
                    aprobacion: aprobacion || null
                };
                
                DB.add('carwash_sales', sale);
                
                // Actualizar vehículo
                if (vehiculoId) {
                    const vehicles = DB.get('carwash_vehicles');
                    const vehicleIndex = vehicles.findIndex(v => v.id === parseInt(vehiculoId));
                    if (vehicleIndex !== -1) {
                        vehicles[vehicleIndex].servicios = cartCarwash.map(item => item.name).join(', ');
                        vehicles[vehicleIndex].total = total;
                        vehicles[vehicleIndex].estado = 'completado';
                        vehicles[vehicleIndex].salida = new Date().toISOString();
                        DB.set('carwash_vehicles', vehicles);
                    }
                }
                
                // Imprimir factura
                printInvoice('carwash', cartCarwash, total, {
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    aprobacion: aprobacion,
                    efectivo: efectivo,
                    cambio: efectivo - total
                });
                
                cartCarwash = [];
                updateCartUICarwash();
                document.getElementById('efectivo-recibido-carwash').value = '0';
                document.getElementById('vehiculo-servicio').value = '';
                document.getElementById('rnc-carwash').value = '';
                document.getElementById('aprobacion-carwash').value = '';
                updateChangeCarwash();
                
                loadCarwashVehicles();
                loadCarwashHistory();
                
                showNotification(`Venta confirmada por RD$ ${total}`, 'success');
            });

            document.getElementById('printTicketBtnCarwash').addEventListener('click', function() {
                if (cartCarwash.length === 0) {
                    showNotification('No hay servicios en el carrito', 'error');
                    return;
                }
                
                const total = getCartTotalCarwash();
                const vehiculoId = document.getElementById('vehiculo-servicio').value;
                const rnc = document.getElementById('rnc-carwash').value;
                const metodoPago = document.getElementById('metodo-pago-carwash').value;
                const aprobacion = document.getElementById('aprobacion-carwash').value;
                const efectivo = parseFloat(document.getElementById('efectivo-recibido-carwash').value) || 0;
                
                printInvoice('carwash', cartCarwash, total, {
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    aprobacion: aprobacion,
                    efectivo: efectivo,
                    cambio: efectivo - total
                });
            });

            document.getElementById('efectivo-recibido-carwash').addEventListener('input', updateChangeCarwash);
        }

        // =============================================
        // FUNCIONES AUXILIARES
        // =============================================

        function updateDashboard() {
            const today = new Date().toDateString();
            
            // Citas de barbería
            const appointments = DB.get('barberia_appointments');
            const todayAppointments = appointments.filter(a => new Date(a.fecha).toDateString() === today);
            document.getElementById('appointmentsCount').textContent = todayAppointments.length;
            document.getElementById('appointmentsTrend').innerHTML = todayAppointments.length > 0 ? 
                `<span class="trend-up"><i class="fas fa-arrow-up"></i> ${todayAppointments.length} hoy</span>` : 
                'Sin citas hoy';
            
            // Ventas de billar
            const sales = DB.get('billar_sales');
            const todaySales = sales.filter(s => new Date(s.fecha).toDateString() === today);
            const totalSales = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            document.getElementById('salesTotal').textContent = `RD$ ${totalSales}`;
            document.getElementById('salesTrend').innerHTML = todaySales.length > 0 ? 
                `<span class="trend-up"><i class="fas fa-arrow-up"></i> ${todaySales.length} ventas</span>` : 
                'Sin ventas hoy';
            
            // Vehículos de car wash
            const vehicles = DB.get('carwash_vehicles');
            const todayVehicles = vehicles.filter(v => new Date(v.entrada).toDateString() === today);
            document.getElementById('vehiclesCount').textContent = todayVehicles.length;
            document.getElementById('vehiclesTrend').innerHTML = todayVehicles.length > 0 ? 
                `<span class="trend-up"><i class="fas fa-arrow-up"></i> ${todayVehicles.length} hoy</span>` : 
                'Sin vehículos hoy';
            
            // Ingresos totales
            const barberiaSales = DB.get('barberia_sales');
            const carwashSales = DB.get('carwash_sales');
            
            const todayBarberia = barberiaSales.filter(s => new Date(s.fecha).toDateString() === today);
            const todayCarwash = carwashSales.filter(s => new Date(s.fecha).toDateString() === today);
            
            const totalBarberia = todayBarberia.reduce((sum, sale) => sum + sale.total, 0);
            const totalCarwash = todayCarwash.reduce((sum, sale) => sum + sale.total, 0);
            
            const dailyIncome = totalSales + totalBarberia + totalCarwash;
            document.getElementById('dailyIncome').textContent = `RD$ ${dailyIncome}`;
            document.getElementById('incomeTrend').innerHTML = dailyIncome > 0 ? 
                `<span class="trend-up"><i class="fas fa-arrow-up"></i> Ingresos hoy</span>` : 
                'Sin ingresos hoy';
            
            // Productos vendidos
            let totalProducts = 0;
            todaySales.forEach(sale => {
                const match = sale.productos?.match(/(\d+)x/g);
                if (match) {
                    match.forEach(m => {
                        totalProducts += parseInt(m);
                    });
                }
            });
            document.getElementById('productsSold').textContent = totalProducts;
            document.getElementById('productsTrend').innerHTML = totalProducts > 0 ? 
                `<span class="trend-up"><i class="fas fa-arrow-up"></i> ${totalProducts} unidades</span>` : 
                'Sin productos vendidos';
            
            // Actualizar predicción de IA
            updateAIPrediction();
        }

        function updateAIPrediction() {
            const predictions = [
                "Hoy es un buen día para revisar el inventario y reponer productos con bajo stock.",
                "Recomiendo ofrecer promociones en servicios de barbería durante las horas de menor actividad.",
                "El car wash podría aumentar ingresos ofreciendo servicios adicionales como encerado o aspirado.",
                "Considera crear paquetes combinados entre barbería y billar para aumentar las ventas cruzadas.",
                "Los clientes recurrentes en barbería podrían estar interesados en membresías mensuales.",
                "Analiza las horas pico en cada sección para optimizar la asignación de empleados.",
                "Podrías implementar un sistema de reservas en línea para la barbería.",
                "Los servicios premium en car wash tienen buen margen de ganancia.",
                "Revisa los productos más vendidos para hacer pedidos más eficientes.",
                "Considera ofrecer descuentos por pago en efectivo para mejorar el flujo de caja."
            ];
            
            const randomPrediction = predictions[Math.floor(Math.random() * predictions.length)];
            document.getElementById('aiPredictionText').textContent = randomPrediction;
        }

        function initializeCharts() {
            // Gráfico de ventas
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                const salesData = DB.get('billar_sales');
                const last7Days = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    last7Days.push(date.toDateString());
                }
                
                const dailySales = last7Days.map(day => {
                    const daySales = salesData.filter(s => new Date(s.fecha).toDateString() === day);
                    return daySales.reduce((sum, sale) => sum + sale.total, 0);
                });
                
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: last7Days.map(d => new Date(d).toLocaleDateString('es-ES', { weekday: 'short' })),
                        datasets: [{
                            label: 'Ventas Diarias',
                            data: dailySales,
                            borderColor: '#1a73e8',
                            backgroundColor: 'rgba(26, 115, 232, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e0e0e0'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#b0b0b0',
                                    callback: function(value) {
                                        return 'RD$ ' + value;
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#b0b0b0'
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateCategoryChart(categoryData) {
            const categoryCtx = document.getElementById('categoryChart');
            if (!categoryCtx) return;
            
            // Destruir gráfico anterior si existe
            const existingChart = Chart.getChart(categoryCtx);
            if (existingChart) {
                existingChart.destroy();
            }
            
            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData);
            
            if (labels.length === 0) {
                categoryCtx.parentElement.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No hay datos de ventas por categoría en el período seleccionado.</p>';
                return;
            }
            
            new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#1a73e8',
                            '#ff6d00',
                            '#00c853',
                            '#d32f2f',
                            '#0288d1',
                            '#ffa000'
                        ],
                        borderWidth: 2,
                        borderColor: '#1e1e1e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e0e0e0',
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} ventas (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // =============================================
        // SISTEMA DE ALERTAS AUTOMÁTICAS
        // =============================================

        function startAlertSystem() {
            // Ejecutar alertas inmediatamente
            AlertSystem.checkLowStock();
            AlertSystem.checkUpcomingAppointments();
            
            // Configurar intervalo de actualización (cada minuto)
            setInterval(() => {
                AlertSystem.checkLowStock();
                AlertSystem.checkUpcomingAppointments();
            }, 60000); // 60,000 ms = 1 minuto
        }

        // =============================================
        // FUNCIONES PARA VEHÍCULOS Y CLIENTES
        // =============================================

        function completeVehicle(id) {
            if (confirm('¿Marcar vehículo como completado?')) {
                const vehicles = DB.get('carwash_vehicles');
                const vehicleIndex = vehicles.findIndex(v => v.id === id);
                
                if (vehicleIndex !== -1) {
                    vehicles[vehicleIndex].estado = 'completado';
                    vehicles[vehicleIndex].salida = new Date().toISOString();
                    DB.set('carwash_vehicles', vehicles);
                    
                    showNotification('Vehículo marcado como completado', 'success');
                    loadCarwashVehicles();
                }
            }
        }

        function addServicesToVehicle(id) {
            showPage('carwash');
            document.querySelector('[data-tab="carwash-servicios"]').click();
            document.getElementById('vehiculo-servicio').value = id;
            showNotification('Selecciona los servicios para este vehículo', 'info');
        }

        function viewVehicle(id) {
            const vehicles = DB.get('carwash_vehicles');
            const vehicle = vehicles.find(v => v.id === id);
            
            if (vehicle) {
                alert(`Detalles del vehículo:\n\nPlaca: ${vehicle.placa}\nTipo: ${vehicle.tipo}\nCliente: ${vehicle.cliente}\nEstado: ${vehicle.estado}\nEntrada: ${new Date(vehicle.entrada).toLocaleString()}\nSalida: ${vehicle.salida ? new Date(vehicle.salida).toLocaleString() : 'En proceso'}\nServicios: ${vehicle.servicios || 'Sin servicios'}\nTotal: RD$ ${vehicle.total || 0}`);
            }
        }

        function viewSale(id, type) {
            let sales;
            if (type === 'billar') {
                sales = DB.get('billar_sales');
            } else if (type === 'barberia') {
                sales = DB.get('barberia_sales');
            } else if (type === 'carwash') {
                sales = DB.get('carwash_sales');
            } else {
                sales = DB.get('billar_sales');
            }
            
            const sale = sales.find(s => s.id === id);
            
            if (sale) {
                alert(`Detalles de la venta:\n\nFecha: ${new Date(sale.fecha).toLocaleString()}\nTotal: RD$ ${sale.total}\nProductos/Servicios: ${sale.productos || sale.servicios || 'N/A'}\nMétodo de pago: ${sale.metodo_pago}\nRNC: ${sale.rnc || 'Consumidor Final'}\nAprobación: ${sale.aprobacion || 'N/A'}${sale.cliente ? `\nCliente: ${sale.cliente}` : ''}`);
            }
        }

        function reprintInvoice(id, type) {
            let sales, cartData;
            if (type === 'billar') {
                sales = DB.get('billar_sales');
                const sale = sales.find(s => s.id === id);
                if (sale) {
                    // Reconstruir carrito a partir de la descripción
                    const items = sale.productos.split(', ');
                    cartData = items.map(item => {
                        const match = item.match(/(\d+)x (.+)/);
                        if (match) {
                            return {
                                name: match[2],
                                quantity: parseInt(match[1]),
                                price: 0 // No tenemos el precio histórico
                            };
                        }
                        return { name: item, quantity: 1, price: 0 };
                    });
                    
                    printInvoice('billar', cartData, sale.total, {
                        rnc: sale.rnc,
                        metodo_pago: sale.metodo_pago,
                        aprobacion: sale.aprobacion
                    });
                }
            } else if (type === 'barberia') {
                sales = DB.get('barberia_sales');
                const sale = sales.find(s => s.id === id);
                if (sale) {
                    const items = sale.servicios.split(', ');
                    cartData = items.map(item => {
                        const match = item.match(/(\d+)x (.+)/);
                        if (match) {
                            return {
                                name: match[2],
                                quantity: parseInt(match[1]),
                                price: 0
                            };
                        }
                        return { name: item, quantity: 1, price: 0 };
                    });
                    
                    printInvoice('barberia', cartData, sale.total, {
                        rnc: sale.rnc,
                        metodo_pago: sale.metodo_pago,
                        aprobacion: sale.aprobacion
                    });
                }
            }
        }

        function editClient(id) {
            const clients = DB.get('barberia_clients');
            const client = clients.find(c => c.id === id);
            
            if (client) {
                const newNombre = prompt('Nuevo nombre del cliente:', client.nombre);
                const newTelefono = prompt('Nuevo teléfono:', client.telefono || '');
                
                if (newNombre !== null) {
                    client.nombre = newNombre;
                    client.telefono = newTelefono || '';
                    DB.set('barberia_clients', clients);
                    showNotification('Cliente actualizado', 'success');
                    loadBarberiaClients();
                }
            }
        }

        function deleteClient(id) {
            if (confirm('¿Está seguro de eliminar este cliente?')) {
                DB.delete('barberia_clients', id);
                showNotification('Cliente eliminado', 'success');
                loadBarberiaClients();
            }
        }

        // =============================================
        // INICIALIZACIÓN
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('screen-login').style.display = 'flex';
            
            // Enter para login
            loginPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    btnLogin.click();
                }
            });
            
            // Enter para registro
            registerConfirmPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    btnRegister.click();
                }
            });
            
            // Cerrar modal de factura
            document.getElementById('closeInvoiceModal').addEventListener('click', function() {
                document.getElementById('invoiceModal').classList.remove('active');
            });
            
            // Imprimir factura
            document.getElementById('printInvoiceBtn').addEventListener('click', function() {
                window.print();
            });
            
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('stark_theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                document.getElementById('select-tema').value = 'light';
            }
            
            // Guardar tema
            document.getElementById('saveThemeBtn').addEventListener('click', function() {
                const tema = document.getElementById('select-tema').value;
                localStorage.setItem('stark_theme', tema);
            });
        });
    </script>
</body>
</html>