<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARK CLEANE - Sistema de Gestión</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #64b5f6;
            --secondary: #ff6d00;
            --secondary-dark: #e65100;
            --accent: #00c853;
            --danger: #d32f2f;
            --warning: #ffa000;
            --info: #0288d1;
            --dark: #121212;
            --light: #f5f7fb;
            --gray: #5f6368;
            --gray-light: #e8eaed;
            --sidebar-width: 260px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #9e9e9e;
            --border-color: #333;
            --hover-color: #2a2a2a;
        }

        .light-mode {
            --bg-color: #f5f7fb;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #5f6368;
            --border-color: #e0e0e0;
            --hover-color: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: bold;
            font-size: 1.4rem;
            color: white;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 500;
        }

        .menu-item:hover,
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid white;
            color: white;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.active {
            max-height: 300px;
        }

        .submenu-item {
            padding: 12px 20px 12px 60px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.75);
            font-size: 0.9rem;
        }

        .submenu-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .header {
            height: var(--header-height);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: var(--hover-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Content Area */
        .content {
            padding: 25px;
        }

        .page-title {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Dashboard Styles */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .barberia {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .billar {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .carwash {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .config {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .card h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .trend-up {
            color: var(--accent);
        }
        .trend-down {
            color: var(--danger);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 25px;
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        /* Table Styles */
        .table-container {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 18px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--hover-color);
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        tr:hover {
            background-color: var(--hover-color);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-success {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }

        .badge-warning {
            background: rgba(255, 160, 0, 0.15);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(2, 136, 209, 0.15);
            color: var(--info);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--accent);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Form Styles */
        .form-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-color);
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* POS Styles */
        .pos-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 18px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .product-image {
            width: 80px;
            height: 80px;
            background: var(--hover-color);
            border-radius: 10px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .product-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .product-card p {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .cart {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            border: 1px solid var(--border-color);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .cart-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover-color);
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-color);
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 20px 0;
            text-align: right;
            color: var(--secondary);
        }

        /* Vehicle Cards */
        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .vehicle-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
            border: 1px solid var(--border-color);
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .vehicle-placa {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .vehicle-type {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .car {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .jeepeta {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .motor {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .camion {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .vehicle-details {
            margin-bottom: 20px;
        }

        .vehicle-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .vehicle-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .hamburger {
                display: block;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .pos-container {
                grid-template-columns: 1fr;
            }
            .user-info {
                display: none;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Factura Styles */
        .invoice-container {
            background: white;
            color: black;
            width: 80mm;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.2;
            margin: 0 auto;
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 10px;
        }

        .invoice-logo {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .invoice-company {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .invoice-address {
            font-size: 10px;
            margin-bottom: 5px;
        }

        .invoice-rnc {
            font-size: 10px;
            margin-bottom: 10px;
        }

        .invoice-details {
            margin-bottom: 10px;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 5px 0;
        }

        .invoice-items {
            width: 100%;
            margin-bottom: 10px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .invoice-total {
            border-top: 1px dashed #000;
            padding-top: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .invoice-payment {
            margin-bottom: 10px;
        }

        .invoice-footer {
            text-align: center;
            border-top: 1px dashed #000;
            padding-top: 10px;
            font-size: 10px;
        }

        .invoice-number {
            font-weight: bold;
            margin-top: 5px;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 25px;
            background: var(--card-bg);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--accent);
            z-index: 10000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            max-width: 350px;
        }
        .notification.error {
            border-left-color: var(--danger);
        }
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notification i {
            font-size: 1.2rem;
        }
        .notification.success i {
            color: var(--accent);
        }
        .notification.error i {
            color: var(--danger);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">SC</div>
                    <span>STARK CLEANE</span>
                </div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                </div>
                <div class="menu-item" data-page="barberia">
                    <i class="fas fa-cut"></i>
                    <span>Barbería</span>
                </div>

                <div class="menu-item" data-page="billar">
                    <i class="fas fa-dice"></i>
                    <span>Billar</span>
                </div>

                <div class="menu-item" data-page="carwash">
                    <i class="fas fa-car"></i>
                    <span>Car Wash</span>
                </div>

                <div class="menu-item" data-submenu="configuracion">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu" id="configuracion-submenu">
                    <div class="submenu-item" data-page="config-usuarios">Usuarios</div>
                    <div class="submenu-item" data-page="config-impresora">Impresora</div>
                    <div class="submenu-item" data-page="config-preferencias">Preferencias</div>
                    <div class="submenu-item" data-page="config-tema">Tema</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <div class="hamburger">
                        <i class="fas fa-bars"></i>
                    </div>
                    <div class="header-title" id="headerTitle">Dashboard</div>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar">A</div>
                        <div class="user-info">
                            <div class="user-name">Administrador</div>
                            <div class="user-role">Super Admin</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- Dashboard -->
                <div class="page active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Principal</h1>
                        <div class="header-actions">
                            <button class="btn btn-outline" id="refreshDashboard">
                                <i class="fas fa-sync-alt"></i> Actualizar
                            </button>
                        </div>
                    </div>

                    <div class="dashboard-cards">
                        <div class="card" data-page="barberia">
                            <div class="card-icon barberia">
                                <i class="fas fa-cut"></i>
                            </div>
                            <h3>Barbería</h3>
                            <p>Gestión de citas y clientes</p>
                            <div class="card-value" id="appointmentsCount">0</div>
                            <div class="card-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="appointmentsTrend">0 citas hoy</span>
                            </div>
                        </div>

                        <div class="card" data-page="billar">
                            <div class="card-icon billar">
                                <i class="fas fa-dice"></i>
                            </div>
                            <h3>Billar</h3>
                            <p>Punto de venta e inventario</p>
                            <div class="card-value" id="salesTotal">RD$ 0</div>
                            <div class="card-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="salesTrend">0% más que ayer</span>
                            </div>
                        </div>

                        <div class="card" data-page="carwash">
                            <div class="card-icon carwash">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Car Wash</h3>
                            <p>Lavado de vehículos</p>
                            <div class="card-value" id="vehiclesCount">0</div>
                            <div class="card-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span id="vehiclesTrend">0 menos que ayer</span>
                            </div>
                        </div>

                        <div class="card" data-page="config-tema">
                            <div class="card-icon config">
                                <i class="fas fa-cog"></i>
                            </div>
                            <h3>Configuración</h3>
                            <p>Personaliza tu sistema</p>
                            <div class="card-value">4</div>
                            <div class="card-trend">
                                <span>Opciones disponibles</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <h3>Ingresos de Hoy</h3>
                            <div class="stat-value" id="dailyIncome">RD$ 0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="incomeTrend">0% más que ayer</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Clientes Atendidos</h3>
                            <div class="stat-value" id="customersCount">0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="customersTrend">0% más que ayer</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Productos Vendidos</h3>
                            <div class="stat-value" id="productsSold">0</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span id="productsTrend">0% menos que ayer</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Ventas de la Semana</div>
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <!-- Barbería - Página Completa -->
                <div class="page" id="barberia">
                    <div class="page-title">
                        <h1>Barbería</h1>
                        <button class="btn btn-primary" id="newAppointmentBtn">
                            <i class="fas fa-plus"></i> Nueva Cita
                        </button>
                    </div>

                    <!-- Tabs de Barbería -->
                    <div class="tabs">
                        <div class="tab active" data-tab="barberia-citas">Registrar Cliente</div>
                        <div class="tab" data-tab="barberia-lista">Lista de Citas</div>
                        <div class="tab" data-tab="barberia-historial">Historial</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="barberia-citas">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nombre"><i class="fas fa-user"></i> Nombre</label>
                                    <input type="text" id="nombre" placeholder="Ingrese el nombre completo">
                                </div>
                                <div class="form-group">
                                    <label for="telefono"><i class="fas fa-phone"></i> Teléfono</label>
                                    <input type="text" id="telefono" placeholder="Ingrese el teléfono">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="barbero"><i class="fas fa-user-tie"></i> Barbero</label>
                                    <select id="barbero">
                                        <option value="">Seleccione un barbero</option>
                                        <option value="1">Juan Pérez</option>
                                        <option value="2">Miguel Rodríguez</option>
                                        <option value="3">Carlos Sánchez</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="servicio"><i class="fas fa-concierge-bell"></i> Servicio</label>
                                    <select id="servicio">
                                        <option value="">Seleccione un servicio</option>
                                        <option value="1">Corte de cabello - RD$ 250</option>
                                        <option value="2">Afeitado - RD$ 150</option>
                                        <option value="3">Corte y barba - RD$ 350</option>
                                        <option value="4">Tinte - RD$ 400</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="precio"><i class="fas fa-dollar-sign"></i> Precio</label>
                                    <input type="number" id="precio" placeholder="RD$">
                                </div>
                                <div class="form-group">
                                    <label for="fecha-hora"><i class="fas fa-calendar-alt"></i> Fecha y Hora</label>
                                    <input type="datetime-local" id="fecha-hora">
                                </div>
                            </div>

                            <button class="btn btn-primary" id="saveAppointmentBtn">
                                <i class="fas fa-save"></i> Guardar Cita
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-lista">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Barbero</th>
                                        <th>Servicio</th>
                                        <th>Hora</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTable">
                                    <!-- Las citas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-historial">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-busqueda">Fecha</label>
                                    <input type="date" id="fecha-busqueda">
                                </div>
                                <div class="form-group">
                                    <label for="barbero-busqueda">Barbero</label>
                                    <select id="barbero-busqueda">
                                        <option value="">Todos los barberos</option>
                                        <option value="1">Juan Pérez</option>
                                        <option value="2">Miguel Rodríguez</option>
                                        <option value="3">Carlos Sánchez</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="servicio-busqueda">Servicio</label>
                                <select id="servicio-busqueda">
                                    <option value="">Todos los servicios</option>
                                    <option value="1">Corte de cabello</option>
                                    <option value="2">Afeitado</option>
                                    <option value="3">Corte y barba</option>
                                    <option value="4">Tinte</option>
                                </select>
                            </div>

                            <button class="btn btn-primary" id="searchHistoryBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 20px">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Barbero</th>
                                        <th>Servicio</th>
                                        <th>Precio</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTable">
                                    <!-- El historial se cargará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Billar - Página Completa -->
                <div class="page" id="billar">
                    <div class="page-title">
                        <h1>Billar - Sistema POS</h1>
                        <button class="btn btn-secondary" id="newProductBtn">
                            <i class="fas fa-plus"></i> Nuevo Producto
                        </button>
                    </div>

                    <!-- Tabs de Billar -->
                    <div class="tabs">
                        <div class="tab active" data-tab="billar-inventario">Inventario</div>
                        <div class="tab" data-tab="billar-pos">Punto de Venta</div>
                        <div class="tab" data-tab="billar-ventas">Ventas del Día</div>
                        <div class="tab" data-tab="billar-reportes">Reportes</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="billar-inventario">
                        <div class="page-title">
                            <h2>Inventario de Productos</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="exportProductsBtn">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                                <button class="btn btn-primary" id="addProductBtn">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Producto</th>
                                        <th>Categoría</th>
                                        <th>P. Compra</th>
                                        <th>P. Venta</th>
                                        <th>Stock</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTable">
                                    <!-- Los productos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-pos">
                        <div class="page-title">
                            <h2>Punto de Venta</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="clearCartBtn">
                                    <i class="fas fa-trash"></i> Limpiar
                                </button>
                            </div>
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group">
                                    <label for="codigo-barra"><i class="fas fa-barcode"></i> Código de Barras</label>
                                    <input type="text" id="codigo-barra" placeholder="Escanear código de barras">
                                </div>

                                <h3>Productos Disponibles</h3>
                                <div class="products-grid" id="productsGrid">
                                    <!-- Los productos para el POS se cargarán dinámicamente -->
                                </div>
                            </div>

                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Venta</div>
                                    <div class="badge badge-info" id="cartCount">0 productos</div>
                                </div>

                                <div class="cart-items" id="cartItems">
                                    <!-- Los productos del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotal">Total: RD$ 0</div>

                                <div class="form-group">
                                    <label for="metodo-pago">Método de Pago</label>
                                    <select id="metodo-pago">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <div class="form-group" id="cashPaymentSection" style="display: none;">
                                    <label for="efectivo-recibido">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido" placeholder="RD$">
                                    <div id="cambio-display" style="margin-top: 10px; font-weight: bold;"></div>
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtn">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtn">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-ventas">
                        <div class="page-title">
                            <h2>Ventas del Día</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="filterSalesBtn">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Total</th>
                                        <th>Productos Vendidos</th>
                                        <th>Método de Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTable">
                                    <!-- Las ventas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-reportes">
                        <div class="page-title">
                            <h2>Reportes</h2>
                            <div class="header-actions">
                                <button class="btn btn-success" id="exportExcelBtn">
                                    <i class="fas fa-file-excel"></i> Exportar a Excel
                                </button>
                                <button class="btn btn-danger" id="exportPdfBtn">
                                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                                </button>
                            </div>
                        </div>

                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-inicio">Fecha Inicio</label>
                                    <input type="date" id="fecha-inicio">
                                </div>
                                <div class="form-group">
                                    <label for="fecha-fin">Fecha Fin</label>
                                    <input type="date" id="fecha-fin">
                                </div>
                            </div>

                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>

                        <div class="stats" style="margin-top: 20px">
                            <div class="stat-card">
                                <h3>Total Vendido</h3>
                                <div class="stat-value" id="totalSold">RD$ 0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="soldTrend">0% más que la semana pasada</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Producto Más Vendido</h3>
                                <div class="stat-value" id="topProduct">-</div>
                                <div class="stat-trend">
                                    <span id="topProductCount">0 unidades</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Categoría Más Popular</h3>
                                <div class="stat-value" id="topCategory">-</div>
                                <div class="stat-trend">
                                    <span id="topCategoryPercent">0% de las ventas</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-title">Ventas por Categoría</div>
                            <div style="text-align: center; padding: 40px;">
                                <i class="fas fa-chart-pie" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 15px;"></i>
                                <p>La gráfica de ventas por categoría se mostrará aquí cuando se generen reportes.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Car Wash - Página Completa -->
                <div class="page" id="carwash">
                    <div class="page-title">
                        <h1>Car Wash</h1>
                        <button class="btn btn-success" id="newVehicleBtn">
                            <i class="fas fa-plus"></i> Nuevo Vehículo
                        </button>
                    </div>

                    <!-- Tabs de Car Wash -->
                    <div class="tabs">
                        <div class="tab active" data-tab="carwash-registro">Registrar Vehículo</div>
                        <div class="tab" data-tab="carwash-proceso">Vehículos en Proceso</div>
                        <div class="tab" data-tab="carwash-entregados">Vehículos Entregados</div>
                        <div class="tab" data-tab="carwash-historial">Historial</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="carwash-registro">
                        <div class="form-container">
                            <div class="form-group">
                                <label for="tipo-vehiculo"><i class="fas fa-car"></i> Tipo de Vehículo</label>
                                <select id="tipo-vehiculo">
                                    <option value="">Seleccione tipo</option>
                                    <option value="carro">Carro</option>
                                    <option value="jeepeta">Jeepeta</option>
                                    <option value="motor">Motor</option>
                                    <option value="camion">Camión</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="placa"><i class="fas fa-id-card"></i> Placa</label>
                                <input type="text" id="placa" placeholder="Ingrese la placa">
                            </div>

                            <div class="form-group">
                                <label for="servicio-vehiculo"><i class="fas fa-concierge-bell"></i> Servicio</label>
                                <select id="servicio-vehiculo">
                                    <option value="">Seleccione servicio</option>
                                    <option value="lavado-basico">Lavado Básico - RD$ 300</option>
                                    <option value="lavado-completo">Lavado Completo - RD$ 450</option>
                                    <option value="lavado-motor">Lavado de Motor - RD$ 200</option>
                                    <option value="pulido">Pulido - RD$ 600</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="precio-vehiculo"><i class="fas fa-dollar-sign"></i> Precio</label>
                                    <input type="number" id="precio-vehiculo" placeholder="RD$">
                                </div>
                                <div class="form-group">
                                    <label for="empleado-vehiculo"><i class="fas fa-user"></i> Empleado (Opcional)</label>
                                    <select id="empleado-vehiculo">
                                        <option value="">Seleccione empleado</option>
                                        <option value="1">Pedro Martínez</option>
                                        <option value="2">José Rodríguez</option>
                                        <option value="3">Ana Sánchez</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="hora-entrada"><i class="fas fa-clock"></i> Hora de Entrada</label>
                                <input type="datetime-local" id="hora-entrada">
                            </div>

                            <button class="btn btn-success" id="saveVehicleBtn">
                                <i class="fas fa-save"></i> Registrar Vehículo
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-proceso">
                        <div class="vehicles-grid" id="vehiclesGrid">
                            <!-- Los vehículos en proceso se cargarán dinámicamente -->
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-entregados">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Placa</th>
                                        <th>Tipo</th>
                                        <th>Servicio</th>
                                        <th>Precio</th>
                                        <th>Hora Entrada</th>
                                        <th>Hora Salida</th>
                                    </tr>
                                </thead>
                                <tbody id="completedVehiclesTable">
                                    <!-- Los vehículos entregados se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-historial">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-carwash">Fecha</label>
                                    <input type="date" id="fecha-carwash">
                                </div>
                                <div class="form-group">
                                    <label for="tipo-filtro">Tipo de Vehículo</label>
                                    <select id="tipo-filtro">
                                        <option value="">Todos los tipos</option>
                                        <option value="carro">Carro</option>
                                        <option value="jeepeta">Jeepeta</option>
                                        <option value="motor">Motor</option>
                                        <option value="camion">Camión</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="servicio-filtro">Servicio</label>
                                <select id="servicio-filtro">
                                    <option value="">Todos los servicios</option>
                                    <option value="lavado-basico">Lavado Básico</option>
                                    <option value="lavado-completo">Lavado Completo</option>
                                    <option value="lavado-motor">Lavado de Motor</option>
                                    <option value="pulido">Pulido</option>
                                </select>
                            </div>

                            <button class="btn btn-primary" id="searchCarwashBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 20px">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Placa</th>
                                        <th>Tipo</th>
                                        <th>Servicio</th>
                                        <th>Precio</th>
                                    </tr>
                                </thead>
                                <tbody id="carwashHistoryTable">
                                    <!-- El historial se cargará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Tema -->
                <div class="page" id="config-tema">
                    <div class="page-title">
                        <h1>Configuración - Tema</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="select-tema">Seleccionar Tema</label>
                            <select id="select-tema">
                                <option value="dark">Oscuro</option>
                                <option value="light">Claro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Vista Previa</label>
                            <div class="card">
                                <div class="card-icon barberia">
                                    <i class="fas fa-cut"></i>
                                </div>
                                <h3>Ejemplo de Tarjeta</h3>
                                <p>Esta es una vista previa del tema seleccionado</p>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="saveThemeBtn">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar producto -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Agregar Nuevo Producto</div>
                <button class="modal-close" id="closeProductModal">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigo-barra-producto">Código de Barras</label>
                        <input type="text" id="codigo-barra-producto" placeholder="Ingrese código de barras">
                    </div>
                    <div class="form-group">
                        <label for="nombre-producto">Nombre del Producto</label>
                        <input type="text" id="nombre-producto" placeholder="Ingrese nombre del producto">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="categoria-producto">Categoría</label>
                        <select id="categoria-producto">
                            <option value="">Seleccione categoría</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="licores">Licores</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fecha-ingreso">Fecha de Ingreso</label>
                        <input type="date" id="fecha-ingreso">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="precio-compra">Precio de Compra</label>
                        <input type="number" id="precio-compra" placeholder="RD$">
                    </div>
                    <div class="form-group">
                        <label for="precio-venta">Precio de Venta</label>
                        <input type="number" id="precio-venta" placeholder="RD$">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cantidad-stock">Cantidad en Stock</label>
                        <input type="number" id="cantidad-stock" placeholder="Cantidad">
                    </div>
                    <div class="form-group">
                        <label for="alerta-stock">Alerta de Stock</label>
                        <input type="number" id="alerta-stock" placeholder="Mínimo">
                    </div>
                </div>

                <button class="btn btn-primary" id="saveProductBtn">
                    <i class="fas fa-save"></i> Guardar Producto
                </button>
            </div>
        </div>
    </div>

    <!-- Factura Modal -->
    <div class="modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Factura</div>
                <button class="modal-close" id="closeInvoiceModal">&times;</button>
            </div>
            <div class="invoice-container" id="invoiceContent">
                <!-- La factura se generará aquí -->
            </div>
            <div class="action-buttons" style="margin-top: 20px; justify-content: center;">
                <button class="btn btn-primary" id="printInvoiceBtn">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" id="downloadInvoiceBtn">
                    <i class="fas fa-download"></i> Descargar PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE BASE DE DATOS SIMPLIFICADO
        // =============================================

        // Sistema de almacenamiento usando localStorage
        const DB = {
            // Obtener datos
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch (error) {
                    console.error('Error al obtener datos:', error);
                    return [];
                }
            },

            // Guardar datos
            set: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Error al guardar datos:', error);
                    return false;
                }
            },

            // Agregar item
            add: (key, item) => {
                const data = DB.get(key);
                item.id = Date.now(); // ID único basado en timestamp
                data.push(item);
                return DB.set(key, data) ? item.id : null;
            },

            // Actualizar item
            update: (key, id, updates) => {
                const data = DB.get(key);
                const index = data.findIndex(item => item.id === id);
                if (index !== -1) {
                    data[index] = { ...data[index], ...updates };
                    return DB.set(key, data);
                }
                return false;
            },

            // Eliminar item
            delete: (key, id) => {
                const data = DB.get(key);
                const filtered = data.filter(item => item.id !== id);
                return DB.set(key, filtered);
            }
        };

        // =============================================
        // SISTEMA DE FACTURACIÓN
        // =============================================

        // Obtener el próximo número de factura
        function getNextInvoiceNumber() {
            const invoices = DB.get('invoices');
            if (invoices.length === 0) {
                return 123; // Número inicial
            }
            const maxNumber = Math.max(...invoices.map(inv => inv.numero));
            return maxNumber + 1;
        }

        // Guardar factura
        function saveInvoice(invoiceData) {
            const invoiceNumber = getNextInvoiceNumber();
            invoiceData.numero = invoiceNumber;
            invoiceData.fecha = new Date().toISOString();
            invoiceData.id = Date.now();
            
            const invoices = DB.get('invoices');
            invoices.push(invoiceData);
            DB.set('invoices', invoices);
            
            return { id: invoiceData.id, numero: invoiceNumber };
        }

        // Generar contenido de factura
        function generateInvoiceContent(invoiceData) {
            const now = new Date();
            const formattedDate = now.toLocaleDateString('es-ES');
            const formattedTime = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            let itemsHTML = '';
            invoiceData.items.forEach(item => {
                itemsHTML += `
                    <div class="invoice-item">
                        <span>${item.cantidad}x ${item.descripcion}</span>
                        <span>RD$${item.precio}</span>
                    </div>
                `;
            });

            return `
                <div class="invoice-container">
                    <div class="invoice-header">
                        <div class="invoice-logo">★</div>
                        <div class="invoice-company">Detailing STARK CLEANE</div>
                        <div class="invoice-address">Dirección Detailing Stark Cleaner 15000, Santo Domingo 15000</div>
                        <div class="invoice-address">Tel: +1(829) 272-5182</div>
                        <div class="invoice-rnc">RNC: 000-0000000-0</div>
                    </div>
                    
                    <div class="invoice-details">
                        <div>FACT #: ${invoiceData.numero.toString().padStart(7, '0')}</div>
                        <div>Fecha: ${formattedDate} ${formattedTime}</div>
                        <div>Cajero: Antoni</div>
                        <div>Cliente: ${invoiceData.cliente || 'Consumidor Final'}</div>
                    </div>
                    
                    <div class="invoice-items">
                        ${itemsHTML}
                    </div>
                    
                    <div class="invoice-total">
                        <div class="invoice-item">
                            <span>Total</span>
                            <span>RD$${invoiceData.total}</span>
                        </div>
                    </div>
                    
                    <div class="invoice-payment">
                        <div>Método: ${invoiceData.metodoPago}</div>
                        ${invoiceData.efectivoRecibido ? `<div>Efectivo: RD$${invoiceData.efectivoRecibido}</div>` : ''}
                        ${invoiceData.cambio ? `<div>Cambio: RD$${invoiceData.cambio}</div>` : ''}
                    </div>
                    
                    <div class="invoice-footer">
                        <div>Gracias por su visita</div>
                        <div class="invoice-number">${invoiceData.numero.toString().padStart(7, '0')}</div>
                    </div>
                </div>
            `;
        }

        // Mostrar modal de factura
        function showInvoiceModal(invoiceData) {
            const invoiceContent = document.getElementById('invoiceContent');
            invoiceContent.innerHTML = generateInvoiceContent(invoiceData);
            
            const invoiceModal = document.getElementById('invoiceModal');
            invoiceModal.classList.add('active');
            
            // Guardar la factura actual para reimpresión
            window.currentInvoice = invoiceData;
        }

        // Imprimir factura
        function printInvoice() {
            const invoiceContent = document.getElementById('invoiceContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Factura STARK CLEANE</title>
                        <style>
                            body { font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.2; }
                            .invoice-container { width: 80mm; padding: 15px; margin: 0 auto; }
                            .invoice-header { text-align: center; margin-bottom: 10px; }
                            .invoice-logo { font-size: 24px; margin-bottom: 5px; }
                            .invoice-company { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
                            .invoice-address { font-size: 10px; margin-bottom: 5px; }
                            .invoice-rnc { font-size: 10px; margin-bottom: 10px; }
                            .invoice-details { margin-bottom: 10px; border-top: 1px dashed #000; border-bottom: 1px dashed #000; padding: 5px 0; }
                            .invoice-items { width: 100%; margin-bottom: 10px; }
                            .invoice-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
                            .invoice-total { border-top: 1px dashed #000; padding-top: 5px; margin-bottom: 10px; font-weight: bold; }
                            .invoice-payment { margin-bottom: 10px; }
                            .invoice-footer { text-align: center; border-top: 1px dashed #000; padding-top: 10px; font-size: 10px; }
                            .invoice-number { font-weight: bold; margin-top: 5px; }
                        </style>
                    </head>
                    <body>
                        ${invoiceContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Descargar factura como PDF (simulada)
        function downloadInvoiceAsPDF() {
            showNotification("Para descargar como PDF, use la opción 'Guardar como PDF' en el diálogo de impresión", "success");
            printInvoice();
        }

        // Generar factura desde Barbería
        function generateBarberiaInvoice(appointment) {
            const total = parseFloat(appointment.precio.replace('RD$ ', ''));
            
            const invoiceData = {
                cliente: appointment.cliente,
                items: [
                    {
                        cantidad: 1,
                        descripcion: appointment.servicio,
                        precio: total
                    }
                ],
                total: total,
                metodoPago: 'Efectivo'
            };
            
            const { numero } = saveInvoice(invoiceData);
            invoiceData.numero = numero;
            
            showInvoiceModal(invoiceData);
            return numero;
        }

        // Generar factura desde Billar
        function generateBillarInvoice(saleData) {
            const total = saleData.total;
            const items = saleData.items.map(item => ({
                cantidad: item.quantity,
                descripcion: item.name,
                precio: item.price
            }));
            
            const invoiceData = {
                cliente: saleData.cliente || 'Consumidor Final',
                items: items,
                total: total,
                metodoPago: saleData.metodoPago,
                efectivoRecibido: saleData.efectivoRecibido,
                cambio: saleData.cambio
            };
            
            const { numero } = saveInvoice(invoiceData);
            invoiceData.numero = numero;
            
            showInvoiceModal(invoiceData);
            return numero;
        }

        // Generar factura desde Car Wash
        function generateCarWashInvoice(vehicle) {
            const total = parseFloat(vehicle.precio.replace('RD$ ', ''));
            
            const invoiceData = {
                cliente: `Vehículo ${vehicle.placa}`,
                items: [
                    {
                        cantidad: 1,
                        descripcion: vehicle.servicio,
                        precio: total
                    }
                ],
                total: total,
                metodoPago: 'Efectivo'
            };
            
            const { numero } = saveInvoice(invoiceData);
            invoiceData.numero = numero;
            
            showInvoiceModal(invoiceData);
            return numero;
        }

        // =============================================
        // FUNCIONES ESPECÍFICAS PARA CADA MÓDULO
        // =============================================

        // Barbería
        function saveAppointment(appointment) {
            appointment.fecha = new Date().toISOString();
            appointment.estado = 'pendiente';
            const id = DB.add('appointments', appointment);
            loadAppointments();
            return id;
        }

        function loadAppointments() {
            const appointments = DB.get('appointments');
            updateAppointmentsTable(appointments);
            updateDashboardStats();
            return appointments;
        }

        function deleteAppointment(id) {
            DB.delete('appointments', id);
            loadAppointments();
        }

        // Billar - Productos
        function saveProduct(product) {
            product.fecha_ingreso = new Date().toISOString();
            product.stock = parseInt(product.stock);
            const id = DB.add('products', product);
            loadProducts();
            return id;
        }

        function loadProducts() {
            const products = DB.get('products');
            updateProductsTable(products);
            updateProductsGrid(products);
            updateDashboardStats();
            return products;
        }

        function deleteProduct(id) {
            DB.delete('products', id);
            loadProducts();
        }

        // Car Wash
        function saveVehicle(vehicle) {
            vehicle.estado = "proceso";
            vehicle.hora_entrada = new Date().toISOString();
            const id = DB.add('vehicles', vehicle);
            loadVehicles();
            return id;
        }

        function loadVehicles() {
            const vehicles = DB.get('vehicles');
            updateVehiclesGrid(vehicles);
            updateCompletedVehicles();
            updateDashboardStats();
            return vehicles;
        }

        function markVehicleAsCompleted(vehicleId) {
            const vehicles = DB.get('vehicles');
            const vehicle = vehicles.find((v) => v.id === vehicleId);

            if (vehicle) {
                vehicle.estado = "completado";
                vehicle.hora_salida = new Date().toISOString();

                // Mover a completed_vehicles
                DB.add('completed_vehicles', vehicle);

                // Eliminar de vehicles
                DB.delete('vehicles', vehicleId);

                loadVehicles();
            }
        }

        function loadCompletedVehicles() {
            return DB.get('completed_vehicles');
        }

        // Ventas
        function saveSale(sale) {
            sale.fecha = new Date().toISOString();
            const id = DB.add('sales', sale);
            loadSales();
            return id;
        }

        function loadSales() {
            const sales = DB.get('sales');
            updateSalesTable(sales);
            updateDashboardStats();
            return sales;
        }

        // =============================================
        // ACTUALIZACIÓN DE LA INTERFAZ
        // =============================================

        // Actualizar tabla de citas
        function updateAppointmentsTable(appointments) {
            const tableBody = document.getElementById("appointmentsTable");
            tableBody.innerHTML = "";

            appointments.forEach((appointment) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${appointment.cliente}</td>
                    <td>${appointment.barbero}</td>
                    <td>${appointment.servicio}</td>
                    <td>${new Date(appointment.fecha).toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})}</td>
                    <td><span class="badge badge-warning"><i class="fas fa-clock"></i> Pendiente</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-outline btn-sm edit-appointment"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-success btn-sm complete-appointment"><i class="fas fa-check"></i></button>
                        <button class="btn btn-primary btn-sm invoice-appointment" data-id="${appointment.id}"><i class="fas fa-receipt"></i> Facturar</button>
                        <button class="btn btn-danger btn-sm delete-appointment" data-id="${appointment.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Agregar event listeners
            document.querySelectorAll(".delete-appointment").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    deleteAppointment(id);
                });
            });

            document.querySelectorAll(".invoice-appointment").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    const appointment = appointments.find(a => a.id === id);
                    if (appointment) {
                        generateBarberiaInvoice(appointment);
                    }
                });
            });
        }

        // Actualizar tabla de productos
        function updateProductsTable(products) {
            const tableBody = document.getElementById("productsTable");
            tableBody.innerHTML = "";

            products.forEach((product) => {
                const estado = product.stock > 15 ? "Disponible" : "Bajo Stock";
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${product.codigo}</td>
                    <td>${product.nombre}</td>
                    <td>${product.categoria}</td>
                    <td>RD$ ${product.precio_compra}</td>
                    <td>RD$ ${product.precio_venta}</td>
                    <td>${product.stock}</td>
                    <td><span class="badge ${estado === "Disponible" ? "badge-success" : "badge-warning"}">${estado}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-outline btn-sm edit-product"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-product" data-id="${product.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            document.querySelectorAll(".delete-product").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    deleteProduct(id);
                });
            });
        }

        // Actualizar grid de productos para POS
        function updateProductsGrid(products) {
            const grid = document.getElementById("productsGrid");
            grid.innerHTML = "";

            products.forEach((product) => {
                const card = document.createElement("div");
                card.className = "product-card";
                card.setAttribute("data-id", product.id);
                card.innerHTML = `
                    <div class="product-image">
                        <i class="fas fa-${getProductIcon(product.categoria)}"></i>
                    </div>
                    <h4>${product.nombre}</h4>
                    <p>RD$ ${product.precio_venta}</p>
                `;
                grid.appendChild(card);
            });

            document.querySelectorAll(".product-card").forEach((card) => {
                card.addEventListener("click", function () {
                    const productId = parseInt(this.getAttribute("data-id"));
                    addToCart(productId);
                });
            });
        }

        // Obtener icono según categoría
        function getProductIcon(categoria) {
            const icons = {
                bebidas: "wine-bottle",
                snacks: "cookie",
                licores: "glass-whiskey",
                otros: "box",
            };
            return icons[categoria] || "box";
        }

        // Actualizar grid de vehículos
        function updateVehiclesGrid(vehicles) {
            const grid = document.getElementById("vehiclesGrid");
            grid.innerHTML = "";

            const vehiclesInProcess = vehicles.filter((v) => v.estado === "proceso");

            vehiclesInProcess.forEach((vehicle) => {
                const card = document.createElement("div");
                card.className = "vehicle-card";
                card.innerHTML = `
                    <div class="vehicle-header">
                        <div class="vehicle-placa">${vehicle.placa}</div>
                        <span class="vehicle-type ${vehicle.tipo}">${vehicle.tipo}</span>
                    </div>
                    <div class="vehicle-details">
                        <div class="vehicle-detail">
                            <span>Servicio:</span>
                            <span>${vehicle.servicio}</span>
                        </div>
                        <div class="vehicle-detail">
                            <span>Precio:</span>
                            <span>${vehicle.precio}</span>
                        </div>
                        <div class="vehicle-detail">
                            <span>Empleado:</span>
                            <span>${vehicle.empleado || "No asignado"}</span>
                        </div>
                    </div>
                    <p class="vehicle-time"><i class="fas fa-clock"></i> Tiempo transcurrido: ${calculateTimeElapsed(vehicle.hora_entrada)}</p>
                    <div class="action-buttons">
                        <button class="btn btn-success mark-ready" data-id="${vehicle.id}">
                            <i class="fas fa-check"></i> Marcar como Listo
                        </button>
                        <button class="btn btn-primary invoice-vehicle" data-id="${vehicle.id}">
                            <i class="fas fa-receipt"></i> Facturar
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });

            document.querySelectorAll(".mark-ready").forEach((button) => {
                button.addEventListener("click", function () {
                    const vehicleId = parseInt(this.getAttribute("data-id"));
                    markVehicleAsCompleted(vehicleId);
                });
            });

            document.querySelectorAll(".invoice-vehicle").forEach((button) => {
                button.addEventListener("click", function () {
                    const vehicleId = parseInt(this.getAttribute("data-id"));
                    const vehicle = vehiclesInProcess.find(v => v.id === vehicleId);
                    if (vehicle) {
                        generateCarWashInvoice(vehicle);
                    }
                });
            });
        }

        // Calcular tiempo transcurrido
        function calculateTimeElapsed(startTime) {
            const start = new Date(startTime);
            const now = new Date();
            const diffMs = now - start;
            const diffMins = Math.floor(diffMs / 60000);
            return `${diffMins} min`;
        }

        // Actualizar vehículos completados
        function updateCompletedVehicles() {
            const completedVehicles = loadCompletedVehicles();
            const tableBody = document.getElementById("completedVehiclesTable");
            tableBody.innerHTML = "";

            completedVehicles.forEach((vehicle) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${vehicle.placa}</td>
                    <td><span class="badge badge-info">${vehicle.tipo}</span></td>
                    <td>${vehicle.servicio}</td>
                    <td>${vehicle.precio}</td>
                    <td>${new Date(vehicle.hora_entrada).toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})}</td>
                    <td>${vehicle.hora_salida ? new Date(vehicle.hora_salida).toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'}) : 'N/A'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Actualizar tabla de ventas
        function updateSalesTable(sales) {
            const tableBody = document.getElementById("salesTable");
            tableBody.innerHTML = "";

            sales.forEach((sale) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${new Date(sale.fecha).toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'})}</td>
                    <td>${sale.total}</td>
                    <td>${sale.productos}</td>
                    <td><span class="badge badge-success">${sale.metodo_pago}</span></td>
                    <td>
                        <button class="btn btn-outline btn-sm reprint-ticket" data-id="${sale.id}">
                            <i class="fas fa-print"></i> Reimprimir
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Actualizar estadísticas del dashboard
        function updateDashboardStats() {
            const appointments = DB.get('appointments');
            const products = DB.get('products');
            const vehicles = DB.get('vehicles');
            const sales = DB.get('sales');

            // Actualizar contadores
            document.getElementById("appointmentsCount").textContent = appointments.length;
            document.getElementById("vehiclesCount").textContent = vehicles.filter((v) => v.estado === "proceso").length;

            // Calcular total de ventas
            const totalSales = sales.reduce((sum, sale) => {
                const amount = parseFloat(sale.total.replace("RD$ ", "")) || 0;
                return sum + amount;
            }, 0);

            document.getElementById("salesTotal").textContent = `RD$ ${totalSales.toLocaleString()}`;
            document.getElementById("dailyIncome").textContent = `RD$ ${totalSales.toLocaleString()}`;

            // Actualizar otros contadores
            document.getElementById("customersCount").textContent = appointments.length;
            document.getElementById("productsSold").textContent = products.reduce((sum, product) => sum + (product.vendidos || 0), 0);
        }

        // =============================================
        // FUNCIONALIDAD DEL CARRITO DE COMPRAS
        // =============================================

        let cart = [];

        function addToCart(productId) {
            const products = DB.get('products');
            const product = products.find(p => p.id === productId);

            if (!product) {
                showNotification("Producto no encontrado", "error");
                return;
            }

            const existingItem = cart.find((item) => item.id === productId);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: product.id,
                    name: product.nombre,
                    price: product.precio_venta,
                    quantity: 1
                });
            }

            updateCartUI();
            showNotification(`"${product.nombre}" agregado al carrito`, "success");
        }

        function updateCartUI() {
            const cartItems = document.getElementById("cartItems");
            const cartCount = document.getElementById("cartCount");
            const cartTotal = document.getElementById("cartTotal");

            cartItems.innerHTML = "";
            let total = 0;

            cart.forEach((item) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const cartItem = document.createElement("div");
                cartItem.className = "cart-item";
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                    </div>
                    <div class="cart-item-total">RD$ ${itemTotal}</div>
                `;
                cartItems.appendChild(cartItem);
            });

            cartCount.textContent = `${cart.length} productos`;
            cartTotal.textContent = `Total: RD$ ${total}`;

            // Agregar event listeners a los botones de cantidad
            document.querySelectorAll(".quantity-btn.increase").forEach((button) => {
                button.addEventListener("click", function () {
                    const productId = parseInt(this.getAttribute("data-id"));
                    const item = cart.find((item) => item.id === productId);
                    if (item) {
                        item.quantity++;
                        updateCartUI();
                    }
                });
            });

            document.querySelectorAll(".quantity-btn.decrease").forEach((button) => {
                button.addEventListener("click", function () {
                    const productId = parseInt(this.getAttribute("data-id"));
                    const item = cart.find((item) => item.id === productId);
                    if (item && item.quantity > 1) {
                        item.quantity--;
                        updateCartUI();
                    }
                });
            });
        }

        // =============================================
        // FUNCIONALIDADES GENERALES
        // =============================================

        // Mostrar notificación
        function showNotification(message, type) {
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === "success" ? "check-circle" : "exclamation-circle"}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Inicializar gráficos
        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById("salesChart").getContext("2d");
            new Chart(salesCtx, {
                type: "line",
                data: {
                    labels: ["Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
                    datasets: [
                        {
                            label: "Ventas (RD$)",
                            data: [12000, 19000, 15000, 25000, 22000, 30000, 28000],
                            borderColor: "#1a73e8",
                            backgroundColor: "rgba(26, 115, 232, 0.1)",
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: "top",
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                        },
                    },
                },
            });
        }

        // =============================================
        // INICIALIZACIÓN DE LA APLICACIÓN
        // =============================================

        // Inicializar la aplicación
        function initApp() {
            try {
                // Inicializar datos de ejemplo si no existen
                if (DB.get('products').length === 0) {
                    // Agregar algunos productos de ejemplo
                    const sampleProducts = [
                        {
                            codigo: '001',
                            nombre: 'Coca-Cola',
                            categoria: 'bebidas',
                            precio_compra: 50,
                            precio_venta: 80,
                            stock: 100,
                            alerta_stock: 10
                        },
                        {
                            codigo: '002',
                            nombre: 'Papitas',
                            categoria: 'snacks',
                            precio_compra: 30,
                            precio_venta: 60,
                            stock: 50,
                            alerta_stock: 5
                        }
                    ];
                    sampleProducts.forEach(product => DB.add('products', product));
                }

                // Cargar datos iniciales
                loadAppointments();
                loadProducts();
                loadVehicles();
                loadSales();

                // Inicializar gráficos
                initializeCharts();

                // Inicializar carrito
                updateCartUI();

                showNotification("Sistema cargado correctamente", "success");
            } catch (error) {
                console.error("Error al inicializar la aplicación:", error);
                showNotification("Error al cargar el sistema", "error");
            }
        }

        // =============================================
        // EVENT LISTENERS
        // =============================================

        // Toggle sidebar on mobile
        document.querySelector(".hamburger").addEventListener("click", function () {
            document.querySelector(".sidebar").classList.toggle("active");
        });

        // Toggle dark/light mode
        document.getElementById("themeToggle").addEventListener("click", function () {
            if (document.body.classList.contains("dark-mode")) {
                document.body.classList.remove("dark-mode");
                document.body.classList.add("light-mode");
                document.getElementById("themeToggle").innerHTML = '<i class="fas fa-sun"></i>';
                document.getElementById("select-tema").value = "light";
            } else {
                document.body.classList.remove("light-mode");
                document.body.classList.add("dark-mode");
                document.getElementById("themeToggle").innerHTML = '<i class="fas fa-moon"></i>';
                document.getElementById("select-tema").value = "dark";
            }
        });

        // Toggle submenus
        document.querySelectorAll(".menu-item[data-submenu]").forEach((item) => {
            item.addEventListener("click", function () {
                const submenuId = this.getAttribute("data-submenu") + "-submenu";
                document.getElementById(submenuId).classList.toggle("active");
                this.querySelector(".fa-chevron-down").classList.toggle("fa-chevron-up");
            });
        });

        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll(".page").forEach((page) => {
                page.classList.remove("active");
            });

            document.getElementById(pageId).classList.add("active");

            document.querySelectorAll(".menu-item").forEach((menuItem) => {
                menuItem.classList.remove("active");
            });

            const activeMenuItem = document.querySelector(`.menu-item[data-page="${pageId}"]`);
            if (activeMenuItem) {
                activeMenuItem.classList.add("active");
            }

            const pageTitles = {
                dashboard: "Dashboard",
                barberia: "Barbería",
                billar: "Billar - Sistema POS",
                carwash: "Car Wash",
                "config-tema": "Configuración - Tema",
            };

            document.getElementById("headerTitle").textContent = pageTitles[pageId] || "STARK CLEANE";

            if (window.innerWidth < 1200) {
                document.querySelector(".sidebar").classList.remove("active");
            }
        }

        // Set up event listeners for menu items
        document.querySelectorAll(".menu-item, .submenu-item").forEach((item) => {
            item.addEventListener("click", function () {
                if (this.getAttribute("data-page")) {
                    const pageId = this.getAttribute("data-page");
                    showPage(pageId);
                }
            });
        });

        // Set up event listeners for dashboard cards
        document.querySelectorAll(".dashboard-cards .card").forEach((card) => {
            card.addEventListener("click", function () {
                const pageId = this.getAttribute("data-page");
                if (pageId) {
                    showPage(pageId);
                }
            });
        });

        // Tabs functionality
        document.querySelectorAll(".tab").forEach((tab) => {
            tab.addEventListener("click", function () {
                const tabId = this.getAttribute("data-tab");
                
                // Hide all tab contents
                document.querySelectorAll(".tab-content").forEach((content) => {
                    content.classList.remove("active");
                });

                // Show selected tab content
                document.getElementById(tabId).classList.add("active");

                // Update active tab
                document.querySelectorAll(".tab").forEach((t) => {
                    t.classList.remove("active");
                });
                this.classList.add("active");
            });
        });

        // Modal functionality
        const productModal = document.getElementById("productModal");
        const addProductBtn = document.getElementById("addProductBtn");
        const closeProductModal = document.getElementById("closeProductModal");
        const saveProductBtn = document.getElementById("saveProductBtn");

        addProductBtn.addEventListener("click", function () {
            productModal.classList.add("active");
        });

        closeProductModal.addEventListener("click", function () {
            productModal.classList.remove("active");
        });

        // Save product
        saveProductBtn.addEventListener("click", function () {
            const codigo = document.getElementById("codigo-barra-producto").value;
            const nombre = document.getElementById("nombre-producto").value;
            const categoria = document.getElementById("categoria-producto").value;
            const precioCompra = document.getElementById("precio-compra").value;
            const precioVenta = document.getElementById("precio-venta").value;
            const stock = document.getElementById("cantidad-stock").value;

            if (nombre && codigo && categoria && precioCompra && precioVenta && stock) {
                const product = {
                    codigo: codigo,
                    nombre: nombre,
                    categoria: categoria,
                    precio_compra: parseFloat(precioCompra),
                    precio_venta: parseFloat(precioVenta),
                    stock: parseInt(stock),
                    alerta_stock: parseInt(document.getElementById("alerta-stock").value) || 10,
                };

                saveProduct(product);
                productModal.classList.remove("active");

                // Clear the form
                document.getElementById("codigo-barra-producto").value = "";
                document.getElementById("nombre-producto").value = "";
                document.getElementById("categoria-producto").value = "";
                document.getElementById("precio-compra").value = "";
                document.getElementById("precio-venta").value = "";
                document.getElementById("cantidad-stock").value = "";
                document.getElementById("alerta-stock").value = "";

                showNotification("Producto guardado correctamente", "success");
            } else {
                showNotification("Por favor, complete todos los campos", "error");
            }
        });

        // Close modal when clicking outside
        window.addEventListener("click", function (event) {
            if (event.target === productModal) {
                productModal.classList.remove("active");
            }
            if (event.target === document.getElementById("invoiceModal")) {
                document.getElementById("invoiceModal").classList.remove("active");
            }
        });

        // Save appointment
        document.getElementById("saveAppointmentBtn").addEventListener("click", function () {
            const nombre = document.getElementById("nombre").value;
            const telefono = document.getElementById("telefono").value;
            const barbero = document.getElementById("barbero").value;
            const servicio = document.getElementById("servicio").value;
            const precio = document.getElementById("precio").value;
            const fechaHora = document.getElementById("fecha-hora").value;

            if (nombre && telefono && barbero && servicio && precio && fechaHora) {
                const appointment = {
                    cliente: nombre,
                    telefono: telefono,
                    barbero: document.getElementById("barbero").options[document.getElementById("barbero").selectedIndex].text,
                    servicio: document.getElementById("servicio").options[document.getElementById("servicio").selectedIndex].text.split(" - ")[0],
                    precio: `RD$ ${precio}`,
                    hora: new Date(fechaHora).toLocaleTimeString("es-ES", {
                        hour: "2-digit",
                        minute: "2-digit",
                    }),
                };

                saveAppointment(appointment);

                // Clear the form
                document.getElementById("nombre").value = "";
                document.getElementById("telefono").value = "";
                document.getElementById("barbero").value = "";
                document.getElementById("servicio").value = "";
                document.getElementById("precio").value = "";
                document.getElementById("fecha-hora").value = "";

                showNotification("Cita guardada correctamente", "success");
            } else {
                showNotification("Por favor, complete todos los campos", "error");
            }
        });

        // Save vehicle
        document.getElementById("saveVehicleBtn").addEventListener("click", function () {
            const tipo = document.getElementById("tipo-vehiculo").value;
            const placa = document.getElementById("placa").value;
            const servicio = document.getElementById("servicio-vehiculo").value;
            const precio = document.getElementById("precio-vehiculo").value;
            const empleado = document.getElementById("empleado-vehiculo").value;
            const horaEntrada = document.getElementById("hora-entrada").value;

            if (tipo && placa && servicio && precio && horaEntrada) {
                const vehicle = {
                    placa: placa,
                    tipo: tipo,
                    servicio: document.getElementById("servicio-vehiculo").options[document.getElementById("servicio-vehiculo").selectedIndex].text.split(" - ")[0],
                    precio: `RD$ ${precio}`,
                    empleado: empleado ? document.getElementById("empleado-vehiculo").options[document.getElementById("empleado-vehiculo").selectedIndex].text : "No asignado",
                    hora_entrada: horaEntrada,
                };

                saveVehicle(vehicle);

                // Clear the form
                document.getElementById("tipo-vehiculo").value = "";
                document.getElementById("placa").value = "";
                document.getElementById("servicio-vehiculo").value = "";
                document.getElementById("precio-vehiculo").value = "";
                document.getElementById("empleado-vehiculo").value = "";
                document.getElementById("hora-entrada").value = "";

                showNotification("Vehículo registrado correctamente", "success");
            } else {
                showNotification("Por favor, complete todos los campos obligatorios", "error");
            }
        });

        // Mostrar/ocultar sección de efectivo según método de pago
        document.getElementById("metodo-pago").addEventListener("change", function() {
            const cashSection = document.getElementById("cashPaymentSection");
            if (this.value === "efectivo") {
                cashSection.style.display = "block";
            } else {
                cashSection.style.display = "none";
            }
        });

        // Calcular cambio cuando se ingresa efectivo
        document.getElementById("efectivo-recibido").addEventListener("input", function() {
            const efectivo = parseFloat(this.value) || 0;
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const cambio = efectivo - total;
            
            const cambioDisplay = document.getElementById("cambio-display");
            if (cambio >= 0) {
                cambioDisplay.textContent = `Cambio: RD$${cambio.toFixed(2)}`;
                cambioDisplay.style.color = "var(--accent)";
            } else {
                cambioDisplay.textContent = `Faltan: RD$${Math.abs(cambio).toFixed(2)}`;
                cambioDisplay.style.color = "var(--danger)";
            }
        });

        // Confirm sale
        document.getElementById("confirmSaleBtn").addEventListener("click", function () {
            if (cart.length === 0) {
                showNotification("El carrito está vacío", "error");
                return;
            }

            const metodoPago = document.getElementById("metodo-pago").value;
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const productos = cart.map((item) => `${item.name} (${item.quantity})`).join(", ");

            let efectivoRecibido = null;
            let cambio = null;

            if (metodoPago === "efectivo") {
                efectivoRecibido = parseFloat(document.getElementById("efectivo-recibido").value) || 0;
                if (efectivoRecibido < total) {
                    showNotification("El efectivo recibido es menor al total", "error");
                    return;
                }
                cambio = efectivoRecibido - total;
            }

            const sale = {
                total: `RD$ ${total}`,
                productos: productos,
                metodo_pago: metodoPago,
            };

            saveSale(sale);

            // Generar factura
            const saleData = {
                total: total,
                items: cart.map(item => ({
                    cantidad: item.quantity,
                    descripcion: item.name,
                    precio: item.price
                })),
                metodoPago: metodoPago,
                efectivoRecibido: efectivoRecibido,
                cambio: cambio
            };

            generateBillarInvoice(saleData);

            // Limpiar carrito
            cart = [];
            updateCartUI();
            document.getElementById("efectivo-recibido").value = "";
            document.getElementById("cambio-display").textContent = "";

            showNotification("Venta confirmada correctamente", "success");
        });

        // Clear cart
        document.getElementById("clearCartBtn").addEventListener("click", function () {
            cart = [];
            updateCartUI();
            document.getElementById("efectivo-recibido").value = "";
            document.getElementById("cambio-display").textContent = "";
            showNotification("Carrito vaciado", "success");
        });

        // Refresh dashboard
        document.getElementById("refreshDashboard").addEventListener("click", function () {
            updateDashboardStats();
            showNotification("Dashboard actualizado", "success");
        });

        // Print ticket
        document.getElementById("printTicketBtn").addEventListener("click", function () {
            if (cart.length === 0) {
                showNotification("El carrito está vacío", "error");
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const productos = cart.map((item) => `${item.name} (${item.quantity})`).join(", ");

            const saleData = {
                total: total,
                items: cart.map(item => ({
                    cantidad: item.quantity,
                    descripcion: item.name,
                    precio: item.price
                })),
                metodoPago: 'Efectivo'
            };

            // Generar factura temporal para vista previa
            const invoiceContent = generateInvoiceContent({
                ...saleData,
                numero: 999999, // Número temporal
                cliente: 'Consumidor Final'
            });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Vista Previa Factura</title>
                        <style>
                            body { font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.2; }
                            .invoice-container { width: 80mm; padding: 15px; margin: 0 auto; }
                            .invoice-header { text-align: center; margin-bottom: 10px; }
                            .invoice-logo { font-size: 24px; margin-bottom: 5px; }
                            .invoice-company { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
                            .invoice-address { font-size: 10px; margin-bottom: 5px; }
                            .invoice-rnc { font-size: 10px; margin-bottom: 10px; }
                            .invoice-details { margin-bottom: 10px; border-top: 1px dashed #000; border-bottom: 1px dashed #000; padding: 5px 0; }
                            .invoice-items { width: 100%; margin-bottom: 10px; }
                            .invoice-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
                            .invoice-total { border-top: 1px dashed #000; padding-top: 5px; margin-bottom: 10px; font-weight: bold; }
                            .invoice-payment { margin-bottom: 10px; }
                            .invoice-footer { text-align: center; border-top: 1px dashed #000; padding-top: 10px; font-size: 10px; }
                            .invoice-number { font-weight: bold; margin-top: 5px; }
                        </style>
                    </head>
                    <body>
                        ${invoiceContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        });

        // Print invoice
        document.getElementById("printInvoiceBtn").addEventListener("click", function () {
            printInvoice();
        });

        // Download invoice as PDF
        document.getElementById("downloadInvoiceBtn").addEventListener("click", function () {
            downloadInvoiceAsPDF();
        });

        // Close invoice modal
        document.getElementById("closeInvoiceModal").addEventListener("click", function () {
            document.getElementById("invoiceModal").classList.remove("active");
        });

        // New Appointment Button
        document.getElementById("newAppointmentBtn").addEventListener("click", function() {
            document.querySelector('[data-tab="barberia-citas"]').click();
            showNotification("Formulario de nueva cita listo", "success");
        });

        // New Product Button
        document.getElementById("newProductBtn").addEventListener("click", function() {
            document.querySelector('[data-tab="billar-inventario"]').click();
            document.getElementById("addProductBtn").click();
        });

        // New Vehicle Button
        document.getElementById("newVehicleBtn").addEventListener("click", function() {
            document.querySelector('[data-tab="carwash-registro"]').click();
            showNotification("Formulario de nuevo vehículo listo", "success");
        });

        // Initialize the application
        initApp();
    </script>
</body>
</html>