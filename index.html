<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARK CLEANE - Sistema Inteligente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        /* ESTILOS CSS COMPLETOS (OPTIMIZADOS) */
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #64b5f6;
            --secondary: #ff6d00;
            --secondary-dark: #e65100;
            --accent: #00c853;
            --danger: #d32f2f;
            --warning: #ffa000;
            --info: #0288d1;
            --dark: #121212;
            --light: #f5f7fb;
            --gray: #5f6368;
            --gray-light: #e8eaed;
            --sidebar-width: 260px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #9e9e9e;
            --border-color: #333;
            --hover-color: #2a2a2a;
        }

        .light-mode {
            --bg-color: #f5f7fb;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #5f6368;
            --border-color: #e0e0e0;
            --hover-color: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ============================================= */
        /* ESTILOS CORREGIDOS PARA TOUCH Y DESLIZAMIENTO */
        /* ============================================= */
        
        .touch-scroll-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            padding: 10px 5px 20px 5px;
            max-height: 400px;
            overflow-y: auto;
            margin: 0;
            width: 100%;
        }

        .touch-service-card {
            width: 100%;
            min-height: 140px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px 15px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            user-select: none;
            -webkit-user-select: none;
            position: relative;
        }

        .touch-service-card:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .touch-service-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .touch-service-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--card-bg), rgba(0, 200, 83, 0.1));
            transform: translateY(-3px);
        }

        .touch-service-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .touch-service-card h4 {
            font-size: 0.95rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .touch-service-card .price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
            margin-top: 5px;
        }

        .touch-service-card .description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* ============================================= */
        /* ESTILOS PARA CIERRE DE CAJA (CORREGIDOS) */
        /* ============================================= */
        
        .cash-closing-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .cash-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .cash-method-card {
            background: var(--hover-color);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--primary);
        }

        .cash-method-card.efectivo {
            border-left-color: var(--accent);
        }

        .cash-method-card.tarjeta {
            border-left-color: var(--info);
        }

        .cash-method-card.transferencia {
            border-left-color: var(--secondary);
        }

        .cash-method-card h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cash-method-amount {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .cash-method-count {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .cash-total {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .cash-total h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .cash-total-amount {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .cash-discrepancy {
            background: rgba(211, 47, 47, 0.1);
            border: 1px solid var(--danger);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .cash-discrepancy h4 {
            color: var(--danger);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .discrepancy-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        /* ============================================= */
        /* ESTILOS EXISTENTES (MANTENIDOS) */
        /* ============================================= */

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: bold;
            font-size: 1.4rem;
            color: white;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 500;
        }

        .menu-item:hover,
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid white;
            color: white;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.active {
            max-height: 300px;
        }

        .submenu-item {
            padding: 12px 20px 12px 60px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.75);
            font-size: 0.9rem;
        }

        .submenu-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .header {
            height: var(--header-height);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: var(--hover-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Content Area */
        .content {
            padding: 25px;
        }

        .page-title {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Dashboard Styles */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .card-system {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card-system::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card-system:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .barberia {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .billar {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .carwash {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .config {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .card-system h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card-system p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .trend-up {
            color: var(--accent);
        }
        .trend-down {
            color: var(--danger);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 25px;
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        /* Table Styles */
        .table-container {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 18px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--hover-color);
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        tr:hover {
            background-color: var(--hover-color);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-success {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }

        .badge-warning {
            background: rgba(255, 160, 0, 0.15);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(2, 136, 209, 0.15);
            color: var(--info);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 0.9rem;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--accent);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Form Styles */
        .form-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* POS Styles */
        .pos-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 18px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .product-image {
            width: 80px;
            height: 80px;
            background: var(--hover-color);
            border-radius: 10px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .product-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .product-card p {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .cart {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            border: 1px solid var(--border-color);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .cart-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover-color);
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-color);
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 20px 0;
            text-align: right;
            color: var(--secondary);
        }

        /* Vehicle Cards */
        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .vehicle-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
            border: 1px solid var(--border-color);
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .vehicle-placa {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .vehicle-type {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .car {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .jeepeta {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .motor {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .camion {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .vehicle-details {
            margin-bottom: 20px;
        }

        .vehicle-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .vehicle-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .hamburger {
                display: block;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .pos-container {
                grid-template-columns: 1fr;
            }
            .user-info {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .touch-scroll-container {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .touch-service-card {
                min-height: 120px;
                padding: 15px 10px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 25px;
            background: var(--card-bg);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--accent);
            z-index: 10000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            max-width: 350px;
        }
        .notification.error {
            border-left-color: var(--danger);
        }
        .notification.warning {
            border-left-color: var(--warning);
        }
        .notification.info {
            border-left-color: var(--info);
        }
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notification i {
            font-size: 1.2rem;
        }
        .notification.success i {
            color: var(--accent);
        }
        .notification.error i {
            color: var(--danger);
        }
        .notification.warning i {
            color: var(--warning);
        }
        .notification.info i {
            color: var(--info);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* ============================================= */
        /* LOGIN MÁS SOFISTICADO (RESTAURADO) */
        /* ============================================= */

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--secondary) 100%);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            width: 300%;
            height: 300%;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            animation: bgMove 60s linear infinite;
            z-index: 0;
        }

        @keyframes bgMove {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .login-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }

        .login-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .logo-icon-large {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 3rem;
            box-shadow: var(--shadow-lg);
            animation: float 3s ease-in-out infinite;
            border: 5px solid white;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        .login-title {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-weight: 800;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .login-subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            line-height: 1.5;
        }

        .login-form-container {
            width: 100%;
        }

        .form-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
        }

        .form-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: var(--transition);
            position: relative;
        }

        .form-tab.active {
            color: var(--primary);
        }

        .form-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        .form-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .form-content.active {
            display: block;
        }

        .input-with-icon {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .form-control {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #eee;
            border-radius: 12px;
            background: white;
            color: #333;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .btn-custom {
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            width: 100%;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .user-limit-reached {
            background: rgba(211, 47, 47, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Factura 82mm */
        .invoice-container {
            background: white;
            color: black;
            width: 82mm !important;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 11px !important;
            line-height: 1.1;
            margin: 0 auto;
            min-height: 297mm;
            box-sizing: border-box;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .invoice-container, .invoice-container * {
                visibility: visible;
            }
            .invoice-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 82mm !important;
                margin: 0;
                padding: 10px;
                box-shadow: none;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="login-container" id="screen-login">
    <div class="login-wrapper">
        <div class="login-header">
            <div class="login-logo">
                <div class="logo-icon-large">SC</div>
                <h1 class="login-title">STARK CLEANE</h1>
                <p class="login-subtitle">Sistema Inteligente de Gestión Empresarial</p>
            </div>
        </div>
        
        <div class="login-form-container">
            <div class="form-tabs">
                <div class="form-tab active" id="loginTab">Iniciar Sesión</div>
                <div class="form-tab" id="registerTab">Registrarse</div>
            </div>
            
            <!-- Formulario de Login -->
            <div class="form-content active" id="loginForm">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user"></i> Usuario
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-user input-icon"></i>
                        <input
                            type="text"
                            id="login-username"
                            class="form-control"
                            placeholder="Ingrese su usuario"
                        />
                    </div>
                    <div class="error-message d-none" id="loginUserError">
                        <i class="fas fa-exclamation-circle"></i> El usuario es requerido
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-lock"></i> Contraseña
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input
                            type="password"
                            id="login-password"
                            class="form-control"
                            placeholder="Ingrese su contraseña"
                        />
                    </div>
                    <div class="error-message d-none" id="loginPassError">
                        <i class="fas fa-exclamation-circle"></i> La contraseña es requerida
                    </div>
                </div>
                
                <div class="form-group">
                    <button id="btn-login" class="btn btn-primary btn-custom">
                        <i class="fas fa-sign-in-alt"></i> Entrar al Sistema
                    </button>
                </div>
            </div>
            
            <!-- Formulario de Registro -->
            <div class="form-content" id="registerForm">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user-plus"></i> Nuevo Usuario
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-user input-icon"></i>
                        <input
                            type="text"
                            id="register-username"
                            class="form-control"
                            placeholder="Nombre de usuario"
                        />
                    </div>
                    <div class="error-message d-none" id="registerUserError">
                        <i class="fas fa-exclamation-circle"></i> El usuario es requerido
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-lock"></i> Contraseña (6+ caracteres)
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input
                            type="password"
                            id="register-password"
                            class="form-control"
                            placeholder="Contraseña segura"
                        />
                    </div>
                    <div class="error-message d-none" id="registerPassError">
                        <i class="fas fa-exclamation-circle"></i> Mínimo 6 caracteres
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-lock"></i> Confirmar Contraseña
                    </label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input
                            type="password"
                            id="register-confirm-password"
                            class="form-control"
                            placeholder="Repita la contraseña"
                        />
                    </div>
                    <div class="error-message d-none" id="registerConfirmError">
                        <i class="fas fa-exclamation-circle"></i> Las contraseñas no coinciden
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user-tag"></i> Rol de Usuario
                    </label>
                    <select id="register-role" class="form-control">
                        <option value="vendedor">Vendedor</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button id="btn-register" class="btn btn-success btn-custom">
                        <i class="fas fa-user-plus"></i> Crear Cuenta
                    </button>
                </div>
                
                <div id="user-limit-message" class="user-limit-reached d-none">
                    <i class="fas fa-exclamation-circle"></i>
                    Límite de usuarios alcanzado (máximo 5). Contacte al soporte para más información.
                </div>
            </div>
            
            <div class="login-footer">
                <p>¿Necesitas ayuda? 
                    <a href="mailto:Studiosstark@gmail.com?subject=Soporte STARK CLEANE&body=Hola, necesito ayuda con..." class="login-link">
                        <i class="fas fa-envelope"></i> Contactar Soporte
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

    <!-- Main System (Hidden until login) -->
    <div class="container" id="mainSystem" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">SC</div>
                    <span>STARK CLEANE</span>
                </div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                </div>
                <div class="menu-item" data-page="barberia">
                    <i class="fas fa-cut"></i>
                    <span>Barbería</span>
                </div>

                <div class="menu-item" data-page="billar">
                    <i class="fas fa-dice"></i>
                    <span>Billar</span>
                </div>

                <div class="menu-item" data-page="carwash">
                    <i class="fas fa-car"></i>
                    <span>Car Wash</span>
                </div>

                <div class="menu-item" data-submenu="configuracion">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu" id="configuracion-submenu">
                    <div class="submenu-item" data-page="config-usuarios">Usuarios</div>
                    <div class="submenu-item" data-page="config-servicios">Servicios</div>
                    <div class="submenu-item" data-page="config-productos">Productos</div>
                    <div class="submenu-item" data-page="config-empleados">Empleados</div>
                    <div class="submenu-item" data-page="config-impresora">Impresora</div>
                    <div class="submenu-item" data-page="config-tema">Tema</div>
                    <div class="submenu-item" data-page="config-jarvis">Configuración Jarvis</div>
                    <div class="submenu-item" data-page="config-cierre">Cierre de Caja</div>
                    <div class="submenu-item" data-page="config-contabilidad">Contabilidad</div>
                </div>

                <div class="menu-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesión</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <div class="hamburger">
                        <i class="fas fa-bars"></i>
                    </div>
                    <div class="header-title" id="headerTitle">Dashboard</div>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="currentUserName">Usuario</div>
                            <div class="user-role" id="currentUserRole">Rol</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">

             <!-- Dashboard -->
        <!-- Agrega este botón después del título del Dashboard -->
        <div class="page active" id="dashboard">
            <div class="page-title">
                <h1>Dashboard Inteligente</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" id="refreshDashboard">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <button class="btn btn-primary" onclick="generateDailyReport()">
                        <i class="fas fa-file-pdf"></i> Reporte
                    </button>
                    <!-- AÑADE ESTE BOTÓN NUEVO -->
                    <button class="btn btn-danger" onclick="resetAllData()" title="Borrar todos los datos">
                        <i class="fas fa-trash"></i> Resetear Datos
                    </button>
                </div>
            </div>

    <!-- Tarjetas principales -->
    <div class="dashboard-cards">
        <div class="card-system" data-page="barberia" onclick="showPage('barberia')">
            <div class="card-icon barberia">
                <i class="fas fa-cut"></i>
            </div>
            <h3>Barbería</h3>
            <p>Citas y servicios</p>
            <div class="card-value" id="appointmentsCount">0</div>
            <div class="card-trend">
                <span id="appointmentsTrend">No hay citas hoy</span>
            </div>
        </div>

        <div class="card-system" data-page="billar" onclick="showPage('billar')">
            <div class="card-icon billar">
                <i class="fas fa-dice"></i>
            </div>
            <h3>Billar</h3>
            <p>Ventas e inventario</p>
            <div class="card-value" id="salesTotal">RD$ 0</div>
            <div class="card-trend">
                <span id="salesTrend">No hay ventas hoy</span>
            </div>
        </div>

        <div class="card-system" data-page="carwash" onclick="showPage('carwash')">
            <div class="card-icon carwash">
                <i class="fas fa-car"></i>
            </div>
            <h3>Car Wash</h3>
            <p>Lavado de vehículos</p>
            <div class="card-value" id="vehiclesCount">0</div>
            <div class="card-trend">
                <span id="vehiclesTrend">No hay vehículos</span>
            </div>
        </div>

        <div class="card-system" data-page="config-cierre" onclick="showPage('config-cierre')">
            <div class="card-icon config">
                <i class="fas fa-cash-register"></i>
            </div>
            <h3>Cierre de Caja</h3>
            <p>Reportes diarios</p>
            <div class="card-value" id="cashCount">RD$ 0</div>
            <div class="card-trend">
                <span>Gestionar cierre</span>
            </div>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card">
            <h3><i class="fas fa-money-bill-wave"></i> Ingresos Hoy</h3>
            <div class="stat-value" id="dailyIncome">RD$ 0</div>
            <div class="stat-trend">
                <span id="incomeTrend">Actualizando...</span>
            </div>
        </div>

        <div class="stat-card">
            <h3><i class="fas fa-users"></i> Clientes Hoy</h3>
            <div class="stat-value" id="customersCount">0</div>
            <div class="stat-trend">
                <span id="customersTrend">Actualizando...</span>
            </div>
        </div>

        <div class="stat-card">
            <h3><i class="fas fa-box"></i> Productos Vendidos</h3>
            <div class="stat-value" id="productsSold">0</div>
            <div class="stat-trend">
                <span id="productsTrend">Actualizando...</span>
            </div>
        </div>
    </div>

    <div class="chart-container">
        <div class="chart-title"><i class="fas fa-chart-line"></i> Actividad Reciente</div>
        <canvas id="salesChart"></canvas>
    </div>
</div>

                <!-- Barbería - Página Completa -->
                <div class="page" id="barberia">
                    <div class="page-title">
                        <h1>Barbería</h1>
                        <button class="btn btn-primary" id="newAppointmentBtn">
                            <i class="fas fa-plus"></i> Nueva Cita
                        </button>
                    </div>

                    <!-- Tabs de Barbería -->
                    <div class="tabs">
                        <div class="tab active" data-tab="barberia-venta">Venta de Servicios</div>
                        <div class="tab" data-tab="barberia-citas">Registro de Citas</div>
                        <div class="tab" data-tab="barberia-clientes">Clientes Registrados</div>
                        <div class="tab" data-tab="barberia-historial">Historial de Ventas</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="barberia-venta">
                        <!-- Servicios de Barbería -->
                        <div class="page-title" style="margin-bottom: 10px;">
                            <h3>Servicios de Barbería</h3>
                        </div>
                        <div class="touch-scroll-container" id="barberia-touch-container">
                            <!-- Los servicios se cargarán dinámicamente -->
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group">
                                    <label for="cliente-barberia"><i class="fas fa-user"></i> Cliente (Opcional)</label>
                                    <input type="text" id="cliente-barberia" placeholder="Nombre del cliente">
                                </div>
                            </div>

                            <!-- Carrito de Venta Barbería -->
                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Venta</div>
                                    <div class="badge badge-info" id="cartCountBarberia">0 servicios</div>
                                </div>

                                <div class="cart-items" id="cartItemsBarberia">
                                    <!-- Los servicios del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotalBarberia">Total: RD$ 0</div>

                                <!-- Campo RNC Opcional -->
                                <div class="rnc-field">
                                    <label for="rnc-barberia">
                                        <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                                    </label>
                                    <input type="text" id="rnc-barberia" placeholder="Ej: 123-45678-9" maxlength="11">
                                </div>

                                <div class="form-group">
                                    <label for="metodo-pago-barberia">Método de Pago</label>
                                    <select id="metodo-pago-barberia">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <!-- Campo de aprobación para tarjeta -->
                                <div class="approval-field" id="approvalFieldBarberia" style="display: none;">
                                    <label for="aprobacion-barberia">
                                        <i class="fas fa-credit-card"></i> Aprobación de Tarjeta
                                    </label>
                                    <input type="text" id="aprobacion-barberia" placeholder="Ej: 123456">
                                </div>

                                <div class="form-group" id="cashPaymentSectionBarberia">
                                    <label for="efectivo-recibido-barberia">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido-barberia" placeholder="RD$" value="0">
                                    <div id="cambio-display-barberia" style="margin-top: 10px; font-weight: bold; color: var(--accent);">
                                        Cambio: RD$ 0
                                    </div>
                                </div>

                                <div class="payment-validation" id="paymentValidationBarberia">
                                    <i class="fas fa-exclamation-circle"></i> El efectivo recibido es menor al total.
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtnBarberia">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtnBarberia">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-citas">
                        <div class="form-container">
                            <h3>Registrar Nueva Cita</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cliente-cita"><i class="fas fa-user"></i> Nombre del Cliente</label>
                                    <input type="text" id="cliente-cita" placeholder="Nombre completo">
                                </div>
                                <div class="form-group">
                                    <label for="telefono-cita"><i class="fas fa-phone"></i> Teléfono</label>
                                    <input type="text" id="telefono-cita" placeholder="Teléfono">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="servicio-cita"><i class="fas fa-cut"></i> Servicio</label>
                                    <select id="servicio-cita">
                                        <!-- Se cargarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="barbero-cita"><i class="fas fa-user-tie"></i> Barbero</label>
                                    <select id="barbero-cita">
                                        <!-- Se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-cita"><i class="fas fa-calendar"></i> Fecha</label>
                                    <input type="date" id="fecha-cita">
                                </div>
                                <div class="form-group">
                                    <label for="hora-cita"><i class="fas fa-clock"></i> Hora</label>
                                    <input type="time" id="hora-cita">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notas-cita"><i class="fas fa-sticky-note"></i> Notas (Opcional)</label>
                                <textarea id="notas-cita" rows="3" placeholder="Notas adicionales"></textarea>
                            </div>
                            <button class="btn btn-primary" id="saveAppointmentBtn">
                                <i class="fas fa-save"></i> Guardar Cita
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-clientes">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Teléfono</th>
                                        <th>Última Visita</th>
                                        <th>Total Gastado</th>
                                        <th>Servicios</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="clientsTable">
                                    <!-- Los clientes se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-historial">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Servicios</th>
                                        <th>Total</th>
                                        <th>Método Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="barberiaHistoryTable">
                                    <!-- El historial se cargará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Billar - Página Completa -->
                <div class="page" id="billar">
                    <div class="page-title">
                        <h1>Billar - Sistema POS</h1>
                        <button class="btn btn-primary" id="newProductBtn">
                            <i class="fas fa-plus"></i> Nuevo Producto
                        </button>
                    </div>

                    <!-- Tabs de Billar -->
                    <div class="tabs">
                        <div class="tab active" data-tab="billar-inventario">Inventario</div>
                        <div class="tab" data-tab="billar-pos">Punto de Venta</div>
                        <div class="tab" data-tab="billar-ventas">Ventas del Día</div>
                        <div class="tab" data-tab="billar-reportes">Reportes</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="billar-inventario">
                        <div class="page-title">
                            <h2>Inventario de Productos</h2>
                            <div class="header-actions">
                                <button class="btn btn-primary" id="addProductBtn">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Producto</th>
                                        <th>Categoría</th>
                                        <th>P. Compra</th>
                                        <th>P. Venta</th>
                                        <th>Stock</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTable">
                                    <!-- Los productos se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-pos">
                        <div class="page-title">
                            <h2>Punto de Venta</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="clearCartBtn">
                                    <i class="fas fa-trash"></i> Limpiar Carrito
                                </button>
                            </div>
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group product-search">
                                    <label for="search-product"><i class="fas fa-search"></i> Buscar Producto</label>
                                    <input type="text" id="search-product" placeholder="Escriba nombre, código o categoría">
                                </div>

                                <h3>Productos Disponibles</h3>
                                <div class="touch-scroll-container" id="billar-products-touch">
                                    <!-- Los productos se cargarán dinámicamente -->
                                </div>
                            </div>

                            <!-- Carrito de Venta -->
                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Venta</div>
                                    <div class="badge badge-info" id="cartCount">0 productos</div>
                                </div>

                                <div class="cart-items" id="cartItems">
                                    <!-- Los productos del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotal">Total: RD$ 0</div>

                                <!-- Campo RNC Opcional -->
                                <div class="rnc-field">
                                    <label for="rnc">
                                        <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                                    </label>
                                    <input type="text" id="rnc" placeholder="Ej: 123-45678-9" maxlength="11">
                                </div>

                                <div class="form-group">
                                    <label for="metodo-pago">Método de Pago</label>
                                    <select id="metodo-pago">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <!-- Campo de aprobación para tarjeta -->
                                <div class="approval-field" id="approvalField" style="display: none;">
                                    <label for="aprobacion">
                                        <i class="fas fa-credit-card"></i> Aprobación de Tarjeta
                                    </label>
                                    <input type="text" id="aprobacion" placeholder="Ej: 123456">
                                </div>

                                <div class="form-group" id="cashPaymentSection">
                                    <label for="efectivo-recibido">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido" placeholder="RD$" value="0">
                                    <div id="cambio-display" style="margin-top: 10px; font-weight: bold; color: var(--accent);">
                                        Cambio: RD$ 0
                                    </div>
                                </div>

                                <div class="payment-validation" id="paymentValidation">
                                    <i class="fas fa-exclamation-circle"></i> El efectivo recibido es menor al total.
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtn">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtn">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-ventas">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Total</th>
                                        <th>Productos Vendidos</th>
                                        <th>Método de Pago</th>
                                        <th>RNC</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTable">
                                    <!-- Las ventas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-reportes">
                        <div class="page-title">
                            <h2>Reportes</h2>
                            <div class="header-actions">
                                <button class="btn btn-success" id="exportExcelBtn">
                                    <i class="fas fa-file-excel"></i> Exportar a Excel
                                </button>
                                <button class="btn btn-danger" id="exportPdfBtn">
                                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                                </button>
                            </div>
                        </div>

                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-inicio">Fecha Inicio</label>
                                    <input type="date" id="fecha-inicio">
                                </div>
                                <div class="form-group">
                                    <label for="fecha-fin">Fecha Fin</label>
                                    <input type="date" id="fecha-fin">
                                </div>
                            </div>

                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>

                        <div class="stats" style="margin-top: 20px">
                            <div class="stat-card">
                                <h3>Total Vendido</h3>
                                <div class="stat-value" id="totalSold">RD$ 0</div>
                                <div class="stat-trend">
                                    <span id="soldTrend">Sin ventas registradas</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Producto Más Vendido</h3>
                                <div class="stat-value" id="topProduct">N/A</div>
                                <div class="stat-trend">
                                    <span id="topProductCount">0 unidades</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Categoría Más Popular</h3>
                                <div class="stat-value" id="topCategory">N/A</div>
                                <div class="stat-trend">
                                    <span id="topCategoryPercent">0% de las ventas</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-title">Ventas por Categoría</div>
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Car Wash - Página Completa -->
                <div class="page" id="carwash">
                    <div class="page-title">
                        <h1>Car Wash</h1>
                        <button class="btn btn-success" id="newVehicleBtn">
                            <i class="fas fa-plus"></i> Registrar Vehículo
                        </button>
                    </div>

                    <!-- Tabs de Car Wash -->
                    <div class="tabs">
                        <div class="tab active" data-tab="carwash-registro">Registro de Vehículos</div>
                        <div class="tab" data-tab="carwash-proceso">Vehículos en Proceso</div>
                        <div class="tab" data-tab="carwash-entregados">Vehículos Entregados</div>
                        <div class="tab" data-tab="carwash-servicios">Servicios</div>
                        <div class="tab" data-tab="carwash-historial">Historial</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="carwash-registro">
                        <div class="form-container">
                            <h3>Registrar Nuevo Vehículo</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="placa-vehiculo"><i class="fas fa-car"></i> Placa del Vehículo</label>
                                    <input type="text" id="placa-vehiculo" placeholder="Ej: ABC123">
                                </div>
                                <div class="form-group">
                                    <label for="tipo-vehiculo"><i class="fas fa-car"></i> Tipo de Vehículo</label>
                                    <select id="tipo-vehiculo">
                                        <option value="">Seleccione tipo</option>
                                        <option value="carro">Carro</option>
                                        <option value="jeepeta">Jeepeta</option>
                                        <option value="motor">Motor</option>
                                        <option value="camion">Camión</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cliente-vehiculo"><i class="fas fa-user"></i> Cliente</label>
                                    <input type="text" id="cliente-vehiculo" placeholder="Nombre del cliente">
                                </div>
                                <div class="form-group">
                                    <label for="telefono-vehiculo"><i class="fas fa-phone"></i> Teléfono</label>
                                    <input type="text" id="telefono-vehiculo" placeholder="Teléfono">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="empleado-vehiculo"><i class="fas fa-user-tie"></i> Empleado Asignado</label>
                                <select id="empleado-vehiculo">
                                    <!-- Se cargarán dinámicamente -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="notas-vehiculo"><i class="fas fa-sticky-note"></i> Notas (Opcional)</label>
                                <textarea id="notas-vehiculo" rows="3" placeholder="Notas adicionales"></textarea>
                            </div>
                            <button class="btn btn-success" id="saveVehicleBtn">
                                <i class="fas fa-save"></i> Registrar Vehículo
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-proceso">
                        <div class="vehicles-grid" id="vehiclesGrid">
                            <!-- Los vehículos en proceso se cargarán dinámicamente -->
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-entregados">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Vehículo</th>
                                        <th>Tipo</th>
                                        <th>Cliente</th>
                                        <th>Servicios</th>
                                        <th>Total</th>
                                        <th>Hora Entrada</th>
                                        <th>Hora Salida</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="completedVehiclesTable">
                                    <!-- Los vehículos entregados se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-servicios">
                        <!-- Servicios de Car Wash -->
                        <div class="page-title" style="margin-bottom: 10px;">
                            <h3>Servicios de Car Wash</h3>
                        </div>
                        <div class="touch-scroll-container" id="carwash-touch-container">
                            <!-- Los servicios se cargarán dinámicamente -->
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group">
                                    <label for="vehiculo-servicio"><i class="fas fa-car"></i> Vehículo</label>
                                    <select id="vehiculo-servicio">
                                        <!-- Se cargarán dinámicamente -->
                                    </select>
                                </div>
                            </div>

                            <!-- Carrito de Venta Car Wash -->
                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Servicios</div>
                                    <div class="badge badge-info" id="cartCountCarwash">0 servicios</div>
                                </div>

                                <div class="cart-items" id="cartItemsCarwash">
                                    <!-- Los servicios del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotalCarwash">Total: RD$ 0</div>

                                <!-- Campo RNC Opcional -->
                                <div class="rnc-field">
                                    <label for="rnc-carwash">
                                        <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                                    </label>
                                    <input type="text" id="rnc-carwash" placeholder="Ej: 123-45678-9" maxlength="11">
                                </div>

                                <div class="form-group">
                                    <label for="metodo-pago-carwash">Método de Pago</label>
                                    <select id="metodo-pago-carwash">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <!-- Campo de aprobación para tarjeta -->
                                <div class="approval-field" id="approvalFieldCarwash" style="display: none;">
                                    <label for="aprobacion-carwash">
                                        <i class="fas fa-credit-card"></i> Aprobación de Tarjeta
                                    </label>
                                    <input type="text" id="aprobacion-carwash" placeholder="Ej: 123456">
                                </div>

                                <div class="form-group" id="cashPaymentSectionCarwash">
                                    <label for="efectivo-recibido-carwash">Efectivo Recibido</label>
                                    <input type="number" id="efectivo-recibido-carwash" placeholder="RD$" value="0">
                                    <div id="cambio-display-carwash" style="margin-top: 10px; font-weight: bold; color: var(--accent);">
                                        Cambio: RD$ 0
                                    </div>
                                </div>

                                <div class="payment-validation" id="paymentValidationCarwash">
                                    <i class="fas fa-exclamation-circle"></i> El efectivo recibido es menor al total.
                                </div>

                                <button class="btn btn-primary btn-block" id="printTicketBtnCarwash">
                                    <i class="fas fa-print"></i> Imprimir Ticket
                                </button>
                                <button class="btn btn-success btn-block" id="confirmSaleBtnCarwash">
                                    <i class="fas fa-check"></i> Confirmar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-historial">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-carwash">Fecha</label>
                                    <input type="date" id="fecha-carwash">
                                </div>
                                <div class="form-group">
                                    <label for="tipo-filtro">Tipo de Vehículo</label>
                                    <select id="tipo-filtro">
                                        <option value="">Todos los tipos</option>
                                        <option value="carro">Carro</option>
                                        <option value="jeepeta">Jeepeta</option>
                                        <option value="motor">Motor</option>
                                        <option value="camion">Camión</option>
                                    </select>
                                </div>
                            </div>

                            <button class="btn btn-primary" id="searchCarwashBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 20px">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Vehículo</th>
                                        <th>Tipo</th>
                                        <th>Servicios</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="carwashHistoryTable">
                                    <!-- El historial se cargará dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ============================================= -->
                <!-- PÁGINAS DE CONFIGURACIÓN -->
                <!-- ============================================= -->

                <!-- Configuración - Cierre de Caja -->
                <div class="page" id="config-cierre">
                    <div class="page-title">
                        <h1>Cierre de Caja</h1>
                        <button class="btn btn-success" id="processCashClosingBtn">
                            <i class="fas fa-calculator"></i> Procesar Cierre
                        </button>
                    </div>

                    <div class="cash-closing-container">
                        <h3><i class="fas fa-cash-register"></i> Resumen del Día</h3>
                        <div class="cash-summary" id="cashSummary">
                            <!-- Se cargará dinámicamente -->
                        </div>

                        <div class="cash-total">
                            <h3>TOTAL ESPERADO EN CAJA</h3>
                            <div class="cash-total-amount" id="expectedTotal">RD$ 0</div>
                            <p>Suma total de todas las ventas del día</p>
                        </div>

                        <div class="form-container">
                            <h3><i class="fas fa-clipboard-check"></i> Cierre de Caja</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="efectivo-contado">Efectivo Contado</label>
                                    <input type="number" id="efectivo-contado" placeholder="RD$">
                                </div>
                                <div class="form-group">
                                    <label for="fecha-cierre">Fecha de Cierre</label>
                                    <input type="datetime-local" id="fecha-cierre">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="responsable">Responsable</label>
                                    <input type="text" id="responsable" placeholder="Nombre del responsable">
                                </div>
                                <div class="form-group">
                                    <label for="turno">Turno</label>
                                    <select id="turno">
                                        <option value="matutino">Matutino</option>
                                        <option value="vespertino">Vespertino</option>
                                        <option value="nocturno">Nocturno</option>
                                        <option value="completo">Completo</option>
                                    </select>
                                </div>
                            </div>

                            <div class="cash-discrepancy" id="discrepancySection" style="display: none;">
                                <h4><i class="fas fa-exclamation-triangle"></i> DISCREPANCIA DETECTADA</h4>
                                <p>Existe una diferencia entre el efectivo contado y el esperado.</p>
                                <div id="discrepancyAmount" style="font-size: 1.5rem; font-weight: bold; margin: 10px 0;"></div>
                                
                                <div class="discrepancy-form">
                                    <div class="form-group">
                                        <label for="discrepancy-reason">Motivo de la Diferencia</label>
                                        <select id="discrepancy-reason">
                                            <option value="">Seleccione motivo</option>
                                            <option value="error_cambio">Error en cambio</option>
                                            <option value="venta_no_registrada">Venta no registrada</option>
                                            <option value="gasto_operativo">Gasto operativo</option>
                                            <option value="otro">Otro</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="discrepancy-notes">Notas</label>
                                        <textarea id="discrepancy-notes" rows="2" placeholder="Explicación de la diferencia"></textarea>
                                    </div>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-block" id="calculateDiscrepancyBtn">
                                <i class="fas fa-calculator"></i> Calcular Diferencia
                            </button>
                            <button class="btn btn-success btn-block" id="finalizeClosingBtn">
                                <i class="fas fa-check-circle"></i> Finalizar Cierre
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 30px;">
                            <h3>Historial de Cierres</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Responsable</th>
                                        <th>Efectivo</th>
                                        <th>Tarjeta</th>
                                        <th>Transferencia</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="closingHistoryTable">
                                    <!-- Historial de cierres -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Contabilidad -->
                <div class="page" id="config-contabilidad">
                    <div class="page-title">
                        <h1>Integración Contable</h1>
                        <button class="btn btn-success" id="syncAccountingBtn">
                            <i class="fas fa-sync-alt"></i> Sincronizar
                        </button>
                    </div>

                    <div class="accounting-container">
                        <h3><i class="fas fa-chart-line"></i> Resumen Contable</h3>
                        
                        <div class="accounting-summary">
                            <div class="accounting-card">
                                <h4><i class="fas fa-money-bill-wave"></i> Ingresos del Mes</h4>
                                <div class="accounting-value" id="monthlyIncome">RD$ 0</div>
                                <div class="accounting-trend" id="incomeTrendText">Cargando...</div>
                            </div>
                            
                            <div class="accounting-card">
                                <h4><i class="fas fa-shopping-cart"></i> Gastos Operativos</h4>
                                <div class="accounting-value" id="monthlyExpenses">RD$ 0</div>
                                <div class="accounting-trend" id="expensesTrendText">Cargando...</div>
                            </div>
                            
                            <div class="accounting-card">
                                <h4><i class="fas fa-piggy-bank"></i> Utilidad Neta</h4>
                                <div class="accounting-value" id="netProfit">RD$ 0</div>
                                <div class="accounting-trend" id="profitTrendText">Cargando...</div>
                            </div>
                            
                            <div class="accounting-card">
                                <h4><i class="fas fa-receipt"></i> Facturas Emitidas</h4>
                                <div class="accounting-value" id="invoicesCount">0</div>
                                <div class="accounting-trend" id="invoicesTrendText">Este mes</div>
                            </div>
                        </div>

                        <div class="form-container">
                            <h3><i class="fas fa-cogs"></i> Configuración de Integración</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="accounting-system">Sistema Contable</label>
                                    <select id="accounting-system">
                                        <option value="cashflow">Cashflow</option>
                                        <option value="quickbooks">QuickBooks</option>
                                        <option value="xero">Xero</option>
                                        <option value="sap">SAP</option>
                                        <option value="other">Otro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="sync-frequency">Frecuencia de Sincronización</label>
                                    <select id="sync-frequency">
                                        <option value="realtime">Tiempo Real</option>
                                        <option value="hourly">Cada Hora</option>
                                        <option value="daily" selected>Diariamente</option>
                                        <option value="weekly">Semanalmente</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" id="saveAccountingConfigBtn">
                                <i class="fas fa-save"></i> Guardar Configuración
                            </button>
                            <button class="btn btn-success" id="testConnectionBtn" style="margin-left: 10px;">
                                <i class="fas fa-plug"></i> Probar Conexión
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 30px;">
                            <h3><i class="fas fa-history"></i> Historial de Sincronización</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Tipo</th>
                                        <th>Registros</th>
                                        <th>Estado</th>
                                        <th>Detalles</th>
                                    </tr>
                                </thead>
                                <tbody id="syncHistoryTable">
                                    <!-- Historial de sincronización -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Usuarios -->
                <div class="page" id="config-usuarios">
                    <div class="page-title">
                        <h1>Configuración de Usuarios</h1>
                        <button class="btn btn-primary" id="addUserBtn">
                            <i class="fas fa-plus"></i> Agregar Usuario
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Usuario</th>
                                    <th>Rol</th>
                                    <th>Fecha Registro</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Los usuarios se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Configuración - Servicios -->
                <div class="page" id="config-servicios">
                    <div class="page-title">
                        <h1>Configuración de Servicios</h1>
                    </div>

                    <div class="config-tabs">
                        <div class="config-tab active" data-config-tab="barberia-servicios">Servicios de Barbería</div>
                        <div class="config-tab" data-config-tab="carwash-servicios">Servicios de Car Wash</div>
                    </div>

                    <!-- Servicios de Barbería -->
                    <div class="tab-content active" id="barberia-servicios">
                        <div class="config-section">
                            <h3>Agregar Nuevo Servicio de Barbería</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="servicio-barberia-nombre">Nombre del Servicio</label>
                                    <input type="text" id="servicio-barberia-nombre" placeholder="Ej: Corte de Cabello">
                                </div>
                                <div class="form-group">
                                    <label for="servicio-barberia-precio">Precio (RD$)</label>
                                    <input type="number" id="servicio-barberia-precio" placeholder="250">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="servicio-barberia-descripcion">Descripción (Opcional)</label>
                                <textarea id="servicio-barberia-descripcion" rows="2" placeholder="Descripción del servicio"></textarea>
                            </div>
                            <button class="btn btn-primary" id="agregar-servicio-barberia">
                                <i class="fas fa-plus"></i> Agregar Servicio
                            </button>
                        </div>

                        <div class="config-section">
                            <h3>Servicios Configurados</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Servicio</th>
                                            <th>Precio</th>
                                            <th>Descripción</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="barberia-servicios-lista">
                                        <!-- Los servicios se cargarán dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Servicios de Car Wash -->
                    <div class="tab-content" id="carwash-servicios">
                        <div class="config-section">
                            <h3>Agregar Nuevo Servicio de Car Wash</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="servicio-carwash-nombre">Nombre del Servicio</label>
                                    <input type="text" id="servicio-carwash-nombre" placeholder="Ej: Lavado Completo">
                                </div>
                                <div class="form-group">
                                    <label for="servicio-carwash-precio">Precio (RD$)</label>
                                    <input type="number" id="servicio-carwash-precio" placeholder="450">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="servicio-carwash-descripcion">Descripción (Opcional)</label>
                                <textarea id="servicio-carwash-descripcion" rows="2" placeholder="Descripción del servicio"></textarea>
                            </div>
                            <button class="btn btn-primary" id="agregar-servicio-carwash">
                                <i class="fas fa-plus"></i> Agregar Servicio
                            </button>
                        </div>

                        <div class="config-section">
                            <h3>Servicios Configurados</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Servicio</th>
                                            <th>Precio</th>
                                            <th>Descripción</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="carwash-servicios-lista">
                                        <!-- Los servicios se cargarán dinámicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Productos -->
                <div class="page" id="config-productos">
                    <div class="page-title">
                        <h1>Configuración de Productos</h1>
                    </div>

                    <div class="config-section">
                        <h3>Agregar Nuevo Producto</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="producto-nombre">Nombre del Producto</label>
                                <input type="text" id="producto-nombre" placeholder="Ej: Refresco Cola">
                            </div>
                            <div class="form-group">
                                <label for="producto-codigo">Código (Opcional)</label>
                                <input type="text" id="producto-codigo" placeholder="Código interno">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="producto-precio-compra">Precio de Compra (RD$)</label>
                                <input type="number" id="producto-precio-compra" placeholder="80">
                            </div>
                            <div class="form-group">
                                <label for="producto-precio-venta">Precio de Venta (RD$)</label>
                                <input type="number" id="producto-precio-venta" placeholder="100">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="producto-stock">Stock Inicial</label>
                                <input type="number" id="producto-stock" placeholder="50">
                            </div>
                            <div class="form-group">
                                <label for="producto-categoria">Categoría</label>
                                <select id="producto-categoria">
                                    <option value="bebidas">Bebidas</option>
                                    <option value="snacks">Snacks</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="agregar-producto">
                            <i class="fas fa-plus"></i> Agregar Producto
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Productos Configurados</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Código</th>
                                        <th>P. Compra</th>
                                        <th>P. Venta</th>
                                        <th>Stock</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productos-lista">
                                    <!-- Los productos se cargarán dinámicamente -->
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Empleados -->
                <div class="page" id="config-empleados">
                    <div class="page-title">
                        <h1>Configuración de Empleados</h1>
                        <button class="btn btn-primary" id="addEmployeeBtn">
                            <i class="fas fa-plus"></i> Agregar Empleado
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Agregar Nuevo Empleado</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empleado-nombre">Nombre Completo</label>
                                <input type="text" id="empleado-nombre" placeholder="Nombre del empleado">
                            </div>
                            <div class="form-group">
                                <label for="empleado-cedula">Cédula</label>
                                    <input type="text" id="empleado-cedula" placeholder="Cédula">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empleado-telefono">Teléfono</label>
                                <input type="text" id="empleado-telefono" placeholder="Teléfono">
                            </div>
                            <div class="form-group">
                                <label for="empleado-cargo">Cargo</label>
                                <select id="empleado-cargo">
                                    <option value="barbero">Barbero</option>
                                    <option value="lavador">Lavador</option>
                                    <option value="vendedor">Vendedor</option>
                                    <option value="administrador">Administrador</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="empleado-sueldo">Sueldo (RD$)</label>
                            <input type="number" id="empleado-sueldo" placeholder="Sueldo mensual">
                        </div>
                        <button class="btn btn-primary" id="saveEmployeeBtn">
                            <i class="fas fa-save"></i> Guardar Empleado
                        </button>
                    </div>

                    <div class="config-section">
                        <h3>Empleados Registrados</h3>
                        <div class="employees-grid" id="employeesGrid">
                            <!-- Los empleados se cargarán dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Configuración - Impresora -->
                <div class="page" id="config-impresora">
                    <div class="page-title">
                        <h1>Configuración de Impresora</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="printer-type">Tipo de Impresora</label>
                            <select id="printer-type">
                                <option value="ticket">Impresora de Tickets (82mm)</option>
                                <option value="fiscal">Impresora Fiscal</option>
                                <option value="normal">Impresora Normal</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="printer-name">Nombre de la Impresora</label>
                            <input type="text" id="printer-name" placeholder="Nombre de la impresora en el sistema">
                        </div>

                        <div class="form-group">
                            <label for="paper-width">Ancho del Papel (mm)</label>
                            <input type="number" id="paper-width" value="82" min="40" max="120">
                        </div>

                        <div class="form-group">
                            <label for="company-name">Nombre de la Empresa</label>
                            <input type="text" id="company-name" placeholder="STARK CLEANE">
                        </div>

                        <div class="form-group">
                            <label for="company-address">Dirección</label>
                            <input type="text" id="company-address" placeholder="Dirección de la empresa">
                        </div>

                        <div class="form-group">
                            <label for="company-phone">Teléfono</label>
                            <input type="text" id="company-phone" placeholder="Teléfono de la empresa">
                        </div>

                        <div class="form-group">
                            <label for="company-rnc">RNC (Opcional)</label>
                            <input type="text" id="company-rnc" placeholder="RNC de la empresa">
                        </div>

                        <button class="btn btn-primary" id="savePrinterConfigBtn">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                        <button class="btn btn-success" id="testPrinterBtn" style="margin-left: 10px;">
                            <i class="fas fa-print"></i> Probar Impresión
                        </button>
                    </div>
                </div>

                <!-- Configuración - Tema -->
                <div class="page" id="config-tema">
                    <div class="page-title">
                        <h1>Configuración - Tema</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="select-tema">Seleccionar Tema</label>
                            <select id="select-tema">
                                <option value="dark">Oscuro</option>
                                <option value="light">Claro</option>
                            </select>
                        </div>

                        <button class="btn btn-primary" id="saveThemeBtn">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                </div>

                <!-- Configuración Jarvis -->
                <div class="page" id="config-jarvis">
                    <div class="page-title">
                        <h1>Configuración Jarvis</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="jarvis-voice-key">Tecla de Activación por Voz</label>
                            <input type="text" id="jarvis-voice-key" value="F2" readonly>
                            <small>Presiona F2 para activar el comando de voz</small>
                        </div>

                        <div class="form-group">
                            <label for="jarvis-ai-mode">Modo de IA</label>
                            <select id="jarvis-ai-mode">
                                <option value="avanzado">Avanzado (Recomendado)</option>
                                <option value="basico">Básico</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="jarvis-voice-responses" checked>
                                Respuestas por Voz
                            </label>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="jarvis-auto-actions" checked>
                                Acciones Automáticas
                            </label>
                        </div>
                        
                        <button class="btn btn-primary" id="saveJarvisConfigBtn">
                            <i class="fas fa-save"></i> Guardar Configuración Jarvis
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar producto -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Agregar Nuevo Producto</div>
                <button class="modal-close" id="closeProductModal">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigo-barra-producto">Código de Barras</label>
                        <input type="text" id="codigo-barra-producto" placeholder="Ingrese código de barras">
                    </div>
                    <div class="form-group">
                        <label for="nombre-producto">Nombre del Producto</label>
                        <input type="text" id="nombre-producto" placeholder="Ingrese nombre del producto">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="categoria-producto">Categoría</label>
                        <select id="categoria-producto">
                            <option value="">Seleccione categoría</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="licores">Licores</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fecha-ingreso">Fecha de Ingreso</label>
                        <input type="date" id="fecha-ingreso">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="precio-compra">Precio de Compra</label>
                        <input type="number" id="precio-compra" placeholder="RD$">
                    </div>
                    <div class="form-group">
                        <label for="precio-venta">Precio de Venta</label>
                        <input type="number" id="precio-venta" placeholder="RD$">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cantidad-stock">Cantidad en Stock</label>
                        <input type="number" id="cantidad-stock" placeholder="Cantidad">
                    </div>
                    <div class="form-group">
                        <label for="alerta-stock">Alerta de Stock</label>
                        <input type="number" id="alerta-stock" placeholder="Mínimo">
                    </div>
                </div>

                <button class="btn btn-primary" id="saveProductBtn">
                    <i class="fas fa-save"></i> Guardar Producto
                </button>
            </div>
        </div>
    </div>

    <!-- Factura Modal -->
    <div class="modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Factura</div>
                <button class="modal-close" id="closeInvoiceModal">&times;</button>
            </div>
            <div class="invoice-container" id="invoiceContent">
                <!-- La factura se generará aquí -->
            </div>
            <div class="action-buttons" style="margin-top: 20px; justify-content: center;">
                <button class="btn btn-primary" id="printInvoiceBtn">
                    <i class="fas fa-print"></i> Imprimir
                </button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE NOTIFICACIONES (SIN SONIDOS)
        // =============================================

        function showNotification(message, type = "success") {
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === "success" ? "check-circle" : type === "error" ? "exclamation-circle" : type === "warning" ? "exclamation-triangle" : "info-circle"}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // =============================================
        // SISTEMA DE USUARIOS Y LOGIN
        // =============================================

        const UserSystem = {
            init: function() {
                if (!localStorage.getItem('stark_users')) {
                    const defaultUsers = [
                        {
                            id: 1,
                            username: 'admin',
                            password: 'admin123',
                            role: 'admin',
                            created: new Date().toISOString(),
                            avatar: 'A'
                        },
                        {
                            id: 2,
                            username: 'vendedor',
                            password: 'vendedor123',
                            role: 'vendedor',
                            created: new Date().toISOString(),
                            avatar: 'V'
                        }
                    ];
                    localStorage.setItem('stark_users', JSON.stringify(defaultUsers));
                }
            },

            getUsers: function() {
                return JSON.parse(localStorage.getItem('stark_users')) || [];
            },

            saveUsers: function(users) {
                localStorage.setItem('stark_users', JSON.stringify(users));
            },

            authenticate: function(username, password) {
                const users = this.getUsers();
                return users.find(user => 
                    user.username === username && user.password === password
                );
            },

            register: function(username, password, role) {
                const users = this.getUsers();
                
                if (users.length >= 5) {
                    return { success: false, message: 'Límite de usuarios alcanzado (máximo 5)' };
                }
                
                if (users.some(user => user.username === username)) {
                    return { success: false, message: 'El usuario ya existe' };
                }
                
                if (password.length < 6) {
                    return { success: false, message: 'La contraseña debe tener al menos 6 caracteres' };
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    role: role,
                    created: new Date().toISOString(),
                    avatar: username.charAt(0).toUpperCase()
                };
                
                users.push(newUser);
                this.saveUsers(users);
                
                return { success: true, message: 'Usuario registrado exitosamente' };
            },

            deleteUser: function(id) {
                const users = this.getUsers();
                const filtered = users.filter(user => user.id !== id);
                this.saveUsers(filtered);
                return filtered;
            }
        };

        UserSystem.init();

        // =============================================
        // SISTEMA DE LOGIN
        // =============================================

       document.addEventListener('DOMContentLoaded', function() {
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        loginTab.addEventListener('click', function() {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
            clearErrors();
        });

        registerTab.addEventListener('click', function() {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
            clearErrors();
        });

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.add('d-none');
            });
            document.querySelectorAll('.form-control').forEach(el => {
                el.classList.remove('error');
            });
        }

        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            const inputEl = errorEl.previousElementSibling?.querySelector('.form-control');
            
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.remove('d-none');
            }
            
            if (inputEl) {
                inputEl.classList.add('error');
            }
        }

        function validateLogin() {
            let isValid = true;
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;

            clearErrors();

            if (!username) {
                showError('loginUserError', 'El usuario es requerido');
                isValid = false;
            }

            if (!password) {
                showError('loginPassError', 'La contraseña es requerida');
                isValid = false;
            }

            return isValid;
        }

        function validateRegister() {
            let isValid = true;
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            clearErrors();

            if (!username) {
                showError('registerUserError', 'El usuario es requerido');
                isValid = false;
            }

            if (!password) {
                showError('registerPassError', 'La contraseña es requerida');
                isValid = false;
            } else if (password.length < 6) {
                showError('registerPassError', 'Mínimo 6 caracteres');
                isValid = false;
            }

            if (!confirmPassword) {
                showError('registerConfirmError', 'Confirme la contraseña');
                isValid = false;
            } else if (password !== confirmPassword) {
                showError('registerConfirmError', 'Las contraseñas no coinciden');
                isValid = false;
            }

            return isValid;
        }

        document.getElementById('btn-login').addEventListener('click', function() {
            if (!validateLogin()) return;
            
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            const user = UserSystem.authenticate(username, password);
            
            if (user) {
                loginSuccessful(user);
            } else {
                showNotification('Usuario o contraseña incorrectos', 'error');
                document.getElementById('login-password').classList.add('error');
            }
        });

        document.getElementById('btn-register').addEventListener('click', function() {
            if (!validateRegister()) return;
            
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const role = document.getElementById('register-role').value;
            
            const result = UserSystem.register(username, password, role);
            
            if (result.success) {
                showNotification(result.message, 'success');
                
                loginTab.click();
                document.getElementById('login-username').value = username;
                document.getElementById('login-password').value = password;
                
                updateUserLimitMessage();
            } else {
                showNotification(result.message, 'error');
            }
        });

        document.getElementById('login-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('btn-login').click();
            }
        });

        document.getElementById('register-confirm-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('btn-register').click();
            }
        });

        function updateUserLimitMessage() {
            const users = UserSystem.getUsers();
            const messageEl = document.getElementById('user-limit-message');
            
            if (users.length >= 5) {
                messageEl.classList.remove('d-none');
            } else {
                messageEl.classList.add('d-none');
            }
        }

        updateUserLimitMessage();
    });

        function loginSuccessful(user) {
            document.getElementById('screen-login').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'flex';
            
            document.getElementById('currentUserName').textContent = user.username;
            document.getElementById('currentUserRole').textContent = user.role === 'admin' ? 'Administrador' : 'Vendedor';
            document.getElementById('userAvatar').textContent = user.avatar;
            
            localStorage.setItem('current_user', JSON.stringify(user));
            
            initApp();
            
            showNotification(`¡Bienvenido ${user.username}!`, 'success');
        }

        // =============================================
        // SISTEMA DE BASE DE DATOS LOCAL
        // =============================================

        const DB = {
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch (error) {
                    console.error('Error reading from localStorage:', error);
                    return [];
                }
            },

            set: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Error writing to localStorage:', error);
                    return false;
                }
            },

            add: (key, item) => {
                const data = DB.get(key);
                item.id = Date.now();
                data.push(item);
                return DB.set(key, data) ? item.id : null;
            },

            update: (key, id, updates) => {
                const data = DB.get(key);
                const index = data.findIndex(item => item.id === id);
                if (index !== -1) {
                    data[index] = { ...data[index], ...updates };
                    return DB.set(key, data);
                }
                return false;
            },

            delete: (key, id) => {
                const data = DB.get(key);
                const filtered = data.filter(item => item.id !== id);
                return DB.set(key, filtered);
            },

            initializeData: function() {
                if (!localStorage.getItem('barberia_services')) {
                    const defaultBarberiaServices = [
                        { id: 1, nombre: 'Corte de Cabello', precio: 250, descripcion: 'Corte básico' },
                        { id: 2, nombre: 'Afeitado', precio: 150, descripcion: 'Afeitado con navaja' },
                        { id: 3, nombre: 'Corte y Barba', precio: 350, descripcion: 'Corte completo' },
                        { id: 4, nombre: 'Corte Niño', precio: 200, descripcion: 'Corte para niños' },
                        { id: 5, nombre: 'Tinte', precio: 400, descripcion: 'Aplicación de tinte' }
                    ];
                    DB.set('barberia_services', defaultBarberiaServices);
                }

                if (!localStorage.getItem('carwash_services')) {
                    const defaultCarwashServices = [
                        { id: 1, nombre: 'Lavado Básico', precio: 250, descripcion: 'Lavado exterior' },
                        { id: 2, nombre: 'Lavado Completo', precio: 450, descripcion: 'Lavado interior y exterior' },
                        { id: 3, nombre: 'Lavado Motor', precio: 300, descripcion: 'Limpieza de motor' },
                        { id: 4, nombre: 'Encerado', precio: 500, descripcion: 'Encerado completo' },
                        { id: 5, nombre: 'Aspirado', precio: 200, descripcion: 'Aspirado interior' }
                    ];
                    DB.set('carwash_services', defaultCarwashServices);
                }

                if (!localStorage.getItem('productos')) {
                    const defaultProducts = [
                        { id: 1, nombre: 'Refresco Cola', codigo: 'COL001', precio_compra: 80, precio_venta: 100, stock: 50, categoria: 'bebidas' },
                        { id: 2, nombre: 'Agua Mineral', codigo: 'AGU001', precio_compra: 40, precio_venta: 50, stock: 30, categoria: 'bebidas' },
                        { id: 3, nombre: 'Papas Fritas', codigo: 'PAP001', precio_compra: 60, precio_venta: 80, stock: 25, categoria: 'snacks' },
                        { id: 4, nombre: 'Chocolate', codigo: 'CHO001', precio_compra: 70, precio_venta: 90, stock: 20, categoria: 'snacks' },
                        { id: 5, nombre: 'Cerveza', codigo: 'CER001', precio_compra: 120, precio_venta: 150, stock: 40, categoria: 'bebidas' }
                    ];
                    DB.set('productos', defaultProducts);
                }

                if (!localStorage.getItem('empleados')) {
                    const defaultEmployees = [
                        { id: 1, nombre: 'Juan Pérez', cedula: '001-1234567-8', telefono: '809-123-4567', cargo: 'barbero', sueldo: 25000 },
                        { id: 2, nombre: 'María García', cedula: '002-2345678-9', telefono: '809-234-5678', cargo: 'lavador', sueldo: 20000 },
                        { id: 3, nombre: 'Carlos Rodríguez', cedula: '003-3456789-0', telefono: '809-345-6789', cargo: 'vendedor', sueldo: 18000 }
                    ];
                    DB.set('empleados', defaultEmployees);
                }

                if (!localStorage.getItem('billar_sales')) DB.set('billar_sales', []);
                if (!localStorage.getItem('barberia_sales')) DB.set('barberia_sales', []);
                if (!localStorage.getItem('carwash_sales')) DB.set('carwash_sales', []);
                if (!localStorage.getItem('barberia_appointments')) DB.set('barberia_appointments', []);
                if (!localStorage.getItem('carwash_vehicles')) DB.set('carwash_vehicles', []);
                if (!localStorage.getItem('cash_closings')) DB.set('cash_closings', []);
                if (!localStorage.getItem('carwash_history')) DB.set('carwash_history', []);
            }
        };

        // =============================================
        // SISTEMA DE CARRITO DE COMPRAS
        // =============================================

        let cart = [];
        let cartBarberia = [];
        let cartCarwash = [];

        function addToCart(id, name, price) {
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: parseFloat(price),
                    quantity: 1
                });
            }
            
            updateCartUI();
            showNotification(`${name} agregado al carrito`, 'success');
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartTotal = document.getElementById('cartTotal');
            
            if (!cartItems) return;
            
            cartItems.innerHTML = '';
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" onclick="decreaseQuantity(${item.id})">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantity(${item.id})">+</button>
                    </div>
                    <div>RD$ ${itemTotal.toFixed(2)}</div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            if (cartCount) cartCount.textContent = `${cart.length} productos`;
            if (cartTotal) cartTotal.textContent = `Total: RD$ ${total.toFixed(2)}`;
            
            updateChange();
        }

        function increaseQuantity(id) {
            const item = cart.find(item => item.id === id);
            if (item) {
                const products = DB.get('productos');
                const product = products.find(p => p.id === id);
                
                if (product && item.quantity >= product.stock) {
                    showNotification(`No hay suficiente stock. Máximo: ${product.stock}`, 'error');
                    return;
                }
                
                item.quantity++;
                updateCartUI();
            }
        }

        function decreaseQuantity(id) {
            const itemIndex = cart.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
                if (cart[itemIndex].quantity > 1) {
                    cart[itemIndex].quantity--;
                } else {
                    cart.splice(itemIndex, 1);
                }
                updateCartUI();
            }
        }

        function getCartTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateChange() {
            const efectivoRecibido = parseFloat(document.getElementById('efectivo-recibido').value) || 0;
            const total = getCartTotal();
            const cambio = efectivoRecibido - total;
            const cambioDisplay = document.getElementById('cambio-display');
            const paymentValidation = document.getElementById('paymentValidation');
            
            if (cambioDisplay) {
                if (cambio >= 0) {
                    cambioDisplay.textContent = `Cambio: RD$ ${cambio.toFixed(2)}`;
                    cambioDisplay.style.color = 'var(--accent)';
                } else {
                    cambioDisplay.textContent = `Falta: RD$ ${Math.abs(cambio).toFixed(2)}`;
                    cambioDisplay.style.color = 'var(--danger)';
                }
            }
            
            if (paymentValidation) {
                if (efectivoRecibido > 0 && efectivoRecibido < total) {
                    paymentValidation.classList.add('show');
                } else {
                    paymentValidation.classList.remove('show');
                }
            }
        }

        // Funciones para barbería
        function addToCartBarberia(id, name, price, description) {
            const existingItem = cartBarberia.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartBarberia.push({
                    id: id,
                    name: name,
                    price: parseFloat(price),
                    description: description,
                    quantity: 1
                });
            }
            
            updateCartUIBarberia();
            showNotification(`${name} agregado al carrito`, 'success');
        }

        function updateCartUIBarberia() {
            const cartItems = document.getElementById('cartItemsBarberia');
            const cartCount = document.getElementById('cartCountBarberia');
            const cartTotal = document.getElementById('cartTotalBarberia');
            
            if (!cartItems) return;
            
            cartItems.innerHTML = '';
            let total = 0;
            
            cartBarberia.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                        ${item.description ? `<small style="color: var(--text-secondary);">${item.description}</small>` : ''}
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" onclick="decreaseQuantityBarberia(${item.id})">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantityBarberia(${item.id})">+</button>
                    </div>
                    <div>RD$ ${itemTotal.toFixed(2)}</div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            if (cartCount) cartCount.textContent = `${cartBarberia.length} servicios`;
            if (cartTotal) cartTotal.textContent = `Total: RD$ ${total.toFixed(2)}`;
            
            updateChangeBarberia();
        }

        function increaseQuantityBarberia(id) {
            const item = cartBarberia.find(item => item.id === id);
            if (item) {
                item.quantity++;
                updateCartUIBarberia();
            }
        }

        function decreaseQuantityBarberia(id) {
            const itemIndex = cartBarberia.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
                if (cartBarberia[itemIndex].quantity > 1) {
                    cartBarberia[itemIndex].quantity--;
                } else {
                    cartBarberia.splice(itemIndex, 1);
                }
                updateCartUIBarberia();
            }
        }

        function getCartTotalBarberia() {
            return cartBarberia.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateChangeBarberia() {
            const efectivoRecibido = parseFloat(document.getElementById('efectivo-recibido-barberia').value) || 0;
            const total = getCartTotalBarberia();
            const cambio = efectivoRecibido - total;
            const cambioDisplay = document.getElementById('cambio-display-barberia');
            const paymentValidation = document.getElementById('paymentValidationBarberia');
            
            if (cambioDisplay) {
                if (cambio >= 0) {
                    cambioDisplay.textContent = `Cambio: RD$ ${cambio.toFixed(2)}`;
                    cambioDisplay.style.color = 'var(--accent)';
                } else {
                    cambioDisplay.textContent = `Falta: RD$ ${Math.abs(cambio).toFixed(2)}`;
                    cambioDisplay.style.color = 'var(--danger)';
                }
            }
            
            if (paymentValidation) {
                if (efectivoRecibido > 0 && efectivoRecibido < total) {
                    paymentValidation.classList.add('show');
                } else {
                    paymentValidation.classList.remove('show');
                }
            }
        }

        // Funciones para carwash
        function addToCartCarwash(id, name, price, description) {
            const existingItem = cartCarwash.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartCarwash.push({
                    id: id,
                    name: name,
                    price: parseFloat(price),
                    description: description,
                    quantity: 1
                });
            }
            
            updateCartUICarwash();
            showNotification(`${name} agregado al carrito`, 'success');
        }

        function updateCartUICarwash() {
            const cartItems = document.getElementById('cartItemsCarwash');
            const cartCount = document.getElementById('cartCountCarwash');
            const cartTotal = document.getElementById('cartTotalCarwash');
            
            if (!cartItems) return;
            
            cartItems.innerHTML = '';
            let total = 0;
            
            cartCarwash.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                        ${item.description ? `<small style="color: var(--text-secondary);">${item.description}</small>` : ''}
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" onclick="decreaseQuantityCarwash(${item.id})">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantityCarwash(${item.id})">+</button>
                    </div>
                    <div>RD$ ${itemTotal.toFixed(2)}</div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            if (cartCount) cartCount.textContent = `${cartCarwash.length} servicios`;
            if (cartTotal) cartTotal.textContent = `Total: RD$ ${total.toFixed(2)}`;
            
            updateChangeCarwash();
        }

        function increaseQuantityCarwash(id) {
            const item = cartCarwash.find(item => item.id === id);
            if (item) {
                item.quantity++;
                updateCartUICarwash();
            }
        }

        function decreaseQuantityCarwash(id) {
            const itemIndex = cartCarwash.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
                if (cartCarwash[itemIndex].quantity > 1) {
                    cartCarwash[itemIndex].quantity--;
                } else {
                    cartCarwash.splice(itemIndex, 1);
                }
                updateCartUICarwash();
            }
        }

        function getCartTotalCarwash() {
            return cartCarwash.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateChangeCarwash() {
            const efectivoRecibido = parseFloat(document.getElementById('efectivo-recibido-carwash').value) || 0;
            const total = getCartTotalCarwash();
            const cambio = efectivoRecibido - total;
            const cambioDisplay = document.getElementById('cambio-display-carwash');
            const paymentValidation = document.getElementById('paymentValidationCarwash');
            
            if (cambioDisplay) {
                if (cambio >= 0) {
                    cambioDisplay.textContent = `Cambio: RD$ ${cambio.toFixed(2)}`;
                    cambioDisplay.style.color = 'var(--accent)';
                } else {
                    cambioDisplay.textContent = `Falta: RD$ ${Math.abs(cambio).toFixed(2)}`;
                    cambioDisplay.style.color = 'var(--danger)';
                }
            }
            
            if (paymentValidation) {
                if (efectivoRecibido > 0 && efectivoRecibido < total) {
                    paymentValidation.classList.add('show');
                } else {
                    paymentValidation.classList.remove('show');
                }
            }
        }

        // =============================================
        // FUNCIONES DE FACTURACIÓN
        // =============================================

        const InvoiceSystem = {
            generateInvoice: function(type, cartData, total, extras = {}) {
                const invoiceNumber = `FAC-${Date.now().toString().slice(-6)}`;
                const currentDate = new Date();
                const formattedDate = currentDate.toLocaleDateString('es-DO');
                const formattedTime = currentDate.toLocaleTimeString('es-DO', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const rnc = extras.rnc || '';
                const formattedRNC = rnc ? this.formatRNC(rnc) : 'CONSUMIDOR FINAL';
                const metodoPago = extras.metodo_pago || 'Efectivo';
                const cliente = extras.cliente || 'Cliente no registrado';
                
                const companyName = localStorage.getItem('company_name') || 'STARK CLEANE';
                const companyAddress = localStorage.getItem('company_address') || 'Dirección no configurada';
                const companyPhone = localStorage.getItem('company_phone') || 'Teléfono no configurado';
                const companyRNC = localStorage.getItem('company_rnc') || '';
                
                let invoiceHTML = `
                    <div class="invoice-header">
                        <div class="invoice-logo">${companyName}</div>
                        <div class="invoice-company">SISTEMA INTEGRADO DE GESTIÓN</div>
                        <div class="invoice-address">${companyAddress}</div>
                        <div class="invoice-phone">Tel: ${companyPhone}</div>
                        ${companyRNC ? `<div class="invoice-rnc">RNC: ${companyRNC}</div>` : ''}
                    </div>
                    
                    <div class="invoice-details">
                        <div><strong>FACTURA:</strong> ${invoiceNumber}</div>
                        <div><strong>FECHA:</strong> ${formattedDate} ${formattedTime}</div>
                        <div><strong>CLIENTE:</strong> ${cliente}</div>
                        <div><strong>RNC:</strong> ${formattedRNC}</div>
                        <div><strong>MÉTODO PAGO:</strong> ${metodoPago}</div>
                    </div>
                    
                    <div class="invoice-items">
                `;
                
                cartData.forEach((item, index) => {
                    const itemName = item.name || item.nombre || 'Producto';
                    const itemPrice = item.price || item.precio || 0;
                    const quantity = item.quantity || 1;
                    const itemTotal = itemPrice * quantity;
                    
                    invoiceHTML += `
                        <div class="invoice-item">
                            <div class="invoice-item-name">${index + 1}. ${itemName}</div>
                            <div class="invoice-item-price">RD$ ${itemTotal.toFixed(2)}</div>
                        </div>
                        <div style="font-size: 9px; color: #666; margin-left: 10px;">
                            ${quantity} x RD$ ${itemPrice.toFixed(2)}
                        </div>
                    `;
                });
                
                invoiceHTML += `
                    </div>
                    
                    <div class="invoice-total">
                        <div style="display: flex; justify-content: space-between;">
                            <span>TOTAL:</span>
                            <span>RD$ ${total.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                
                invoiceHTML += `
                    <div class="invoice-footer">
                        <div>¡GRACIAS POR SU COMPRA!</div>
                        <div>Vuelva pronto</div>
                        <div class="invoice-number">${invoiceNumber}</div>
                        <div>Impreso: ${formattedDate} ${formattedTime}</div>
                    </div>
                `;
                
                return {
                    html: invoiceHTML,
                    number: invoiceNumber,
                    date: currentDate.toISOString(),
                    total: total,
                    rnc: rnc,
                    metodo_pago: metodoPago
                };
            },

            formatRNC: function(rnc) {
                if (!rnc) return 'CONSUMIDOR FINAL';
                const cleaned = rnc.replace(/\D/g, '');
                if (cleaned.length === 9) {
                    return `${cleaned.substring(0, 3)}-${cleaned.substring(3, 8)}-${cleaned.substring(8)}`;
                }
                return cleaned;
            },

            printInvoice: function(invoiceHTML) {
                const invoiceContent = document.getElementById('invoiceContent');
                if (invoiceContent) {
                    invoiceContent.innerHTML = invoiceHTML;
                    
                    const modal = document.getElementById('invoiceModal');
                    modal.classList.add('active');
                    
                    document.getElementById('printInvoiceBtn').onclick = function() {
                        const printWindow = window.open('', '_blank');
                        printWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>Factura STARK CLEANE</title>
                                <style>
                                    body { 
                                        font-family: 'Courier New', monospace; 
                                        font-size: 11px;
                                        margin: 0;
                                        padding: 10px;
                                        width: 82mm;
                                    }
                                    .invoice-header { text-align: center; margin-bottom: 8px; }
                                    .invoice-logo { font-size: 18px; font-weight: bold; }
                                    .invoice-items { width: 100%; margin: 10px 0; }
                                    .invoice-item { display: flex; justify-content: space-between; margin-bottom: 4px; }
                                    .invoice-total { border-top: 2px solid #000; padding-top: 8px; margin-top: 10px; font-weight: bold; }
                                    @media print { 
                                        body { width: 82mm !important; margin: 0 !important; padding: 10px !important; }
                                        .no-print { display: none !important; }
                                    }
                                </style>
                            </head>
                            <body>
                                ${invoiceHTML}
                            </body>
                            </html>
                        `);
                        printWindow.document.close();
                        printWindow.focus();
                        setTimeout(() => {
                            printWindow.print();
                            printWindow.close();
                        }, 250);
                    };
                }
            }
        };

        // =============================================
        // FUNCIÓN DE CONFIRMACIÓN DE VENTA
        // =============================================

        function confirmSale(type) {
            let cartData, total, cliente, rnc, metodoPago, aprobacion, efectivoRecibido;
            
            switch(type) {
                case 'billar':
                    if (cart.length === 0) {
                        showNotification('El carrito está vacío', 'error');
                        return;
                    }
                    cartData = cart;
                    total = getCartTotal();
                    metodoPago = document.getElementById('metodo-pago').value;
                    rnc = document.getElementById('rnc').value.trim();
                    aprobacion = document.getElementById('aprobacion').value.trim();
                    efectivoRecibido = parseFloat(document.getElementById('efectivo-recibido').value) || 0;
                    cliente = 'Cliente no registrado';
                    break;
                    
                case 'barberia':
                    if (cartBarberia.length === 0) {
                        showNotification('El carrito está vacío', 'error');
                        return;
                    }
                    cartData = cartBarberia;
                    total = getCartTotalBarberia();
                    cliente = document.getElementById('cliente-barberia').value.trim() || 'Cliente no registrado';
                    metodoPago = document.getElementById('metodo-pago-barberia').value;
                    rnc = document.getElementById('rnc-barberia').value.trim();
                    aprobacion = document.getElementById('aprobacion-barberia').value.trim();
                    efectivoRecibido = parseFloat(document.getElementById('efectivo-recibido-barberia').value) || 0;
                    break;
                    
                case 'carwash':
                    if (cartCarwash.length === 0) {
                        showNotification('El carrito está vacío', 'error');
                        return;
                    }
                    cartData = cartCarwash;
                    total = getCartTotalCarwash();
                    const vehiculoSelect = document.getElementById('vehiculo-servicio');
                    const vehiculoId = vehiculoSelect ? vehiculoSelect.value : null;
                    const vehicles = DB.get('carwash_vehicles');
                    const vehicle = vehicles.find(v => v.id == vehiculoId);
                    cliente = vehicle ? vehicle.cliente : 'Cliente no registrado';
                    metodoPago = document.getElementById('metodo-pago-carwash').value;
                    rnc = document.getElementById('rnc-carwash').value.trim();
                    aprobacion = document.getElementById('aprobacion-carwash').value.trim();
                    efectivoRecibido = parseFloat(document.getElementById('efectivo-recibido-carwash').value) || 0;
                    break;
                    
                default:
                    showNotification('Tipo de venta no válido', 'error');
                    return;
            }
            
            if (metodoPago === 'efectivo' && efectivoRecibido < total) {
                showNotification('El efectivo recibido es insuficiente', 'error');
                return;
            }
            
            if (metodoPago === 'tarjeta' && !aprobacion) {
                showNotification('Ingrese el número de aprobación', 'error');
                return;
            }
            
            const invoice = InvoiceSystem.generateInvoice(type, cartData, total, {
                cliente: cliente,
                rnc: rnc,
                metodo_pago: metodoPago,
                aprobacion: aprobacion,
                vehiculo: type === 'carwash' ? (vehicle ? vehicle.placa : '') : ''
            });
            
            showNotification(`Venta confirmada #${invoice.number}`, 'success');
            
            if (type === 'billar') {
                cartData.forEach(item => {
                    const products = DB.get('productos');
                    const productIndex = products.findIndex(p => p.id === item.id);
                    if (productIndex !== -1) {
                        products[productIndex].stock -= item.quantity;
                        DB.set('productos', products);
                    }
                });
            }
            
            if (type === 'carwash' && vehicle) {
                const vehicleIndex = vehicles.findIndex(v => v.id == vehicle.id);
                if (vehicleIndex !== -1) {
                    vehicles[vehicleIndex].servicios = cartData.map(item => ({
                        nombre: item.name,
                        precio: item.price,
                        cantidad: item.quantity
                    }));
                    vehicles[vehicleIndex].total = total;
                    DB.set('carwash_vehicles', vehicles);
                }
            }
            
            InvoiceSystem.printInvoice(invoice.html);
            
            const saleRecord = {
                id: Date.now(),
                numero: invoice.number,
                tipo: type,
                items: cartData,
                total: total,
                rnc: invoice.rnc,
                metodo_pago: invoice.metodo_pago,
                cliente: cliente,
                fecha: invoice.date,
                usuario: document.getElementById('currentUserName').textContent
            };
            
            if (type === 'billar') {
                DB.add('billar_sales', saleRecord);
                cart = [];
                updateCartUI();
            } else if (type === 'barberia') {
                DB.add('barberia_sales', saleRecord);
                cartBarberia = [];
                updateCartUIBarberia();
            } else if (type === 'carwash') {
                DB.add('carwash_sales', saleRecord);
                cartCarwash = [];
                updateCartUICarwash();
                
                if (extras.vehiculo) {
                    const historyRecord = {
                        ...saleRecord,
                        vehiculo: extras.vehiculo,
                        tipo_vehiculo: 'carro'
                    };
                    DB.add('carwash_history', historyRecord);
                }
            }
            
            return invoice.number;
        }

        // =============================================
        // FUNCIONES DE CARGA DE DATOS
        // =============================================

        function loadBarberiaServices() {
            const services = DB.get('barberia_services');
            const container = document.getElementById('barberia-touch-container');
            
            if (!container) return;
            
            container.innerHTML = '';
            
            if (services.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary); width: 100%;">
                        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No hay servicios configurados</p>
                    </div>
                `;
                return;
            }
            
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'touch-service-card';
                card.dataset.id = service.id;
                card.innerHTML = `
                    <i class="fas fa-cut"></i>
                    <h4>${service.nombre}</h4>
                    <div class="price">RD$ ${service.precio}</div>
                    ${service.descripcion ? `<div class="description">${service.descripcion}</div>` : ''}
                `;
                
                card.addEventListener('click', function() {
                    addToCartBarberia(service.id, service.nombre, service.precio, service.descripcion || '');
                });
                
                container.appendChild(card);
            });
            
            const select = document.getElementById('servicio-cita');
            if (select) {
                select.innerHTML = '<option value="">Seleccione un servicio</option>';
                services.forEach(service => {
                    const option = document.createElement('option');
                    option.value = service.id;
                    option.textContent = `${service.nombre} - RD$ ${service.precio}`;
                    select.appendChild(option);
                });
            }
        }

        function loadCarwashServices() {
            const services = DB.get('carwash_services');
            const container = document.getElementById('carwash-touch-container');
            
            if (!container) return;
            
            container.innerHTML = '';
            
            if (services.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary); width: 100%;">
                        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No hay servicios configurados</p>
                    </div>
                `;
                return;
            }
            
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'touch-service-card';
                card.dataset.id = service.id;
                card.innerHTML = `
                    <i class="fas fa-car"></i>
                    <h4>${service.nombre}</h4>
                    <div class="price">RD$ ${service.precio}</div>
                    ${service.descripcion ? `<div class="description">${service.descripcion}</div>` : ''}
                `;
                
                card.addEventListener('click', function() {
                    addToCartCarwash(service.id, service.nombre, service.precio, service.descripcion || '');
                });
                
                container.appendChild(card);
            });
        }

        function loadBillarProducts() {
            const products = DB.get('productos');
            const container = document.getElementById('billar-products-touch');
            
            if (!container) return;
            
            container.innerHTML = '';
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-secondary); width: 100%;">
                        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No hay productos configurados</p>
                    </div>
                `;
                return;
            }
            
            products.forEach(product => {
                if (product.stock <= 0) return;
                
                const card = document.createElement('div');
                card.className = 'touch-service-card';
                card.dataset.id = product.id;
                card.innerHTML = `
                    <i class="fas fa-box"></i>
                    <h4>${product.nombre}</h4>
                    <div class="price">RD$ ${product.precio_venta}</div>
                    <small style="color: var(${product.stock <= 5 ? '--danger' : '--text-secondary'});">Stock: ${product.stock}</small>
                `;
                
                card.addEventListener('click', function() {
                    addToCart(product.id, product.nombre, product.precio_venta || product.precio);
                });
                
                container.appendChild(card);
            });
            
            const table = document.getElementById('productsTable');
            if (table) {
                table.innerHTML = '';
                
                products.forEach(product => {
                    const row = document.createElement('tr');
                    const estado = product.stock <= 0 ? 'danger' : (product.stock <= 5 ? 'warning' : 'success');
                    const estadoText = product.stock <= 0 ? 'Sin stock' : (product.stock <= 5 ? 'Bajo stock' : 'Disponible');
                    
                    row.innerHTML = `
                        <td>${product.codigo || '-'}</td>
                        <td>${product.nombre}</td>
                        <td>${product.categoria}</td>
                        <td>RD$ ${product.precio_compra}</td>
                        <td>RD$ ${product.precio_venta}</td>
                        <td>${product.stock}</td>
                        <td><span class="badge badge-${estado}">${estadoText}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
        }

        function loadConfigServices() {
         const carwashServices = DB.get('carwash_services');
            const carwashTable = document.getElementById('carwash-servicios-lista');
            console.log("loadConfigServices ejecutándose...");  // Agrega esta línea

            if (carwashTable) {
                carwashTable.innerHTML = '';
                carwashServices.forEach((service, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${service.nombre}</td>
                        <td>RD$ ${service.precio}</td>
                        <td>${service.descripcion || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editCarwashService(${service.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCarwashService(${service.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    carwashTable.appendChild(row);
                });
            }


            
            const barberiaServices = DB.get('barberia_services');
            const barberiaTable = document.getElementById('barberia-servicios-lista');
            
            if (barberiaTable) {
                barberiaTable.innerHTML = '';
                barberiaServices.forEach((service, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${service.nombre}</td>
                        <td>RD$ ${service.precio}</td>
                        <td>${service.descripcion || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editBarberiaService(${service.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBarberiaService(${service.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    barberiaTable.appendChild(row);
                });
            }
            
           
        }

        function loadConfigProducts() {
            const products = DB.get('productos');
            const table = document.getElementById('productos-lista');
            
            if (table) {
                table.innerHTML = '';
                products.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.nombre}</td>
                        <td>${product.codigo || '-'}</td>
                        <td>RD$ ${product.precio_compra}</td>
                        <td>RD$ ${product.precio_venta}</td>
                        <td>${product.stock}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
        }

        function loadConfigUsers() {
            const users = UserSystem.getUsers();
            const table = document.getElementById('usersTable');
            
            if (table) {
                table.innerHTML = '';
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.username}</td>
                        <td>${user.role === 'admin' ? 'Administrador' : 'Vendedor'}</td>
                        <td>${new Date(user.created).toLocaleDateString()}</td>
                        <td><span class="badge badge-success">Activo</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})" ${user.username === 'admin' ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
        }

        function loadConfigEmployees() {
            const employees = DB.get('empleados');
            const grid = document.getElementById('employeesGrid');
            
            if (grid) {
                grid.innerHTML = '';
                employees.forEach(employee => {
                    const card = document.createElement('div');
                    card.className = 'employee-card';
                    card.innerHTML = `
                        <div class="employee-header">
                            <div class="employee-avatar">${employee.nombre.charAt(0)}</div>
                            <div>
                                <h4>${employee.nombre}</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">${employee.cargo}</p>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <p><i class="fas fa-id-card"></i> ${employee.cedula}</p>
                            <p><i class="fas fa-phone"></i> ${employee.telefono}</p>
                            <p><i class="fas fa-money-bill"></i> RD$ ${employee.sueldo}</p>
                        </div>
                        <div class="action-buttons" style="margin-top: 15px;">
                            <button class="btn btn-sm btn-outline" onclick="editEmployee(${employee.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
            
            const selects = ['empleado-vehiculo', 'barbero-cita'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Seleccione empleado</option>';
                    employees.forEach(employee => {
                        const option = document.createElement('option');
                        option.value = employee.id;
                        option.textContent = `${employee.nombre} (${employee.cargo})`;
                        select.appendChild(option);
                    });
                }
            });
        }

        // =============================================
        // FUNCIONES PARA CAR WASH
        // =============================================

        function saveVehicle() {
            const placa = document.getElementById('placa-vehiculo').value.trim();
            const tipo = document.getElementById('tipo-vehiculo').value;
            const cliente = document.getElementById('cliente-vehiculo').value.trim();
            const telefono = document.getElementById('telefono-vehiculo').value.trim();
            const empleadoId = document.getElementById('empleado-vehiculo').value;
            const notas = document.getElementById('notas-vehiculo').value.trim();
            
            if (!placa || !tipo || !cliente) {
                showNotification('Placa, tipo y cliente son requeridos', 'error');
                return;
            }
            
            const empleados = DB.get('empleados');
            const empleado = empleados.find(e => e.id == empleadoId);
            const empleadoNombre = empleado ? empleado.nombre : 'No asignado';
            
            const newVehicle = {
                id: Date.now(),
                placa: placa,
                tipo: tipo,
                cliente: cliente,
                telefono: telefono,
                empleado: empleadoNombre,
                empleado_id: empleadoId || null,
                notas: notas,
                entrada: new Date().toISOString(),
                estado: 'en_proceso',
                servicios: []
            };
            
            DB.add('carwash_vehicles', newVehicle);
            showNotification('Vehículo registrado exitosamente', 'success');
            
            document.getElementById('placa-vehiculo').value = '';
            document.getElementById('tipo-vehiculo').value = '';
            document.getElementById('cliente-vehiculo').value = '';
            document.getElementById('telefono-vehiculo').value = '';
            document.getElementById('empleado-vehiculo').value = '';
            document.getElementById('notas-vehiculo').value = '';
            
            if (document.getElementById('carwash').classList.contains('active')) {
                loadCarwashVehicles();
            }
        }

        function loadCarwashVehicles() {
            const vehicles = DB.get('carwash_vehicles');
            const grid = document.getElementById('vehiclesGrid');
            const select = document.getElementById('vehiculo-servicio');
            
            if (grid) {
                grid.innerHTML = '';
                
                const vehiclesInProcess = vehicles.filter(v => v.estado === 'en_proceso');
                
                if (vehiclesInProcess.length === 0) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 40px; width: 100%; color: var(--text-secondary);">
                            <i class="fas fa-car" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No hay vehículos en proceso</h3>
                            <p>Registra un nuevo vehículo para comenzar</p>
                        </div>
                    `;
                } else {
                    vehiclesInProcess.forEach(vehicle => {
                        const card = document.createElement('div');
                        card.className = 'vehicle-card';
                        card.innerHTML = `
                            <div class="vehicle-header">
                                <div class="vehicle-placa">${vehicle.placa}</div>
                                <span class="vehicle-type ${vehicle.tipo}">${vehicle.tipo}</span>
                            </div>
                            <div class="vehicle-details">
                                <div class="vehicle-detail">
                                    <span>Cliente:</span>
                                    <span>${vehicle.cliente}</span>
                                </div>
                                <div class="vehicle-detail">
                                    <span>Teléfono:</span>
                                    <span>${vehicle.telefono || 'No especificado'}</span>
                                </div>
                                <div class="vehicle-detail">
                                    <span>Empleado:</span>
                                    <span>${vehicle.empleado}</span>
                                </div>
                                <div class="vehicle-time">
                                    <i class="fas fa-clock"></i>
                                    <span>Entrada: ${new Date(vehicle.entrada).toLocaleTimeString()}</span>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="addServicesToVehicle(${vehicle.id})">
                                    <i class="fas fa-plus"></i> Agregar Servicios
                                </button>
                                <button class="btn btn-success" onclick="completeVehicle(${vehicle.id})">
                                    <i class="fas fa-check"></i> Completar
                                </button>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                }
            }
            
            if (select) {
                select.innerHTML = '<option value="">Seleccione vehículo</option>';
                const activeVehicles = vehicles.filter(v => v.estado === 'en_proceso');
                activeVehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.id;
                    option.textContent = `${vehicle.placa} - ${vehicle.cliente}`;
                    select.appendChild(option);
                });
            }
        }

        function addServicesToVehicle(vehicleId) {
            showPage('carwash');
            document.querySelector('[data-tab="carwash-servicios"]').click();
            
            const select = document.getElementById('vehiculo-servicio');
            if (select) {
                select.value = vehicleId;
            }
            
            showNotification('Selecciona los servicios para este vehículo', 'info');
        }

        function completeVehicle(vehicleId) {
            const vehicles = DB.get('carwash_vehicles');
            const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
            
            if (vehicleIndex !== -1) {
                vehicles[vehicleIndex].estado = 'completado';
                vehicles[vehicleIndex].salida = new Date().toISOString();
                DB.set('carwash_vehicles', vehicles);
                showNotification('Vehículo marcado como completado', 'success');
                loadCarwashVehicles();
                loadCompletedVehicles();
            }
        }

        function loadCompletedVehicles() {
            const vehicles = DB.get('carwash_vehicles');
            const table = document.getElementById('completedVehiclesTable');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            const completedVehicles = vehicles.filter(v => v.estado === 'completado');
            
            if (completedVehicles.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-car" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No hay vehículos entregados</p>
                    </td>
                `;
                table.appendChild(row);
                return;
            }
            
            completedVehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                const servicios = vehicle.servicios || [];
                const total = vehicle.total || servicios.reduce((sum, s) => sum + (s.precio * (s.cantidad || 1)), 0);
                
                row.innerHTML = `
                    <td>${vehicle.placa}</td>
                    <td><span class="vehicle-type ${vehicle.tipo}">${vehicle.tipo}</span></td>
                    <td>${vehicle.cliente}</td>
                    <td>
                        ${servicios.map(s => `${s.nombre} (${s.cantidad || 1})`).join(', ')}
                    </td>
                    <td>RD$ ${total.toFixed(2)}</td>
                    <td>${new Date(vehicle.entrada).toLocaleTimeString()}</td>
                    <td>${vehicle.salida ? new Date(vehicle.salida).toLocaleTimeString() : 'N/A'}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewVehicleDetails(${vehicle.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteVehicle(${vehicle.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function loadCarwashHistory() {
            const history = DB.get('carwash_history');
            const table = document.getElementById('carwashHistoryTable');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            if (history.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No hay historial de carwash</p>
                    </td>
                `;
                table.appendChild(row);
                return;
            }
            
            history.forEach(record => {
                const row = document.createElement('tr');
                const date = new Date(record.fecha);
                
                row.innerHTML = `
                    <td>${date.toLocaleDateString()}</td>
                    <td>${record.vehiculo || 'N/A'}</td>
                    <td>${record.tipo_vehiculo || 'N/A'}</td>
                    <td>
                        ${record.items ? record.items.map(item => `${item.name} (${item.quantity})`).join(', ') : 'N/A'}
                    </td>
                    <td>RD$ ${record.total.toFixed(2)}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewCarwashRecord(${record.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCarwashRecord(${record.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function viewVehicleDetails(vehicleId) {
            const vehicles = DB.get('carwash_vehicles');
            const vehicle = vehicles.find(v => v.id === vehicleId);
            
            if (!vehicle) return;
            
            let details = `Vehículo: ${vehicle.placa}\n`;
            details += `Cliente: ${vehicle.cliente}\n`;
            details += `Tipo: ${vehicle.tipo}\n`;
            details += `Empleado: ${vehicle.empleado}\n`;
            details += `Entrada: ${new Date(vehicle.entrada).toLocaleString()}\n`;
            details += `Salida: ${vehicle.salida ? new Date(vehicle.salida).toLocaleString() : 'N/A'}\n`;
            details += `Servicios:\n`;
            
            const servicios = vehicle.servicios || [];
            servicios.forEach(s => {
                details += `  - ${s.nombre}: RD$ ${s.precio} x ${s.cantidad || 1}\n`;
            });
            
            details += `Total: RD$ ${vehicle.total || servicios.reduce((sum, s) => sum + (s.precio * (s.cantidad || 1)), 0)}`;
            
            alert(details);
        }

        function deleteVehicle(vehicleId) {
            if (confirm('¿Estás seguro de eliminar este vehículo?')) {
                const deleted = DB.delete('carwash_vehicles', vehicleId);
                if (deleted) {
                    showNotification('Vehículo eliminado', 'success');
                    loadCarwashVehicles();
                    loadCompletedVehicles();
                }
            }
        }

        function viewCarwashRecord(recordId) {
            const history = DB.get('carwash_history');
            const record = history.find(r => r.id === recordId);
            
            if (!record) return;
            
            let details = `Factura: ${record.numero}\n`;
            details += `Fecha: ${new Date(record.fecha).toLocaleString()}\n`;
            details += `Vehículo: ${record.vehiculo || 'N/A'}\n`;
            details += `Cliente: ${record.cliente}\n`;
            details += `Método de pago: ${record.metodo_pago}\n`;
            details += `RNC: ${record.rnc || 'Consumidor Final'}\n`;
            details += `Items:\n`;
            
            record.items.forEach(item => {
                details += `  - ${item.name}: RD$ ${item.price} x ${item.quantity}\n`;
            });
            
            details += `Total: RD$ ${record.total}`;
            
            alert(details);
        }

        function deleteCarwashRecord(recordId) {
            if (confirm('¿Estás seguro de eliminar este registro?')) {
                const deleted = DB.delete('carwash_history', recordId);
                if (deleted) {
                    showNotification('Registro eliminado', 'success');
                    loadCarwashHistory();
                }
            }
        }

        // =============================================
        // FUNCIONES DE EDICIÓN Y ELIMINACIÓN
        // =============================================

        function editBarberiaService(id) {
            const services = DB.get('barberia_services');
            const service = services.find(s => s.id === id);
            
            if (!service) return;
            
            document.getElementById('servicio-barberia-nombre').value = service.nombre;
            document.getElementById('servicio-barberia-precio').value = service.precio;
            document.getElementById('servicio-barberia-descripcion').value = service.descripcion || '';
            
            const btn = document.getElementById('agregar-servicio-barberia');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Servicio';
            
            btn.onclick = function() {
                const nombre = document.getElementById('servicio-barberia-nombre').value.trim();
                const precio = parseFloat(document.getElementById('servicio-barberia-precio').value);
                const descripcion = document.getElementById('servicio-barberia-descripcion').value.trim();
                
                if (!nombre || !precio) {
                    showNotification('Nombre y precio son requeridos', 'error');
                    return;
                }
                
                const updated = DB.update('barberia_services', id, {
                    nombre: nombre,
                    precio: precio,
                    descripcion: descripcion
                });
                
                if (updated) {
                    showNotification('Servicio actualizado', 'success');
                    loadConfigServices();
                    loadBarberiaServices();
                    
                    btn.innerHTML = originalText;
                    btn.onclick = addNewBarberiaService;
                    
                    document.getElementById('servicio-barberia-nombre').value = '';
                    document.getElementById('servicio-barberia-precio').value = '';
                    document.getElementById('servicio-barberia-descripcion').value = '';
                }
            };
        }

        function deleteBarberiaService(id) {
            if (confirm('¿Estás seguro de eliminar este servicio?')) {
                const deleted = DB.delete('barberia_services', id);
                if (deleted) {
                    showNotification('Servicio eliminado', 'success');
                    loadConfigServices();
                    loadBarberiaServices();
                }
            }
        }

        function addNewBarberiaService() {
            const nombre = document.getElementById('servicio-barberia-nombre').value.trim();
            const precio = parseFloat(document.getElementById('servicio-barberia-precio').value);
            const descripcion = document.getElementById('servicio-barberia-descripcion').value.trim();
            
            if (!nombre || !precio) {
                showNotification('Nombre y precio son requeridos', 'error');
                return;
            }
            
            const newService = {
                id: Date.now(),
                nombre: nombre,
                precio: precio,
                descripcion: descripcion
            };
            
            DB.add('barberia_services', newService);
            showNotification('Servicio agregado', 'success');
            loadConfigServices();
            loadBarberiaServices();
            
            document.getElementById('servicio-barberia-nombre').value = '';
            document.getElementById('servicio-barberia-precio').value = '';
            document.getElementById('servicio-barberia-descripcion').value = '';
        }

        function editCarwashService(id) {
            const services = DB.get('carwash_services');
            const service = services.find(s => s.id === id);
            
            if (!service) return;
            
            document.getElementById('servicio-carwash-nombre').value = service.nombre;
            document.getElementById('servicio-carwash-precio').value = service.precio;
            document.getElementById('servicio-carwash-descripcion').value = service.descripcion || '';
            
            const btn = document.getElementById('agregar-servicio-carwash');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Servicio';
            
            btn.onclick = function() {
                const nombre = document.getElementById('servicio-carwash-nombre').value.trim();
                const precio = parseFloat(document.getElementById('servicio-carwash-precio').value);
                const descripcion = document.getElementById('servicio-carwash-descripcion').value.trim();
                
                if (!nombre || !precio) {
                    showNotification('Nombre y precio son requeridos', 'error');
                    return;
                }
                
                const updated = DB.update('carwash_services', id, {
                    nombre: nombre,
                    precio: precio,
                    descripcion: descripcion
                });
                
                if (updated) {
                    showNotification('Servicio actualizado', 'success');
                    loadConfigServices();
                    loadCarwashServices();
                    
                    btn.innerHTML = originalText;
                    btn.onclick = addNewCarwashService;
                    
                    document.getElementById('servicio-carwash-nombre').value = '';
                    document.getElementById('servicio-carwash-precio').value = '';
                    document.getElementById('servicio-carwash-descripcion').value = '';
                }
            };
        }

        function deleteCarwashService(id) {
            if (confirm('¿Estás seguro de eliminar este servicio?')) {
                const deleted = DB.delete('carwash_services', id);
                if (deleted) {
                    showNotification('Servicio eliminado', 'success');
                    loadConfigServices();
                    loadCarwashServices();
                }
            }
        }

        function addNewCarwashService() {
            const nombre = document.getElementById('servicio-carwash-nombre').value.trim();
            const precio = parseFloat(document.getElementById('servicio-carwash-precio').value);
            const descripcion = document.getElementById('servicio-carwash-descripcion').value.trim();
            
            if (!nombre || !precio) {
                showNotification('Nombre y precio son requeridos', 'error');
                return;
            }
            
            const newService = {
                id: Date.now(),
                nombre: nombre,
                precio: precio,
                descripcion: descripcion
            };
            
            DB.add('carwash_services', newService);
            showNotification('Servicio agregado', 'success');
            loadConfigServices();
            loadCarwashServices();
            
            document.getElementById('servicio-carwash-nombre').value = '';
            document.getElementById('servicio-carwash-precio').value = '';
            document.getElementById('servicio-carwash-descripcion').value = '';
        }

        function editProduct(id) {
            const products = DB.get('productos');
            const product = products.find(p => p.id === id);
            
            if (!product) return;
            
            document.getElementById('producto-nombre').value = product.nombre;
            document.getElementById('producto-codigo').value = product.codigo || '';
            document.getElementById('producto-categoria').value = product.categoria;
            document.getElementById('producto-precio-compra').value = product.precio_compra;
            document.getElementById('producto-precio-venta').value = product.precio_venta;
            document.getElementById('producto-stock').value = product.stock;
            
            const btn = document.getElementById('agregar-producto');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Producto';
            
            btn.onclick = function() {
                const nombre = document.getElementById('producto-nombre').value.trim();
                const codigo = document.getElementById('producto-codigo').value.trim();
                const precioCompra = parseFloat(document.getElementById('producto-precio-compra').value);
                const precioVenta = parseFloat(document.getElementById('producto-precio-venta').value);
                const stock = parseInt(document.getElementById('producto-stock').value);
                const categoria = document.getElementById('producto-categoria').value;
                
                if (!nombre || !precioCompra || !precioVenta || !categoria) {
                    showNotification('Complete todos los campos requeridos', 'error');
                    return;
                }
                
                const updated = DB.update('productos', id, {
                    nombre: nombre,
                    codigo: codigo,
                    precio_compra: precioCompra,
                    precio_venta: precioVenta,
                    stock: stock,
                    categoria: categoria
                });
                
                if (updated) {
                    showNotification('Producto actualizado', 'success');
                    loadConfigProducts();
                    loadBillarProducts();
                    
                    btn.innerHTML = originalText;
                    btn.onclick = addNewProduct;
                    
                    document.getElementById('producto-nombre').value = '';
                    document.getElementById('producto-codigo').value = '';
                    document.getElementById('producto-precio-compra').value = '';
                    document.getElementById('producto-precio-venta').value = '';
                    document.getElementById('producto-stock').value = '';
                }
            };
        }

        function deleteProduct(id) {
            if (confirm('¿Estás seguro de eliminar este producto?')) {
                const deleted = DB.delete('productos', id);
                if (deleted) {
                    showNotification('Producto eliminado', 'success');
                    loadConfigProducts();
                    loadBillarProducts();
                }
            }
        }

        function addNewProduct() {
            const nombre = document.getElementById('producto-nombre').value.trim();
            const codigo = document.getElementById('producto-codigo').value.trim();
            const precioCompra = parseFloat(document.getElementById('producto-precio-compra').value);
            const precioVenta = parseFloat(document.getElementById('producto-precio-venta').value);
            const stock = parseInt(document.getElementById('producto-stock').value);
            const categoria = document.getElementById('producto-categoria').value;
            
            if (!nombre || !precioCompra || !precioVenta || !categoria) {
                showNotification('Complete todos los campos requeridos', 'error');
                return;
            }
            
            const newProduct = {
                id: Date.now(),
                nombre: nombre,
                codigo: codigo || null,
                precio_compra: precioCompra,
                precio_venta: precioVenta,
                stock: stock || 0,
                categoria: categoria
            };
            
            DB.add('productos', newProduct);
            showNotification('Producto agregado', 'success');
            loadConfigProducts();
            loadBillarProducts();
            
            document.getElementById('producto-nombre').value = '';
            document.getElementById('producto-codigo').value = '';
            document.getElementById('producto-precio-compra').value = '';
            document.getElementById('producto-precio-venta').value = '';
            document.getElementById('producto-stock').value = '';
        }

        function deleteUser(id) {
            if (confirm('¿Estás seguro de eliminar este usuario?')) {
                const users = UserSystem.deleteUser(id);
                loadConfigUsers();
                showNotification('Usuario eliminado', 'success');
            }
        }

        function editEmployee(id) {
            const employees = DB.get('empleados');
            const employee = employees.find(e => e.id === id);
            
            if (!employee) return;
            
            document.getElementById('empleado-nombre').value = employee.nombre;
            document.getElementById('empleado-cedula').value = employee.cedula;
            document.getElementById('empleado-telefono').value = employee.telefono;
            document.getElementById('empleado-cargo').value = employee.cargo;
            document.getElementById('empleado-sueldo').value = employee.sueldo;
            
            const btn = document.getElementById('saveEmployeeBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-save"></i> Actualizar Empleado';
            
            btn.onclick = function() {
                const nombre = document.getElementById('empleado-nombre').value.trim();
                const cedula = document.getElementById('empleado-cedula').value.trim();
                const telefono = document.getElementById('empleado-telefono').value.trim();
                const cargo = document.getElementById('empleado-cargo').value;
                const sueldo = parseFloat(document.getElementById('empleado-sueldo').value);
                
                if (!nombre || !cedula || !cargo) {
                    showNotification('Complete los campos requeridos', 'error');
                    return;
                }
                
                const updated = DB.update('empleados', id, {
                    nombre: nombre,
                    cedula: cedula,
                    telefono: telefono,
                    cargo: cargo,
                    sueldo: sueldo
                });
                
                if (updated) {
                    showNotification('Empleado actualizado', 'success');
                    loadConfigEmployees();
                    
                    btn.innerHTML = originalText;
                    btn.onclick = addNewEmployee;
                    
                    document.getElementById('empleado-nombre').value = '';
                    document.getElementById('empleado-cedula').value = '';
                    document.getElementById('empleado-telefono').value = '';
                    document.getElementById('empleado-sueldo').value = '';
                }
            };
        }

        function deleteEmployee(id) {
            if (confirm('¿Estás seguro de eliminar este empleado?')) {
                const deleted = DB.delete('empleados', id);
                if (deleted) {
                    showNotification('Empleado eliminado', 'success');
                    loadConfigEmployees();
                }
            }
        }

        function addNewEmployee() {
            const nombre = document.getElementById('empleado-nombre').value.trim();
            const cedula = document.getElementById('empleado-cedula').value.trim();
            const telefono = document.getElementById('empleado-telefono').value.trim();
            const cargo = document.getElementById('empleado-cargo').value;
            const sueldo = parseFloat(document.getElementById('empleado-sueldo').value);
            
            if (!nombre || !cedula || !cargo) {
                showNotification('Complete los campos requeridos', 'error');
                return;
            }
            
            const newEmployee = {
                id: Date.now(),
                nombre: nombre,
                cedula: cedula,
                telefono: telefono,
                cargo: cargo,
                sueldo: sueldo || 0
            };
            
            DB.add('empleados', newEmployee);
            showNotification('Empleado agregado', 'success');
            loadConfigEmployees();
            
            document.getElementById('empleado-nombre').value = '';
            document.getElementById('empleado-cedula').value = '';
            document.getElementById('empleado-telefono').value = '';
            document.getElementById('empleado-sueldo').value = '';
        }

        // =============================================
        // FUNCIÓN SAVE APPOINTMENT
        // =============================================

        function saveAppointment() {
            const cliente = document.getElementById('cliente-cita').value.trim();
            const telefono = document.getElementById('telefono-cita').value.trim();
            const servicioId = document.getElementById('servicio-cita').value;
            const barberoId = document.getElementById('barbero-cita').value;
            const fecha = document.getElementById('fecha-cita').value;
            const hora = document.getElementById('hora-cita').value;
            const notas = document.getElementById('notas-cita').value.trim();
            
            if (!cliente || !servicioId || !barberoId || !fecha || !hora) {
                showNotification('Cliente, servicio, barbero, fecha y hora son requeridos', 'error');
                return;
            }
            
            const servicios = DB.get('barberia_services');
            const servicio = servicios.find(s => s.id == servicioId);
            
            const empleados = DB.get('empleados');
            const barbero = empleados.find(e => e.id == barberoId);
            
            const appointmentDateTime = new Date(`${fecha}T${hora}`);
            if (appointmentDateTime < new Date()) {
                showNotification('La fecha y hora de la cita deben ser futuras', 'error');
                return;
            }
            
            const newAppointment = {
                id: Date.now(),
                cliente: cliente,
                telefono: telefono,
                servicio: servicio ? servicio.nombre : 'Servicio no especificado',
                servicio_id: servicioId,
                barbero: barbero ? barbero.nombre : 'Barbero no especificado',
                barbero_id: barberoId,
                fecha: appointmentDateTime.toISOString(),
                notas: notas,
                estado: 'pendiente',
                creado: new Date().toISOString(),
                usuario: document.getElementById('currentUserName').textContent
            };
            
            DB.add('barberia_appointments', newAppointment);
            showNotification('Cita registrada exitosamente', 'success');
            
            document.getElementById('cliente-cita').value = '';
            document.getElementById('telefono-cita').value = '';
            document.getElementById('servicio-cita').value = '';
            document.getElementById('barbero-cita').value = '';
            document.getElementById('fecha-cita').value = '';
            document.getElementById('hora-cita').value = '';
            document.getElementById('notas-cita').value = '';
        }

        // =============================================
        // FUNCIÓN SHOW PAGE
        // =============================================

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[data-page="${pageId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            const titles = {
                dashboard: "Dashboard",
                barberia: "Barbería",
                billar: "Billar - Sistema POS", 
                carwash: "Car Wash",
                "config-usuarios": "Configuración - Usuarios",
                "config-servicios": "Configuración - Servicios",
                "config-productos": "Configuración - Productos",
                "config-empleados": "Configuración - Empleados",
                "config-impresora": "Configuración - Impresora",
                "config-tema": "Configuración - Tema",
                "config-jarvis": "Configuración Jarvis",
                "config-cierre": "Cierre de Caja",
                "config-contabilidad": "Integración Contable"
            };
            
            document.getElementById('headerTitle').textContent = titles[pageId] || "STARK CLEANE";
            
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'barberia':
                    loadBarberiaServices();
                    break;
                case 'carwash':
                    loadCarwashServices();
                    loadCarwashVehicles();
                    loadCompletedVehicles();
                    loadCarwashHistory();
                    break;
                case 'billar':
                    loadBillarProducts();
                    break;
                case 'config-servicios':
                    loadConfigServices();
                    break;
                case 'config-productos':
                    loadConfigProducts();
                    break;
                case 'config-usuarios':
                    loadConfigUsers();
                    break;
                case 'config-empleados':
                    loadConfigEmployees();
                    break;
                case 'config-cierre':
                    loadCashClosing();
                    break;
            }
        }

        // =============================================
        // FUNCIÓN SETUP EVENT LISTENERS
        // =============================================

        function setupEventListeners() {
            // Navegación
            document.addEventListener('click', function(event) {
                if (event.target.closest('[data-page]')) {
                    const pageElement = event.target.closest('[data-page]');
                    const pageId = pageElement.getAttribute('data-page');
                    
                    if (pageElement.classList.contains('submenu-item')) {
                        const parentSubmenu = pageElement.closest('.submenu');
                        if (parentSubmenu) {
                            parentSubmenu.classList.remove('active');
                            const parentMenuItem = parentSubmenu.previousElementSibling;
                            if (parentMenuItem) {
                                parentMenuItem.querySelector('.fa-chevron-down').classList.remove('fa-chevron-up');
                            }
                        }
                    }
                    
                    showPage(pageId);
                }
                
                if (event.target.closest('[data-submenu]')) {
                    const submenuElement = event.target.closest('[data-submenu]');
                    const submenuId = submenuElement.getAttribute('data-submenu') + '-submenu';
                    const submenu = document.getElementById(submenuId);
                    submenu.classList.toggle('active');
                    
                    const chevron = submenuElement.querySelector('.fa-chevron-down');
                    if (chevron) {
                        chevron.classList.toggle('fa-chevron-up');
                    }
                    
                    event.stopPropagation();
                }
            });

            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const container = this.closest('.tabs').parentElement;
                    
                    this.parentElement.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    container.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const targetContent = document.getElementById(tabId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });

            // Config tabs
            document.querySelectorAll('.config-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-config-tab');
                    
                    this.parentElement.querySelectorAll('.config-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    document.querySelectorAll('#config-servicios .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const targetContent = document.getElementById(tabId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });

            // Tema toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                if (document.body.classList.contains('dark-mode')) {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                    this.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem('stark_theme', 'light');
                } else {
                    document.body.classList.remove('light-mode');
                    document.body.classList.add('dark-mode');
                    this.innerHTML = '<i class="fas fa-moon"></i>';
                    localStorage.setItem('stark_theme', 'dark');
                }
            });

            // Hamburger menu
            document.querySelector('.hamburger').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('active');
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('¿Estás seguro de cerrar sesión?')) {
                    document.getElementById('screen-login').style.display = 'flex';
                    document.getElementById('mainSystem').style.display = 'none';
                    
                    cart = [];
                    cartBarberia = [];
                    cartCarwash = [];
                    
                    showNotification('Sesión cerrada correctamente', 'success');
                }
            });

            // Dashboard cards
            document.addEventListener('click', function(event) {
                if (event.target.closest('.card-system')) {
                    const card = event.target.closest('.card-system');
                    const pageId = card.getAttribute('data-page');
                    if (pageId) {
                        showPage(pageId);
                    }
                }
            });

            // Campos de pago
            document.getElementById('efectivo-recibido')?.addEventListener('input', updateChange);
            document.getElementById('efectivo-recibido-barberia')?.addEventListener('input', updateChangeBarberia);
            document.getElementById('efectivo-recibido-carwash')?.addEventListener('input', updateChangeCarwash);

            // Métodos de pago
            document.getElementById('metodo-pago')?.addEventListener('change', function() {
                document.getElementById('approvalField').style.display = 
                    this.value === 'tarjeta' ? 'block' : 'none';
            });

            document.getElementById('metodo-pago-barberia')?.addEventListener('change', function() {
                document.getElementById('approvalFieldBarberia').style.display = 
                    this.value === 'tarjeta' ? 'block' : 'none';
            });

            document.getElementById('metodo-pago-carwash')?.addEventListener('change', function() {
                document.getElementById('approvalFieldCarwash').style.display = 
                    this.value === 'tarjeta' ? 'block' : 'none';
            });

            // Botones de confirmar venta
            document.getElementById('confirmSaleBtn')?.addEventListener('click', function() {
                confirmSale('billar');
            });

            document.getElementById('confirmSaleBtnBarberia')?.addEventListener('click', function() {
                confirmSale('barberia');
            });

            document.getElementById('confirmSaleBtnCarwash')?.addEventListener('click', function() {
                confirmSale('carwash');
            });

            // Botones de imprimir ticket
            document.getElementById('printTicketBtn')?.addEventListener('click', function() {
                if (cart.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }
                const invoice = InvoiceSystem.generateInvoice('billar', cart, getCartTotal());
                InvoiceSystem.printInvoice(invoice.html);
            });

            document.getElementById('printTicketBtnBarberia')?.addEventListener('click', function() {
                if (cartBarberia.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }
                const cliente = document.getElementById('cliente-barberia').value.trim() || 'Cliente no registrado';
                const rnc = document.getElementById('rnc-barberia').value.trim();
                const metodoPago = document.getElementById('metodo-pago-barberia').value;
                
                const invoice = InvoiceSystem.generateInvoice('barberia', cartBarberia, getCartTotalBarberia(), {
                    cliente: cliente,
                    rnc: rnc,
                    metodo_pago: metodoPago
                });
                InvoiceSystem.printInvoice(invoice.html);
            });

            document.getElementById('printTicketBtnCarwash')?.addEventListener('click', function() {
                if (cartCarwash.length === 0) {
                    showNotification('El carrito está vacío', 'error');
                    return;
                }
                const vehiculoSelect = document.getElementById('vehiculo-servicio');
                const vehiculoId = vehiculoSelect ? vehiculoSelect.value : null;
                const vehicles = DB.get('carwash_vehicles');
                const vehicle = vehicles.find(v => v.id == vehiculoId);
                const cliente = vehicle ? vehicle.cliente : 'Cliente no registrado';
                const rnc = document.getElementById('rnc-carwash').value.trim();
                const metodoPago = document.getElementById('metodo-pago-carwash').value;
                
                const invoice = InvoiceSystem.generateInvoice('carwash', cartCarwash, getCartTotalCarwash(), {
                    cliente: cliente,
                    rnc: rnc,
                    metodo_pago: metodoPago,
                    vehiculo: vehicle ? vehicle.placa : ''
                });
                InvoiceSystem.printInvoice(invoice.html);
            });

            // Botones de limpiar carrito
            document.getElementById('clearCartBtn')?.addEventListener('click', function() {
                cart = [];
                updateCartUI();
                showNotification('Carrito limpiado', 'success');
            });

            // Búsqueda de productos
            document.getElementById('search-product')?.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const products = DB.get('productos');
                const container = document.getElementById('billar-products-touch');
                
                if (!container) return;
                
                container.innerHTML = '';
                
                const filtered = products.filter(product => 
                    (product.nombre.toLowerCase().includes(searchTerm) ||
                    product.codigo?.toLowerCase().includes(searchTerm) ||
                    product.categoria.toLowerCase().includes(searchTerm)) && product.stock > 0
                );
                
                if (filtered.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary); width: 100%;">
                            <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No se encontraron productos</p>
                        </div>
                    `;
                    return;
                }
                
                filtered.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'touch-service-card';
                    card.dataset.id = product.id;
                    card.innerHTML = `
                        <i class="fas fa-box"></i>
                        <h4>${product.nombre}</h4>
                        <div class="price">RD$ ${product.precio_venta}</div>
                        <small style="color: var(${product.stock <= 5 ? '--danger' : '--text-secondary'});">Stock: ${product.stock}</small>
                    `;
                    
                    card.addEventListener('click', function() {
                        addToCart(product.id, product.nombre, product.precio_venta || product.precio);
                    });
                    
                    container.appendChild(card);
                });
            });

            // Cerrar modales
            document.getElementById('closeInvoiceModal')?.addEventListener('click', function() {
                document.getElementById('invoiceModal').classList.remove('active');
            });

            document.getElementById('closeProductModal')?.addEventListener('click', function() {
                document.getElementById('productModal').classList.remove('active');
            });

            // Guardar tema
            document.getElementById('saveThemeBtn')?.addEventListener('click', function() {
                const tema = document.getElementById('select-tema').value;
                localStorage.setItem('stark_theme', tema);
                
                if (tema === 'light') {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('light-mode');
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
                }
                
                showNotification('Tema actualizado', 'success');
            });

            // Cargar tema guardado
            const savedTheme = localStorage.getItem('stark_theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                document.getElementById('select-tema').value = 'light';
            }

            // Actualizar dashboard
            document.getElementById('refreshDashboard')?.addEventListener('click', function() {
                updateDashboard();
                showNotification('Dashboard actualizado', 'success');
            });

            // Botón de registrar vehículo
            document.getElementById('saveVehicleBtn')?.addEventListener('click', saveVehicle);
            
            // Botón de guardar cita
            document.getElementById('saveAppointmentBtn')?.addEventListener('click', saveAppointment);
            
            // Botón de agregar producto
            document.getElementById('agregar-producto').onclick = addNewProduct;
            
            // Botón de agregar servicio barbería
            document.getElementById('agregar-servicio-barberia').onclick = addNewBarberiaService;
            
            // Botón de agregar servicio carwash
            document.getElementById('agregar-servicio-carwash').onclick = addNewCarwashService;
            
            // Botón de guardar empleado
            document.getElementById('saveEmployeeBtn').onclick = addNewEmployee;
            
            // Botón de búsqueda en historial de carwash
            document.getElementById('searchCarwashBtn')?.addEventListener('click', function() {
                loadCarwashHistory();
            });
            
            // Cierre de caja
            document.getElementById('processCashClosingBtn')?.addEventListener('click', loadCashClosing);
            document.getElementById('calculateDiscrepancyBtn')?.addEventListener('click', calculateDiscrepancy);
            document.getElementById('finalizeClosingBtn')?.addEventListener('click', finalizeClosing);
            
            // Guardar configuración Jarvis
            document.getElementById('saveJarvisConfigBtn').onclick = function() {
                showNotification('Configuración Jarvis guardada', 'success');
            };
            
            // Guardar configuración de impresora
            document.getElementById('savePrinterConfigBtn').onclick = function() {
                const companyName = document.getElementById('company-name').value;
                const companyAddress = document.getElementById('company-address').value;
                const companyPhone = document.getElementById('company-phone').value;
                const companyRNC = document.getElementById('company-rnc').value;
                const paperWidth = document.getElementById('paper-width').value;
                
                localStorage.setItem('company_name', companyName);
                localStorage.setItem('company_address', companyAddress);
                localStorage.setItem('company_phone', companyPhone);
                localStorage.setItem('company_rnc', companyRNC);
                localStorage.setItem('paper_width', paperWidth);
                
                showNotification('Configuración de impresora guardada', 'success');
            };
            
            // Cargar configuración de impresora
            document.getElementById('company-name').value = localStorage.getItem('company_name') || 'STARK CLEANE';
            document.getElementById('company-address').value = localStorage.getItem('company_address') || '';
            document.getElementById('company-phone').value = localStorage.getItem('company_phone') || '';
            document.getElementById('company-rnc').value = localStorage.getItem('company_rnc') || '';
            document.getElementById('paper-width').value = localStorage.getItem('paper_width') || '82';
        }

        // =============================================
        // SISTEMA DE DASHBOARD
        // =============================================

        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            
            const appointments = DB.get('barberia_appointments');
            const billarSales = DB.get('billar_sales');
            const barberiaSales = DB.get('barberia_sales');
            const carwashSales = DB.get('carwash_sales');
            const vehicles = DB.get('carwash_vehicles');
            
            const todayAppointments = appointments.filter(a => a.fecha?.split('T')[0] === today);
            const todayBillarSales = billarSales.filter(s => s.fecha?.split('T')[0] === today);
            const todayBarberiaSales = barberiaSales.filter(s => s.fecha?.split('T')[0] === today);
            const todayCarwashSales = carwashSales.filter(s => s.fecha?.split('T')[0] === today);
            const todayVehicles = vehicles.filter(v => v.entrada?.split('T')[0] === today);
            
            const totalBillar = todayBillarSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalBarberia = todayBarberiaSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalCarwash = todayCarwashSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalDaily = totalBillar + totalBarberia + totalCarwash;
            
            const totalCustomers = new Set([
                ...todayBillarSales.map(s => s.cliente),
                ...todayBarberiaSales.map(s => s.cliente),
                ...todayCarwashSales.map(s => s.cliente)
            ]).size;
            
            const totalProductsSold = todayBillarSales.reduce((sum, sale) => 
                sum + sale.items.reduce((itemSum, item) => itemSum + (item.quantity || 1), 0), 0);
            
            document.getElementById('appointmentsCount').textContent = todayAppointments.length;
            document.getElementById('appointmentsTrend').textContent = 
                todayAppointments.length > 0 ? `${todayAppointments.length} citas hoy` : 'No hay citas hoy';
            
            document.getElementById('salesTotal').textContent = `RD$ ${totalBillar}`;
            document.getElementById('salesTrend').textContent = 
                todayBillarSales.length > 0 ? `${todayBillarSales.length} ventas hoy` : 'No hay ventas hoy';
            
            document.getElementById('vehiclesCount').textContent = todayVehicles.length;
            document.getElementById('vehiclesTrend').textContent = 
                todayVehicles.length > 0 ? `${todayVehicles.length} vehículos hoy` : 'No hay vehículos hoy';
            
            document.getElementById('dailyIncome').textContent = `RD$ ${totalDaily}`;
            document.getElementById('incomeTrend').textContent = 
                totalDaily > 0 ? `Total del día` : 'Sin ingresos hoy';
            
            document.getElementById('customersCount').textContent = totalCustomers;
            document.getElementById('customersTrend').textContent = 
                totalCustomers > 0 ? `${totalCustomers} clientes atendidos` : 'Sin clientes hoy';
            
            document.getElementById('productsSold').textContent = totalProductsSold;
            document.getElementById('productsTrend').textContent = 
                totalProductsSold > 0 ? `${totalProductsSold} productos vendidos` : 'Sin productos vendidos';
            
            document.getElementById('cashCount').textContent = `RD$ ${totalDaily}`;
            
            updateSalesChart();
        }

        function updateSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;
            
            const dates = [];
            const salesData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                dates.push(date.toLocaleDateString('es-ES', { weekday: 'short' }));
                
                const billarSales = DB.get('billar_sales').filter(s => s.fecha?.split('T')[0] === dateString);
                const barberiaSales = DB.get('barberia_sales').filter(s => s.fecha?.split('T')[0] === dateString);
                const carwashSales = DB.get('carwash_sales').filter(s => s.fecha?.split('T')[0] === dateString);
                
                const total = billarSales.reduce((sum, s) => sum + s.total, 0) +
                             barberiaSales.reduce((sum, s) => sum + s.total, 0) +
                             carwashSales.reduce((sum, s) => sum + s.total, 0);
                
                salesData.push(total);
            }
            
            if (window.salesChartInstance) {
                window.salesChartInstance.data.labels = dates;
                window.salesChartInstance.data.datasets[0].data = salesData;
                window.salesChartInstance.update();
            } else {
                window.salesChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Ventas (RD$)',
                            data: salesData,
                            borderColor: 'var(--primary)',
                            backgroundColor: 'rgba(26, 115, 232, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'var(--border-color)'
                                },
                                ticks: {
                                    color: 'var(--text-color)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'var(--border-color)'
                                },
                                ticks: {
                                    color: 'var(--text-color)'
                                }
                            }
                        }
                    }
                });
            }
        }

        // =============================================
        // SISTEMA DE CIERRE DE CAJA
        // =============================================

        function loadCashClosing() {
            const today = new Date().toISOString().split('T')[0];
            const sales = [
                ...DB.get('billar_sales'),
                ...DB.get('barberia_sales'),
                ...DB.get('carwash_sales')
            ].filter(sale => sale.fecha && sale.fecha.split('T')[0] === today);

            let efectivo = 0, tarjeta = 0, transferencia = 0;
            sales.forEach(sale => {
                switch(sale.metodo_pago) {
                    case 'efectivo': efectivo += sale.total; break;
                    case 'tarjeta': tarjeta += sale.total; break;
                    case 'transferencia': transferencia += sale.total; break;
                }
            });

            const total = efectivo + tarjeta + transferencia;

            const summaryHTML = `
                <div class="cash-method-card efectivo">
                    <h4><i class="fas fa-money-bill-wave"></i> Efectivo</h4>
                    <div class="cash-method-amount">RD$ ${efectivo.toFixed(2)}</div>
                    <div class="cash-method-count">${sales.filter(s => s.metodo_pago === 'efectivo').length} ventas</div>
                </div>
                <div class="cash-method-card tarjeta">
                    <h4><i class="fas fa-credit-card"></i> Tarjeta</h4>
                    <div class="cash-method-amount">RD$ ${tarjeta.toFixed(2)}</div>
                    <div class="cash-method-count">${sales.filter(s => s.metodo_pago === 'tarjeta').length} ventas</div>
                </div>
                <div class="cash-method-card transferencia">
                    <h4><i class="fas fa-university"></i> Transferencia</h4>
                    <div class="cash-method-amount">RD$ ${transferencia.toFixed(2)}</div>
                    <div class="cash-method-count">${sales.filter(s => s.metodo_pago === 'transferencia').length} ventas</div>
                </div>
            `;

            const summaryContainer = document.getElementById('cashSummary');
            if (summaryContainer) summaryContainer.innerHTML = summaryHTML;

            const expectedTotalEl = document.getElementById('expectedTotal');
            if (expectedTotalEl) expectedTotalEl.textContent = `RD$ ${total.toFixed(2)}`;

            // Cargar historial de cierres
            const closings = DB.get('cash_closings');
            const table = document.getElementById('closingHistoryTable');
            if (table) {
                table.innerHTML = '';
                closings.forEach(closing => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(closing.fecha).toLocaleString()}</td>
                        <td>${closing.responsable}</td>
                        <td>RD$ ${closing.efectivo.toFixed(2)}</td>
                        <td>RD$ ${closing.tarjeta.toFixed(2)}</td>
                        <td>RD$ ${closing.transferencia.toFixed(2)}</td>
                        <td>RD$ ${closing.total.toFixed(2)}</td>
                        <td><span class="badge ${closing.discrepancia ? 'badge-warning' : 'badge-success'}">${closing.discrepancia ? 'Con diferencia' : 'Correcto'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="viewClosingDetails(${closing.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                });
            }
        }

        function calculateDiscrepancy() {
            const efectivoContado = parseFloat(document.getElementById('efectivo-contado').value) || 0;
            const expectedTotal = parseFloat(document.getElementById('expectedTotal').textContent.replace('RD$ ', '')) || 0;
            const discrepancy = efectivoContado - expectedTotal;
            
            const discrepancySection = document.getElementById('discrepancySection');
            const discrepancyAmount = document.getElementById('discrepancyAmount');
            
            if (Math.abs(discrepancy) > 0.01) {
                discrepancySection.style.display = 'block';
                discrepancyAmount.textContent = `Diferencia: RD$ ${discrepancy.toFixed(2)}`;
                discrepancyAmount.style.color = discrepancy < 0 ? 'var(--danger)' : 'var(--accent)';
            } else {
                discrepancySection.style.display = 'none';
            }
        }

        function finalizeClosing() {
            const efectivoContado = parseFloat(document.getElementById('efectivo-contado').value) || 0;
            const fechaCierre = document.getElementById('fecha-cierre').value;
            const responsable = document.getElementById('responsable').value.trim();
            const turno = document.getElementById('turno').value;
            const discrepancyReason = document.getElementById('discrepancy-reason').value;
            const discrepancyNotes = document.getElementById('discrepancy-notes').value.trim();
            
            if (!efectivoContado || !fechaCierre || !responsable) {
                showNotification('Complete los campos requeridos', 'error');
                return;
            }
            
            const expectedTotal = parseFloat(document.getElementById('expectedTotal').textContent.replace('RD$ ', '')) || 0;
            const discrepancy = efectivoContado - expectedTotal;
            
            const closingRecord = {
                id: Date.now(),
                fecha: fechaCierre || new Date().toISOString(),
                responsable: responsable,
                efectivo: expectedTotal,
                tarjeta: 0,
                transferencia: 0,
                total: expectedTotal,
                efectivo_contado: efectivoContado,
                discrepancia: Math.abs(discrepancy) > 0.01,
                discrepancia_monto: discrepancy,
                discrepancia_razon: discrepancyReason,
                discrepancia_notas: discrepancyNotes,
                turno: turno,
                usuario: document.getElementById('currentUserName').textContent
            };
            
            DB.add('cash_closings', closingRecord);
            showNotification('Cierre de caja guardado exitosamente', 'success');
            
            // Limpiar formulario
            document.getElementById('efectivo-contado').value = '';
            document.getElementById('fecha-cierre').value = '';
            document.getElementById('responsable').value = '';
            document.getElementById('discrepancy-reason').value = '';
            document.getElementById('discrepancy-notes').value = '';
            document.getElementById('discrepancySection').style.display = 'none';
            
            loadCashClosing();
        }

        function viewClosingDetails(closingId) {
            const closings = DB.get('cash_closings');
            const closing = closings.find(c => c.id === closingId);
            
            if (!closing) return;
            
            let details = `Cierre de Caja #${closing.id}\n`;
            details += `Fecha: ${new Date(closing.fecha).toLocaleString()}\n`;
            details += `Responsable: ${closing.responsable}\n`;
            details += `Turno: ${closing.turno}\n`;
            details += `Efectivo Esperado: RD$ ${closing.efectivo.toFixed(2)}\n`;
            details += `Efectivo Contado: RD$ ${closing.efectivo_contado.toFixed(2)}\n`;
            
            if (closing.discrepancia) {
                details += `\nDIFERENCIA DETECTADA\n`;
                details += `Monto: RD$ ${closing.discrepancia_monto.toFixed(2)}\n`;
                details += `Razón: ${closing.discrepancia_razon || 'No especificada'}\n`;
                details += `Notas: ${closing.discrepancia_notas || 'Ninguna'}\n`;
            }
            
            alert(details);
        }

        // =============================================
        // FUNCIÓN INIT APP
        // =============================================

        function initApp() {
            DB.initializeData();
            setupEventListeners();
            
            loadBarberiaServices();
            loadCarwashServices();
            loadBillarProducts();
            loadConfigServices();
            loadConfigProducts();
            loadConfigUsers();
            loadConfigEmployees();
            
            updateDashboard();
            
            showNotification('Sistema cargado correctamente', 'success');
        }

        // =============================================
        // FUNCIONES AUXILIARES
        // =============================================

        function generateDailyReport() {
            showNotification('Generando reporte diario...', 'info');
            
        }

      // =============================================
// FUNCIÓN PARA RESETEAR TODOS LOS DATOS
// =============================================

function resetAllData() {
    if (confirm('⚠️ ¿ESTÁS SEGURO DE BORRAR TODOS LOS DATOS?\n\nEsto eliminará:\n- Todos los productos\n- Todos los servicios\n- Todas las ventas\n- Todos los empleados\n- Todo el historial\n\nEsta acción NO se puede deshacer.')) {
        // Borrar todos los datos del localStorage
        const keysToRemove = [
            'barberia_services',
            'carwash_services', 
            'productos',
            'empleados',
            'billar_sales',
            'barberia_sales',
            'carwash_sales',
            'barberia_appointments',
            'carwash_vehicles',
            'cash_closings',
            'carwash_history'
        ];
        
        keysToRemove.forEach(key => {
            localStorage.removeItem(key);
        });
        
        // Reiniciar carritos
        cart = [];
        cartBarberia = [];
        cartCarwash = [];
        
        // Volver a inicializar datos por defecto
        DB.initializeData();
        
        // Recargar todas las vistas
        if (document.getElementById('barberia').classList.contains('active')) {
            loadBarberiaServices();
            updateCartUIBarberia();
        } else if (document.getElementById('billar').classList.contains('active')) {
            loadBillarProducts();
            updateCartUI();
        } else if (document.getElementById('carwash').classList.contains('active')) {
            loadCarwashServices();
            loadCarwashVehicles();
            updateCartUICarwash();
        }
        
        // Recargar configuración si está activa
        if (document.getElementById('config-servicios').classList.contains('active')) {
            loadConfigServices();
        }
        if (document.getElementById('config-productos').classList.contains('active')) {
            loadConfigProducts();
        }
        if (document.getElementById('config-empleados').classList.contains('active')) {
            loadConfigEmployees();
        }
        
        showNotification('✅ Todos los datos han sido reseteados. Sistema reiniciado.', 'success');
        updateDashboard();
    }
}  
 </script>
</body>
</html>